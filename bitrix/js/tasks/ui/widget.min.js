BX.namespace("BX.Tasks.ui");BX.Tasks.ui.widget=function(t){BX.merge(this,{opts:{scope:false,useSpawn:false,messages:{},controls:{},bindEvents:{},removeTemplates:true,initializeByGlobalEvent:false,globalEventScope:"document"},vars:{},ctrls:{},tmpls:{},sys:{stack:{init:[]},code:"widget",initialized:false}});this.pushFuncStack("init",BX.Tasks.ui.widget);this.isuiWidget=true};BX.merge(BX.Tasks.ui.widget.prototype,{preInit:function(){var t=this,e=this.opts,s=this.ctrls,i=this.sys.code;s.scope=null;if(!("querySelector"in document))throw new Error("Your browser does not support querySelector");if(!i.match(/^[a-zA-Z0-9-_]+$/))throw new Error('Only letters, digitis, "-" and "_" allowed in code')},init:function(){var t=this,e=this.ctrls,s=this.opts,i=this.sys.code,n;if(s.scope!==false){e.scope=BX.type.isNotEmptyString(s.scope)?BX(s.scope):s.scope;if(!BX.type.isElementNode(e.scope))throw new Error("Invalid node passed");if(s.useSpawn&&e.scope)t.tmpls["scope"]=e.scope.outerHTML;var o=e.scope.querySelectorAll('script[type="text/html"]');for(n=0;n<o.length;n++){var r=BX.data(o[n],"template-id");if(typeof r=="string"&&r.length>0&&r.search("bx-tasks-ui-"+i)==0){r=r.replace("bx-tasks-ui-"+i+"-","");t.tmpls[r]=o[n].innerHTML;if(this.opts.removeTemplates)BX.remove(o[n])}}}if(typeof s.bindEvents=="object"){for(n in s.bindEvents){if(BX.type.isFunction(s.bindEvents[n]))this.bindEvent(n,s.bindEvents[n])}}s.bindEvents=null},remove:function(){if(BX.type.isDomNode(this.ctrls.scope))this.ctrls.scope.innerHTML="";BX.unbindAll(this)},getControlClassName:function(t){return"bx-tasks-ui-"+this.sys.code+"-"+t},getControl:function(t,e,s,i){var n;if(!BX.type.isNotEmptyString(t))return null;if(BX.type.isElementNode(this.opts.controls[t]))return this.opts.controls[t];if(!this.ctrls.scope)return null;var o=this.ctrls.scope;if(BX.type.isElementNode(s))o=s;var r=function(t){return!i&&t!==null||i&&t.length>0};try{n=o[i?"querySelectorAll":"querySelector"]('[data-bx-tasks-ui-id="'+this.sys.code+"-"+t+'"]');if(r(n))return n}catch(a){}try{n=o[i?"querySelectorAll":"querySelector"]("."+this.getControlClassName(t));if(r(n))return n}catch(a){}try{n=o[i?"querySelectorAll":"querySelector"]("."+t);if(r(n))return n}catch(a){}try{n=o[i?"querySelectorAll":"querySelector"](t);if(r(n))return n}catch(a){}if(n===null&&!e)throw new Error("Requested control node can not be found ("+t+")");return n},setOption:function(t,e){this.opts[t]=e},getOption:function(t){return this.opts[t]},getSysCode:function(){return this.sys.code},getHTMLByTemplate:function(t,e){var s=this.tmpls[t];if(!BX.type.isNotEmptyString(s))return"";for(var i in e){if(typeof e[i]!="undefined"&&e.hasOwnProperty(i)){var n="";if(i.toString().indexOf("=")==0){n=e[i].toString();i=i.toString().substr(1)}else n=BX.util.htmlspecialchars(e[i]).toString();var o="{{"+i.toString().toLowerCase()+"}}";if(n.search(o)>=0)n="";while(s.search(o)>=0)s=s.replace(o,n)}}return s},createNodesByTemplate:function(t,e,s){var i=this.tmpls[t];if(!BX.type.isNotEmptyString(i))return null;i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var n=this.getHTMLByTemplate(t,e);var o=false;var r=false;if(i.search(/^<\s*(tr|th)[^<]*>/)>=0)o=true;else if(i.search(/^<\s*td[^<]*>/)>=0)r=true;var a=document.createElement("div");if(o||r){if(o){a.innerHTML="<table><tbody>"+n+"</tbody></table>";a=a.childNodes[0].childNodes[0]}else{a.innerHTML="<table><tbody><tr>"+n+"</tr></tbody></table>";a=a.childNodes[0].childNodes[0].childNodes[0]}}else a.innerHTML=n;if(s){var l=a.childNodes;var c=[];for(var u=0;u<l.length;u++)if(BX.type.isElementNode(l[u]))c.push(l[u]);return c}else return Array.prototype.slice.call(a.childNodes)},replaceTemplate:function(t,e){this.tmpls[t]=e},parentConstruct:function(t,e){var s=t.superclass;if(typeof s=="object")s.constructor.apply(this,[e,true])},handleInitStack:function(t,e,s){this.pushFuncStack("init",e);if(!t){BX.merge(this.opts,s);BX.Tasks.ui.widget.prototype.preInit.call(this);var i=function(){if(this.sys.initialized)return;this.resolveFuncStack("init");for(var t in this.sys.stack){if(t!="init")this.resolveFuncStack(t,true)}this.sys.initialized=true;this.fireEvent("init",[this])};if(BX.type.isString(this.opts.initializeByGlobalEvent)&&this.opts.initializeByGlobalEvent.length>0){var n=this.opts.globalEventScope=="window"?window:document;BX.addCustomEvent(n,this.opts.initializeByGlobalEvent,BX.proxy(i,this))}else i.call(this)}},pushFuncStack:function(t,e){if(BX.type.isFunction(e.prototype[t])){if(typeof this.sys.stack[t]=="undefined")this.sys.stack[t]=[];this.sys.stack[t].push({owner:e,f:e.prototype[t]})}},disableInFuncStack:function(t,e){var s=this.sys.stack[t];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){if(s[i].owner==e)s[i].f=BX.DoNothing}},resolveFuncStack:function(t,e){var s=this.sys.stack[t];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){s[i].f.call(this)}if(e)this.fireEvent(t,[this],document);this.sys.stack[t]=null},fireEvent:function(t,e,s){s=s||this;e=e||[];BX.onCustomEvent(s,"bx-tasks-ui-"+this.sys.code+"-"+t,e)},bindEvent:function(t,e){BX.addCustomEvent(this,"bx-tasks-ui-"+this.sys.code+"-"+t,e)},setCSSState:function(t,e){this.changeCSSState(t,e,true)},dropCSSState:function(t,e){this.changeCSSState(t,e,false)},changeCSSState:function(t,e,s){e=e||this.ctrls.scope;if(typeof t!="string"||t.length==0)return;BX[s?"addClass":"removeClass"](e,"bx-tasks-ui-state-"+t)},spawn:function(t,e){if(this.opts.useSpawn)BX.html(t,this.tmpls.scope);var s=BX.clone(this.opts);s.scope=t;if(BX.type.isFunction(e))e.apply(this,[s,t]);return new this.constructor(s)},getRandom:function(){return"bx"+this.sys.code+Math.floor(Math.random()*1e3+1)+Math.floor(Math.random()*1e3+1)}});BX.Tasks.ui.networkIOWidget=function(t,e){this.parentConstruct(BX.Tasks.ui.networkIOWidget,t);BX.merge(this,{opts:{source:"/somewhere.php",pageSize:5,paginatedRequest:true},vars:{lastPage:0,loader:{show:BX.DoNothing,hide:BX.DoNothing}},ctrls:{},sys:{code:"network-io-widget"}});this.handleInitStack(e,BX.Tasks.ui.networkIOWidget,t)};BX.extend(BX.Tasks.ui.networkIOWidget,BX.Tasks.ui.widget);BX.merge(BX.Tasks.ui.networkIOWidget.prototype,{init:function(){},downloadBundle:function(t){var e=this.opts,s=this.vars,i=this.ctrls,n=this;s.loader.show(t.options);BX.ajax({url:e.source,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:BX.merge(n.refineRequest(t.request,t.options),n.getNavParams(t.options)),onsuccess:function(e){s.loader.hide(t.options);if(e.result){e.data=n.refineResponce(e.data,t.request,t.options);if(typeof e.data=="undefined")e.data=[];if(BX.type.isFunction(t.callbacks.onLoad))t.callbacks.onLoad.apply(n,[e.data])}else n.showError({errors:e.errors,type:"server-logic",options:t.options});if(BX.type.isFunction(t.callbacks.onComplete))t.callbacks.onComplete.call(n)},onfailure:function(e,i){s.loader.hide(t.options);n.showError({errors:[i.message],type:e,options:t.options,exception:i});if(BX.type.isFunction(t.callbacks.onComplete))t.callbacks.onComplete.call(n);if(BX.type.isFunction(t.callbacks.onError))t.callbacks.onError.apply(n,[e,i])}})},getNavParams:function(t){return this.opts.paginatedRequest?{PAGE_SIZE:this.opts.pageSize,PAGE:this.vars.lastPage}:{}},showError:function(t){BX.debug(t)},refineRequest:function(t,e){return t},refineResponce:function(t,e,s){return t}});
//# sourceMappingURL=widget.map.js