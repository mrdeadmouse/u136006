(function(e){if(e.BX["UploaderQueue"])return false;var t=e.BX,i={"new":0,ready:1,preparing:2,inprogress:3,done:4,failed:5,stopped:6,changed:7,uploaded:8};t.UploaderQueue=function(e,i,s){this.dialogName="BX.UploaderQueue";i=!!i?i:{};this.limits={phpPostMaxSize:i["phpPostMaxSize"],phpUploadMaxFilesize:i["phpUploadMaxFilesize"],uploadMaxFilesize:i["uploadMaxFilesize"]>0?i["uploadMaxFilesize"]:0,uploadFileWidth:i["uploadFileWidth"]>0?i["uploadFileWidth"]:0,uploadFileHeight:i["uploadFileHeight"]>0?i["uploadFileHeight"]:0};this.placeHolder=t(e["placeHolder"]);this.showImage=e["showImage"]!==false;this.sortItems=e["sortItems"]!==false;this.uploader=s;this.itForUpload=new t.UploaderUtils.Hash;this.items=new t.UploaderUtils.Hash;this.itUploaded=new t.UploaderUtils.Hash;this.itFailed=new t.UploaderUtils.Hash;this.thumb={tagName:"LI",className:"bx-bxu-thumb-thumb"};if(!!e["thumb"]){for(var r in e["thumb"]){if(e["thumb"].hasOwnProperty(r)&&this.thumb.hasOwnProperty(r)){this.thumb[r]=e["thumb"][r]}}}t.addCustomEvent(s,"onItemIsAdded",t.delegate(this.addItem,this));t.addCustomEvent(s,"onItemsAreAdded",t.delegate(this.finishQueue,this));t.addCustomEvent(s,"onFileIsDeleted",t.delegate(this.deleteItem,this));t.addCustomEvent(s,"onFileIsReinited",t.delegate(this.reinitItem,this));this.log("Initialized");return this};t.UploaderQueue.prototype={showError:function(e){this.log("Error! "+e)},log:function(e){t.UploaderUtils.log("queue",e)},addItem:function(s,r){var a;if(!this.showImage)a=false;else if(t.type.isDomNode(s))a=t.UploaderUtils.isImage(s.value,null,null);else a=t.UploaderUtils.isImage(s["name"],s["type"],s["size"]);t.onCustomEvent(this.uploader,"onFileIsBeforeCreated",[s,r,a,this.uploader]);var d={copies:this.uploader.fileCopies,fields:this.uploader.fileFields},o=a?new t.UploaderImage(s,d,this.limits,this.uploader):new t.UploaderFile(s,d,this.limits,this.uploader),l,n,h={status:i.ready};t.onCustomEvent(o,"onFileIsAfterCreated",[o,r,h,this.uploader]);t.onCustomEvent(this.uploader,"onFileIsAfterCreated",[o,r,h,this.uploader]);this.items.setItem(o.id,o);if(r||h["status"]!==i.ready){this.itUploaded.setItem(o.id,o)}else{this.itForUpload.setItem(o.id,o)}if(!!this.placeHolder){if(t(r)){o.thumbNode=n=t(r)}else{l=o.makeThumb();n=t.create(this.thumb.tagName,{attrs:{id:o.id+"Item","bx-bxu-item-id":o.id,className:this.thumb.className}});if(t.type.isNotEmptyString(l)){if(this.thumb.tagName=="TR"){l=l.replace(/[\n\t]/gi,"").replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1");if(!!l["trim"])l=l.trim();var u=function(e,t,i){var s=n.insertCell(-1),r={colspan:true,headers:true,accesskey:true,"class":true,contenteditable:true,contextmenu:true,dir:true,hidden:true,id:true,lang:true,spellcheck:true,style:true,tabindex:true,title:true,translate:true},a;s.innerHTML=i;t=t.split(" ");while((a=t.pop())&&a){a=a.split("=");if(a.length==2){a[0]=a[0].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");a[1]=a[1].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");if(r[a[0]]===true)s.setAttribute(a[0],a[1]);else s[a[0]]=a[1]}}return""},p=/^<td(.*?)>(.*?)<\/td>/i;e.data1=l;while(p.test(l))l=l.replace(p,u)}else{n.innerHTML=l}}else if(t.type.isDomNode(l)){t.adjust(n,{children:[l]})}}if(!!e["jsDD"]&&this.sortItems){if(!this._onbxdragstart){this._onbxdragstart=t.delegate(this.onbxdragstart,this);this._onbxdragstop=t.delegate(this.onbxdragstop,this);this._onbxdrag=t.delegate(this.onbxdrag,this);this._onbxdraghout=t.delegate(this.onbxdraghout,this);this._onbxdestdraghover=t.delegate(this.onbxdestdraghover,this);this._onbxdestdraghout=t.delegate(this.onbxdestdraghout,this);this._onbxdestdragfinish=t.delegate(this.onbxdestdragfinish,this)}t.addClass(n,"bx-drag-draggable");n.onbxdragstart=this._onbxdragstart;n.onbxdragstop=this._onbxdragstop;n.onbxdrag=this._onbxdrag;n.onbxdraghout=this._onbxdraghout;e.jsDD.registerObject(n);n.onbxdestdraghover=this._onbxdestdraghover;n.onbxdestdraghout=this._onbxdestdraghout;n.onbxdestdragfinish=this._onbxdestdragfinish;e.jsDD.registerDest(n)}n.setAttribute("bx-item-id",o.id);if(t(r)){t.onCustomEvent(this.uploader,"onFileIsBound",[o.id,o,this.caller,r]);t.onCustomEvent(o,"onFileIsBound",[o.id,o,this.caller,r])}else if(!!r){this.placeHolder.appendChild(n);t.onCustomEvent(this.uploader,"onFileIsAttached",[o.id,o,this.caller,r]);t.onCustomEvent(o,"onFileIsAttached",[o.id,o,this.caller,r])}else{this.placeHolder.appendChild(n);t.onCustomEvent(this.uploader,"onFileIsAppended",[o.id,o,this.caller]);t.onCustomEvent(o,"onFileIsAppended",[o.id,o,this.caller])}}t.onCustomEvent(this.uploader,"onQueueIsChanged",[this,"add",o.id,o])},getItem:function(e){var i=this.items.getItem(e);if(i)return{item:i,node:i.thumbNode||t(e+"Item")};return null},onbxdragstart:function(){var e=t.proxy_context,i=e&&e.getAttribute("bx-item-id");if(i){var s=e.innerHTML.replace(new RegExp(i,"gi"),"DragCopy");e.__dragCopyDiv=t.create("DIV",{attrs:{className:"bx-drag-object "+e.className},style:{position:"absolute",zIndex:10,width:e.clientWidth+"px"},html:s});e.__dragCopyPos=t.pos(e);t.onCustomEvent(this.uploader,"onBxDragStart",[e,e.__dragCopyDiv]);document.body.appendChild(e.__dragCopyDiv);t.addClass(e,"bx-drag-source");var r=t("DragCopyProperCanvas"),a,d=this.items.getItem(i);if(r&&(d&&t(d.canvas))){a=d.canvas.cloneNode(true);r.parentNode.replaceChild(a,r);a.getContext("2d").drawImage(d.canvas,0,0)}}return true},onbxdragstop:function(){var e=t.proxy_context;if(e.__dragCopyDiv){t.removeClass(e,"bx-drag-source");e.__dragCopyDiv.parentNode.removeChild(e.__dragCopyDiv);e.__dragCopyDiv=null;delete e["__dragCopyDiv"];delete e["__dragCopyPos"]}return true},onbxdrag:function(e,i){var s=t.proxy_context,r=s.__dragCopyDiv;if(r){if(s.__dragCopyPos){if(!s.__dragCopyPos.deltaX)s.__dragCopyPos.deltaX=s.__dragCopyPos.left-e;if(!s.__dragCopyPos.deltaY)s.__dragCopyPos.deltaY=s.__dragCopyPos.top-i;e+=s.__dragCopyPos.deltaX;i+=s.__dragCopyPos.deltaY}r.style.left=e+"px";r.style.top=i+"px"}},onbxdraghout:function(e,t,i){},onbxdestdraghover:function(){var e=t.proxy_context;t.addClass(e,"bx-drag-over");return true},onbxdestdraghout:function(){var e=t.proxy_context;t.removeClass(e,"bx-drag-over");return true},onbxdestdragfinish:function(e){var i=t.proxy_context;t.removeClass(i,"bx-drag-over");if(i==e||!t.hasClass(e,"bx-drag-draggable"))return true;else{var s=i.parentNode,r=s.childNodes.length;for(var a=0;a<r;a++){if(s.childNodes[a]==i)i.number=a;else if(s.childNodes[a]==e)e.number=a;if(e.number>0&&i.number>0)break}if(this.itForUpload.hasItem(e.getAttribute("bx-bxu-item-id"))){var d=i.number<=e.number?"beforeItem":i.nextSibling?"afterItem":"inTheEnd",o=null;if(d!="inTheEnd"){for(a=i.number+(d=="beforeItem"?0:1);a<r;a++){if(this.itForUpload.hasItem(s.childNodes[a].getAttribute("bx-bxu-item-id"))){o=s.childNodes[a].getAttribute("bx-bxu-item-id");break}}if(o===null)d="inTheEnd"}var l=this.itForUpload.removeItem(e.getAttribute("bx-bxu-item-id"));if(d!="inTheEnd")this.itForUpload.insertBeforeItem(l.id,l,o);else this.itForUpload.setItem(l.id,l)}e.parentNode.removeChild(e);if(i.number<=e.number){i.parentNode.insertBefore(e,i)}else if(i.nextSibling){i.parentNode.insertBefore(e,i.nextSibling)}else{i.parentNode.appendChild(e)}}return true},deleteItem:function(i,s){var r=this.getItem(i),a;if(r&&(!this.placeHolder||(a=r.node)&&a)){if(!!a){if(!!e["jsDD"]){a.onmousedown=null;a.onbxdragstart=null;a.onbxdragstop=null;a.onbxdrag=null;a.onbxdraghout=null;a.onbxdestdraghover=null;a.onbxdestdraghout=null;a.onbxdestdragfinish=null;a.__bxpos=null;e.jsDD.arObjects[a.__bxddid]=null;delete e.jsDD.arObjects[a.__bxddid];e.jsDD.arDestinations[a.__bxddeid]=null;delete e.jsDD.arDestinations[a.__bxddeid]}t.unbindAll(a);a.parentNode.removeChild(a)}this.items.removeItem(i);this.itUploaded.removeItem(i);this.itFailed.removeItem(i);this.itForUpload.removeItem(i);t.onCustomEvent(this.uploader,"onQueueIsChanged",[this,"add",i,s]);return true}return false},reinitItem:function(i,s){var r,a;if(!!this.placeHolder&&this.items.hasItem(i)&&(r=t(i+"Item"))&&r){a=s.makeThumb();if(t.type.isNotEmptyString(a)){if(this.thumb.tagName=="TR"){a=a.replace(/[\n\t]/gi,"").replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1");if(!!a["trim"])a=a.trim();var d=function(e,t,i){var s=r.insertCell(-1),a={colspan:true,headers:true,accesskey:true,"class":true,contenteditable:true,contextmenu:true,dir:true,hidden:true,id:true,lang:true,spellcheck:true,style:true,tabindex:true,title:true,translate:true},d;s.innerHTML=i;t=t.split(" ");while((d=t.pop())&&d){d=d.split("=");if(d.length==2){d[0]=d[0].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");d[1]=d[1].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");if(a[d[0]]===true)s.setAttribute(d[0],d[1]);else s[d[0]]=d[1]}}return""},o=/^<td(.*?)>(.*?)<\/td>/i;e.data1=a;while(o.test(a))a=a.replace(o,d)}else{r.innerHTML=a}}else if(t.type.isDomNode(a)){while(t(r.firstChild)){t.remove(r.firstChild)}t.adjust(r,{children:[a]})}t.onCustomEvent(this.uploader,"onFileIsAppended",[s.id,s,this.caller]);t.onCustomEvent(s,"onFileIsAppended",[s.id,s,this.caller])}},finishQueue:function(){},clear:function(){var e;while((e=this.items.getFirst())&&!!e)this.deleteItem(e.id,e)},restoreFiles:function(e,i,s){i=i===true;var r=e.getFirst();while(r){if(this.items.hasItem(r.id)&&(s===true||!this.itUploaded.hasItem(r.id))&&(i||!this.itFailed.hasItem(r.id))){if(this.itFailed.hasItem(r.id)||s===true){delete r["uploadStatus"];delete r.file["uploadStatus"];delete r.file["firstChunk"];delete r.file["package"];delete r.file["packages"];if(r.file["copies"]){r.file["copies"].reset();var a;while((a=r.file["copies"].getNext())&&a){delete a["uploadStatus"];delete a["firstChunk"];delete a["package"];delete a["packages"]}r.file["copies"].reset()}r["restored"]="Y"}else{r["restored"]="C"}this.itFailed.removeItem(r.id);this.itUploaded.removeItem(r.id);this.itForUpload.setItem(r.id,r);t.onCustomEvent(r,"onUploadRestore",[r])}r=e.getNext()}}};return i})(window);
//# sourceMappingURL=queue.map.js