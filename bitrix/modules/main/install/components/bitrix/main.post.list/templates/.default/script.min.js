(function(window){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["FCList"])return;var safeEditing=true,safeEditingCurrentObj=null,quoteData=null;window.FCList=function(e,t){this.CID=e["CID"];this.ENTITY_XML_ID=e["ENTITY_XML_ID"];this.container=e["container"];this.nav=e["nav"];this.mid=e["mid"];this.order=e["order"];this.status="ready";this.msg=!!this.nav?this.nav.innerHTML:"";this.params=!!t?t:{};this.pullNewRecords={};this.rights=e["rights"];if(!!e["params"]["NOTIFY_TAG"]&&!!e["params"]["NOTIFY_TEXT"]&&!!window["UC"]["Informer"]){BX.addCustomEvent(window,"OnUCCommentWasPulled",BX.delegate(function(t,i){if(this.ENTITY_XML_ID==t[0]){window["UC"]["Informer"].check(t,i,e["params"]["NOTIFY_TAG"],e["params"]["NOTIFY_TEXT"])}},this));window["UC"]["InformerTags"][e["params"]["NOTIFY_TAG"]]=!!window["UC"]["InformerTags"][e["params"]["NOTIFY_TAG"]]?window["UC"]["InformerTags"][e["params"]["NOTIFY_TAG"]]:[]}BX.bind(this.nav,"click",BX.proxy(function(e){BX.PreventDefault(e);this.get();return false},this));BX.addCustomEvent(window,"OnUCUserIsWriting",BX.delegate(function(t,i){if(this.ENTITY_XML_ID==t){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/activity.php",method:"POST",dataType:"json",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),PATH_TO_USER:e["params"]["PATH_TO_USER"],AVATAR_SIZE:e["params"]["AVATAR_SIZE"],NAME_TEMPLATE:e["params"]["NAME_TEMPLATE"],SHOW_LOGIN:e["params"]["SHOW_LOGIN"]}})}},this));BX.addCustomEvent(window,"OnUCAfterRecordAdd",BX.delegate(function(e,t){if(this.ENTITY_XML_ID==e){this.add(t["messageId"],t,true,"simple")}},this));BX.addCustomEvent(window,"OnUCFormSubmit",BX.delegate(function(e,t,i,s){if(this.ENTITY_XML_ID==e){this.pullNewRecords[e+"-0"]="busy"}},this));BX.addCustomEvent(window,"OnUCFormResponse",BX.delegate(function(e,t,i,s){if(this.ENTITY_XML_ID==e){this.pullNewRecords[e+"-0"]="ready";this.pullNewRecords[e+"-"+t]="done"}},this));BX.addCustomEvent(window,"OnUCUserQuote",BX.delegate(function(e){if(this.ENTITY_XML_ID==e&&this.quote&&this.quote.popup){this.quote.popup.hide()}},this));if(location.hash&&parseInt(location.hash.replace("#com",""))>0)this.checkHash(parseInt(location.hash.replace("#com","")));if(e["params"]["SHOW_FORM"]=="Y"){this.quote.show=BX.delegate(function(e,t){setTimeout(BX.delegate(function(){this.quoteShow(e,t)},this),50)},this);var i=BX("record-"+this.ENTITY_XML_ID+"-new"),s=BX.findChildren(i.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);s=!!s?s:[];s.push(i);if(!!this.container)s.push(this.container);for(var o=0;o<s.length;o++){BX.bind(s[o],"mouseup",this.quote.show)}}BX.addCustomEvent(window,"onQuote"+this.ENTITY_XML_ID,this.quote.show)};window.FCList.prototype={quote:{show:BX.DoNothing(),popup:null},quoteCheck:function(){var e="",t,i=null;if(window.getSelection){t=window.getSelection();e=t.toString()}else if(document.selection){t=document.selection;e=t.createRange().text}if(e!=""){var s=BX("record-"+this.ENTITY_XML_ID+"-new"),o=BX.findParent(t.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode),a=BX.findParent(t.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},s.parentNode);if(o!=a||BX(o)&&!o.hasAttribute("id")){e=""}else if(BX(o)){var n=BX(o.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(n){i={id:parseInt(n.getAttribute("bx-mpl-author-id")),name:n.getAttribute("bx-mpl-author-name")}}}}if(e==""){if(!!this.quote.popup)this.quote.popup.hide();return false}return{text:e,author:i}},quoteShow:function(e,t){t=!!t?t:this.quoteCheck();if(!t||!t["text"]){quoteData=null;return false}quoteData=t;if(this.quote.popup==null){this.quote.popup=new MPLQuote({id:this.ENTITY_XML_ID,closeByEsc:true,autoHide:true,autoHideTimeout:2500,events:{click:BX.delegate(function(e){BX.PreventDefault(e);safeEditingCurrentObj=safeEditing;BX.onCustomEvent(window,"OnUCUserQuote",[this.ENTITY_XML_ID,t["author"],t["text"],safeEditingCurrentObj]);this.quote.popup.hide()},this)},classEvents:{onQuoteHide:BX.proxy(function(){quoteData=null;this.quote.popup=null},this)}})}this.quote.popup.show(e)},display:function(e,t){var i=0,s=0,o=0,a=this.container;e=e=="hide"?"hide":"show";if(e=="hide"){i=this.container.offsetHeight;o=1*i/2e3;o=o<.3?.3:o>.5?.5:o;a.style.overflow="hidden";new BX.easing({duration:o*1e3,start:{height:i,opacity:100},finish:{height:s,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.maxHeight=e.height+"px";a.style.opacity=e.opacity/100},complete:function(){a.style.cssText="";a.style.display="none"}}).animate()}else{i=!!t?t:20;a.style.display="block";a.style.overflow="hidden";a.style.maxHeight=i;s=this.container.offsetHeight;o=1*(s-i)/(2e3-i);o=o<.3?.3:o>.8?.8:o;new BX.easing({duration:o*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:s,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.maxHeight=e.height+"px";a.style.opacity=e.opacity/100},complete:function(){a.style.cssText="";a.style.maxHeight="none"}}).animate()}},get:function(){if(this.status=="done"){if(this.nav.getAttribute("bx-visibility-status")=="visible"){this.display("hide");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.display("show");BX.adjust(this.nav,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.send()}return false},send:function(){this.status="busy";BX.addClass(this.nav,"feed-com-all-hover");var e=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()}),t=BX.util.htmlspecialcharsback(this.nav.getAttribute("href"));t=t.indexOf("#")!==-1?t.substr(0,t.indexOf("#")):t;BX.ajax({url:t+(t.indexOf("?")!==-1?"&":"?")+e,method:"GET",dataType:"json",data:"",onsuccess:BX.proxy(this.build,this),onfailure:BX.proxy(function(){this.status="done";this.wait("hide")},this)})},build:function(e){this.status="ready";this.wait("hide");BX.removeClass(this.nav,"feed-com-all-hover");if(!!e&&e["status"]==true){var t=!!e["navigation"]?BX.create("DIV",{html:e["navigation"]}):null,i=BX.processHTML(e["messageList"],false);var s=this.container.offsetHeight;if(this.order=="ASC")this.container.innerHTML=this.container.innerHTML+i.HTML;else this.container.innerHTML=i.HTML+this.container.innerHTML;BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.display("show",s);if(!!t)t=t.firstChild;if(!!t)BX.adjust(this.nav,{attrs:{href:t.getAttribute("href")},html:t.innerHTML});else{BX.adjust(this.nav,{attrs:{href:"javascript:void(0);","bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")});this.status="done"}var o=0,a=BX.delegate(function(){o++;if(o<100){if(this.container.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(a)()}},this);BX.defer(a)()}},wait:function(e){e=e=="show"?"show":"hide"},reply:function(e){safeEditingCurrentObj=safeEditing;if(!!e)BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,e.getAttribute("bx-mpl-author-id"),e.getAttribute("bx-mpl-author-name"),safeEditingCurrentObj]);else BX.onCustomEvent(window,"OnUCUserReply",[this.ENTITY_XML_ID,undefined,undefined,safeEditingCurrentObj])},add:function(e,t,i,s){if(!(!!t&&!!e&&parseInt(e[1])>0))return false;var o=BX("record-"+e.join("-")+"-cover"),a=!!t["message"]?t["message"]:fcParseTemplate({messageFields:t["messageFields"]},{DATA_TIME_FORMAT:this.DATA_TIME_FORMAT,RIGHTS:this.rights}),n=BX.processHTML(a,false),r;if(!!o){if(!!i){o.parentNode.insertBefore(BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},html:n.HTML}),o);BX.remove(o)}}else{o=BX("record-"+e[0]+"-new");var d=["MODERATE","EDIT","DELETE"],l=false;for(var c in d){if(this.rights[d[c]]=="OWNLAST"){l=true;break}}if(l){r=!!o.lastChild&&o.lastChild.className=="feed-com-block-cover"?[o.lastChild]:[];if(this.addCheckPreviousNodes!==true){r=BX.findChildren(o.parentNode,{tagName:"DIV",className:"feed-com-block-cover"},false);var u=BX.findChildren(o,{tagName:"DIV",className:"feed-com-block-cover"},false),h,p;r=!!r?r:[];u=!!u?u:[];while(u.length>0&&(h=u.pop())&&!!h)r.push(h);this.addCheckPreviousNodes=true}while(h=r.pop()){p=BX(h.id.replace("-cover","-actions"));if(!!p){if(this.rights["EDIT"]=="OWNLAST")p.setAttribute("bx-mpl-edit-show","N");if(this.rights["MODERATE"]=="OWNLAST")p.setAttribute("bx-mpl-moderate-show","N");if(this.rights["DELETE"]=="OWNLAST")p.setAttribute("bx-mpl-delete-show","N")}}}o.appendChild(BX.create("DIV",{attrs:{id:"record-"+e.join("-")+"-cover",className:"feed-com-block-cover"},style:{opacity:0,height:0,overflow:"hidden"},html:n.HTML}));var E=BX("record-"+e.join("-")+"-cover");if(!!E){if(s!=="simple"){var T=BX.pos(E),f=BX.GetWindowScrollPos(),m=BX.GetWindowInnerSize();new BX.easing({duration:1e3,start:{opacity:0,height:0},finish:{opacity:100,height:E.scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){E.style.height=e.height+"px";E.style.opacity=e.opacity/100;if(f.scrollTop>0&&T.top<f.scrollTop+m.innerHeight)window.scrollTo(0,f.scrollTop+e.height)},complete:function(){E.style.cssText=""}}).animate()}else{new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:E.scrollHeight,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(e){E.style.height=e.height+"px";E.style.opacity=e.opacity/100},complete:function(){E.style.cssText=""}}).animate()}}}var X=0,B=function(){X++;if(X<100){var t=BX("record-"+e.join("-")+"-cover");if(t&&t.childNodes.length>0)BX.ajax.processScripts(n.SCRIPT);else BX.defer(B)()}};BX.defer(B)();BX.onCustomEvent(window,"OnUCRecordHaveDrawn",[this.ENTITY_XML_ID,t]);BX.onCustomEvent(window,"OnUCFeedChanged",[e]);return true},pullNewAuthor:function(e,t,i){BX.onCustomEvent(window,"OnUCUsersAreWriting",[this.ENTITY_XML_ID,e,t,i])},pullNewRecord:function(e){var t=[this.ENTITY_XML_ID,parseInt(e["ID"])];if(!!BX("record-"+t.join("-")+"-cover"))return true;else if(!!this.pullNewRecords[t.join("-")]&&this.pullNewRecords[t.join("-")]=="busy")return true;else if(!!this.pullNewRecords[t[0]+"-0"]&&this.pullNewRecords[t[0]+"-0"]=="busy")return setTimeout(BX.proxy(function(){this.pullNewRecord(e)},this),100);BX.onCustomEvent(window,"OnUCBeforeCommentWillBePulled",[t,e]);var i=!!e["URL"]&&!!e["URL"]["LINK"];if(i&&!!this.rights){i=false;if(e["APPROVED"]!="Y"){if(this.rights["MODERATE"]=="Y")i=true;else return false}}if(e["NEED_REQUEST"]=="Y")i=true;if(i){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH"))e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"));this.pullNewRecords[t.join("-")]="busy";var s=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()}),o=e["URL"]["LINK"];o=o.indexOf("#")!==-1?o.substr(0,o.indexOf("#")):o;BX.ajax({url:o+(o.indexOf("?")!==-1?"&":"?")+s,method:"GET",dataType:"json",data:"",onsuccess:BX.delegate(function(i){if(!!BX("record-"+t.join("-")+"-cover"))return;this.add([this.ENTITY_XML_ID,parseInt(e["ID"])],i);var s=BX("record-"+t.join("-")+"-cover"),o=BX.findChild(s,{className:"feed-com-block"},true,false);BX.addClass(s,"comment-new-answer");BX.addClass(o,"feed-com-block-pointer-to-new feed-com-block-new");this.pullNewRecords[t.join("-")]="done";if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),BX.hasClass(o,"feed-com-block-new")?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,i])},this)})}else{if(e&&!(e["AUTHOR"]&&e["AUTHOR"]["ID"]+""==BX.message("USER_ID")+""))e["NEW"]="Y";this.add(t,{messageFields:e});var a=BX("record-"+t.join("-")+"-cover"),n=BX.findChild(a,{className:"feed-com-block"},true,false);if(BX("record-"+t[0]+"-corner")){BX.addClass(BX("record-"+t[0]+"-corner"),e["NEW"]=="Y"?"feed-post-block-yellow-corner":"");BX("record-"+t[0]+"-corner").removeAttribute("id")}BX.addClass(a,"comment-new-answer");if(e["NEW"]=="Y"){BX.addClass(n,"feed-com-block-pointer-to-new feed-com-block-new")}this.pullNewRecords[t.join("-")]="done";BX.onCustomEvent(window,"OnUCCommentWasPulled",[t,{messageFields:e}])}return true},act:function(url,id,act){if(url.substr(0,1)!="/"){try{eval(url);return false}catch(e){}if(BX.type.isFunction(url)){url(this,id,act);return false}}fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+id+"-actions"));act=act==="EDIT"?"EDIT":act==="DELETE"?"DELETE":"MODERATE";id=parseInt(id);var data=BX.ajax.prepareData({sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ENTITY_XML_ID:this.ENTITY_XML_ID});url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+data,data:"",dataType:"json",onsuccess:BX.proxy(function(e){fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+id).firstChild);if(!!e&&typeof e=="object"&&e["status"]){if(act!=="EDIT"){var t=BX("record-"+this.ENTITY_XML_ID+"-"+id+"-cover");if(!!e["message"]&&!!t){var i=BX.processHTML(e["message"],false);t.innerHTML=i.HTML;var s=0,o=function(){s++;if(s<100){if(t.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(o)()}};BX.defer(o)();e["okMessage"]=""}else if(act=="DELETE"&&!!e["okMessage"]){BX.hide(BX("record-"+this.ENTITY_XML_ID+"-"+id))}}BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,e,act]);BX.onCustomEvent(window,"OnUCFeedChanged",[id])}this.busy=false},this),onfailure:BX.delegate(function(){fcCloseWait()},this)});return false},checkHash:function(e){var t=[this.ENTITY_XML_ID,e],i=BX("record-"+t.join("-")+"-cover");if(!!i){var s=BX.pos(i);window.scrollTo(0,s["top"]);i=BX.findChild(i,{className:"feed-com-block"},true,false);BX.removeClass(i,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(i,"feed-com-block-pointer")}}};window.FCList.getQuoteData=function(){return quoteData};window["fcExpandComment"]=function(e,t){if(!BX("record-"+e+"-text")){return false}var i=BX("record-"+e+"-text"),s=i.parentNode,o=200,a=i.offsetHeight,n={height:o},r={height:a};if(!!t)BX.remove(t);var d=1*(a-o)/(2e3-o);d=d<.3?.3:d>.8?.8:d;s.style.maxHeight=n.height+"px";s.style.overflow="hidden";new BX.easing({duration:d*1e3,start:n,finish:r,transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.maxHeight=e.height+"px";s.style.opacity=e.opacity/100},complete:function(){s.style.cssText="";s.style.maxHeight="none";BX.LazyLoad.showImages(true)}}).animate();BX.onCustomEvent(window,"OnUCFeedChanged",[e.split("-")])};var lastWaitElement=null;window["fcShowWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;if(BX.type.isElementNode(e)){BX.defer(function(){e.disabled=true})();var t=BX.findParent(e,BX.is_relative);e.bxwaiter=(t||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=e;return e.bxwaiter}return true};window["fcCloseWait"]=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||lastWaitElement||this;if(BX.type.isElementNode(e)){if(e.bxwaiter&&e.bxwaiter.parentNode){e.bxwaiter.parentNode.removeChild(e.bxwaiter);e.bxwaiter=null}e.disabled=false;if(lastWaitElement==e)lastWaitElement=null}};window["fcShowActions"]=function(e,t,i){var s=[];if(i.getAttribute("bx-mpl-view-show")=="Y"){s.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\#(.+)$/gi,"")+"#com"+t});s.push({text:'<span id="record-popup-'+e+"-"+t+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>",onclick:function(){var s="record-popup-"+e+"-"+t+"-link",o=BX.proxy_context,a=parseInt(!!o.getAttribute("bx-height")?o.getAttribute("bx-height"):o.offsetHeight);if(o.getAttribute("bx-status")!="shown"){o.setAttribute("bx-status","shown");if(!BX(s)&&!!BX(s+"-text")){var n=BX(s+"-text"),r=BX.pos(n),d=BX.pos(n.parentNode),l=BX.findChildren(n.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true),c=i.getAttribute("bx-mpl-view-url").replace(/\#(.+)$/gi,"")+"#com"+t;r["height"]=d["height"]-1;if(l){var u=0,h;for(var p=0;p<l.length;p++){h=BX.pos(l[p]);u=Math.max(u,h["width"])}d["width"]=u}BX.adjust(o,{attrs:{"bx-height":o.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:s},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:s+"-input",type:"text",value:(c.indexOf("http")<0?location.protocol+"//"+location.host:"")+c},style:{height:d["height"]+"px",width:d["width"]+"px"},events:{click:function(e){this.select();BX.PreventDefault(e)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate(function(e){this.style.height=e+"px"},o)}).start();BX.fx.show(BX(s),.2);BX(s+"-input").select()}else{o.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:o.offsetHeight,finish:a,callback:BX.delegate(function(e){this.style.height=e+"px"},o)}).start();BX.fx.hide(BX(s),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y")s.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-edit-url"),t,"EDIT");this.popupWindow.close();return false}});if(i.getAttribute("bx-mpl-moderate-show")=="Y")s.push({text:i.getAttribute("bx-mpl-moderate-approved")=="hidden"?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){window["UC"][e].act(i.getAttribute("bx-mpl-moderate-url"),t,"MODERATE");this.popupWindow.close()}});if(i.getAttribute("bx-mpl-delete-show")=="Y")s.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM")))window["UC"][e].act(i.getAttribute("bx-mpl-delete-url"),t,"DELETE");this.popupWindow.close();return false}});if(s.length>0){for(var o in s)s[o]["className"]="blog-comment-popup-menu";BX.PopupMenu.show("action-"+e+"-"+t,i,s,{offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(i){this.destroy();BX.PopupMenu.Data["action-"+e+"-"+t]=null}}})}};window["fcParseTemplate"]=function(data,params){params=!!params?params:{};params["DATE_TIME_FORMAT"]=!!params["DATE_TIME_FORMAT"]?params["DATE_TIME_FORMAT"]:"d F Y G:i";params["TIME_FORMAT"]=!!params["DATE_TIME_FORMAT"]&&params["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";var ii=0,res=!!data&&!!data["messageFields"]?data["messageFields"]:data,replacement={ID:"",FULL_ID:"",ENTITY_XML_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_EXTRANET_STYLE:""},txt=BX.message("MPL_RECORD_TEMPLATE");if(!!res&&!!data["messageFields"]){res["URL"]=!!res["URL"]?res["URL"]:{};res["AUTHOR"]=!!res["AUTHOR"]?res["AUTHOR"]:{};res["PANELS"]=!!res["PANELS"]?res["PANELS"]:{};replacement={ID:res["ID"],FULL_ID:res["FULL_ID"].join("-"),ENTITY_XML_ID:res["ENTITY_XML_ID"],NEW:res["NEW"]=="Y"?"new":"old",APPROVED:res["APPROVED"]!="Y"?"hidden":"approved",DATE:res["POST_DATE"],TEXT:res["POST_MESSAGE_TEXT"],CLASSNAME:res["CLASSNAME"]?" "+res["CLASSNAME"]:"",VIEW_URL:res["URL"]["LINK"],VIEW_SHOW:!!res["URL"]["LINK"]?"Y":"N",EDIT_URL:res["URL"]["EDIT"],EDIT_SHOW:!!res["PANELS"]["EDIT"]&&!!res["URL"]["EDIT"]?res["PANELS"]["EDIT"]:"N",MODERATE_URL:res["URL"]["MODERATE"],MODERATE_SHOW:!!res["PANELS"]["MODERATE"]&&!!res["URL"]["MODERATE"]?res["PANELS"]["MODERATE"]:"N",DELETE_URL:res["URL"]["DELETE"],DELETE_SHOW:!!res["PANELS"]["DELETE"]&&!!res["URL"]["DELETE"]?res["PANELS"]["DELETE"]:"N",BEFORE_HEADER:res["BEFORE_HEADER"],BEFORE_ACTIONS:res["BEFORE_ACTIONS"],AFTER_ACTIONS:res["AFTER_ACTIONS"],AFTER_HEADER:res["AFTER_HEADER"],BEFORE:res["BEFORE"],AFTER:res["AFTER"],BEFORE_RECORD:res["BEFORE_RECORD"],AFTER_RECORD:res["AFTER_RECORD"],AUTHOR_ID:res["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!res["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!res["AUTHOR"]["AVATAR"]?res["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_URL:window.mplReplaceUserPath(res["AUTHOR"]["URL"]),AUTHOR_NAME:res["AUTHOR"]["NAME"],AUTHOR_EXTRANET_STYLE:!!res["AUTHOR"]["IS_EXTRANET"]?" feed-com-name-extranet":""};if(!!res["POST_TIMESTAMP"]){res["POST_TIMESTAMP"]=parseInt(res["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));if(BX.date.format("d F Y",res["POST_TIMESTAMP"])==BX.date.format("d F Y"))replacement["DATE"]=BX.date.format(params["TIME_FORMAT"],res["POST_TIMESTAMP"],false,true);else replacement["DATE"]=BX.date.format(params["DATE_TIME_FORMAT"],res["POST_TIMESTAMP"],false,true)}if(!!params["RIGHTS"]){var acts=["MODERATE","EDIT","DELETE"],act="";for(ii in acts){act=acts[ii];if(!!params["RIGHTS"][act]&&params["RIGHTS"][act]!="N"&&!!replacement[act+"_URL"]){if((params["RIGHTS"][act]=="OWN"||params["RIGHTS"][act]=="OWNLAST")&&parseInt(BX.message("USER_ID"))>0&&BX.message("USER_ID")==res["AUTHOR"]["ID"]||params["RIGHTS"][act]=="ALL"||params["RIGHTS"][act]=="Y"){replacement[act+"_SHOW"]="Y"}}}}}else{for(ii in replacement){replacement[ii]=!!data[ii]?data[ii]:replacement[ii]}}for(ii in replacement){replacement[ii]=!!replacement[ii]?replacement[ii]:""}replacement["SHOW_POST_FORM"]=!!BX("record-"+replacement["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var ij in replacement){eval("txt = txt.replace(/#"+ij+"#/g, replacement[ij])")}return txt};window["fcPull"]=function(e,t){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:e,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:t}})};BX.addCustomEvent(window,"OnUCCommentWasPulled",function(e){window["UC"]["PULLED"]=!!window["UC"]["PULLED"]?window["UC"]["PULLED"]:[];window["UC"]["PULLED"].push(e);if(!window["UC"]["PULLEDScreenData"]){var t=BX.GetWindowScrollPos();window["UC"]["PULLEDScreenData"]={scrollTop:t.scrollTop,time:(new Date).getTime()}}window["UC"]["PULLEDScreenData"]["checked"]=false;window["UC"]["PULLEDTimeout"]=!!window["UC"]["PULLEDTimeout"]?window["UC"]["PULLEDTimeout"]:0;if(window["UC"]["PULLEDTimeout"]<=0)window["UC"]["PULLEDTimeout"]=setTimeout(markReadComments,1e3)});window.markReadComments=function(){var e=BX.GetWindowScrollPos();if(e.scrollTop!=window["UC"]["PULLEDScreenData"]["scrollTop"]){window["UC"]["PULLEDScreenData"]["time"]=(new Date).getTime();window["UC"]["PULLEDScreenData"]["scrollTop"]=e.scrollTop;window["UC"]["PULLEDScreenData"]["checked"]=false}else if(!window["UC"]["PULLEDScreenData"]["checked"]&&(new Date).getTime()-window["UC"]["PULLEDScreenData"]["time"]>3e3){window["UC"]["PULLEDScreenData"]["time"]=(new Date).getTime();window["UC"]["PULLEDScreenData"]["checked"]=true;var t=0,i=BX.GetWindowInnerSize(),s=[],o,a,n;for(var r=0;r<window["UC"]["PULLED"].length;r++){o=BX("record-"+window["UC"]["PULLED"][r].join("-")+"-cover");a=BX.pos(o);if(a.top>=e.scrollTop&&a.top<=e.scrollTop+i.innerHeight-20){BX.removeClass(o,"comment-new-answer");n=BX.findChild(o,{className:"feed-com-block"},true,false);BX.removeClass(n,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(n,"feed-com-block-read");t++}else{s.push(window["UC"]["PULLED"][r])}}window["UC"]["PULLED"]=s;if(t>0)BX.onCustomEvent(window,"onCounterDecrement",[t])}if(window["UC"]["PULLED"].length>0)window["UC"]["PULLEDTimeout"]=setTimeout(markReadComments,1e3);else window["UC"]["PULLEDTimeout"]=0};var MPLQuote=function(e){this.params=e;this.id=e["id"];this.closeByEsc=!!e["closeByEsc"];this.autoHide=!!e["autoHide"];this.autoHideTimeout=!!e["autoHideTimeout"]?parseInt(e["autoHideTimeout"]):0;if(this.params.classEvents){for(var t in this.params.classEvents)if(this.params.classEvents.hasOwnProperty(t))BX.addCustomEvent(this,t,this.params.classEvents[t])}this.node=document.createElement("A");BX.adjust(this.node,{props:{id:this.id},style:{zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"javascript:void(0);"},events:this.params.events});document.body.appendChild(this.node)};MPLQuote.prototype={show:function(e){var t=this.getPosition(this.node,e);BX.adjust(this.node,{style:{top:t.y+"px",left:t.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&!this.isCloseByEscBinded){this.isCloseByEscBinded=BX.delegate(this._onKeyUp,this);BX.bind(document,"keyup",this.isCloseByEscBinded)}if(this.params.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){BX.bind(this.node,"click",this.cancelBubble);this.isAutoHideBinded=BX.delegate(this.hide,this);BX.bind(document,"click",this.isAutoHideBinded)},this),0)}if(this.autoHideTimeout>0&&this.autoHideTimeoutInt<=0){if(!this.autoHideTimeoutBinded)this.autoHideTimeoutBinded=BX.delegate(this.hide,this);this.autoHideTimeoutInt=setTimeout(this.autoHideTimeoutBinded,this.autoHideTimeout)}},hide:function(e){if(!this.isShown())return;if(e&&!(BX.getEventButton(e)&BX.MSLEFT))return true;this.node.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",this.isCloseByEscBinded);this.isCloseByEscBinded=false}if(this.autoHideTimeout>0){clearTimeout(this.autoHideTimeoutInt);this.autoHideTimeoutInt=0}setTimeout(BX.proxy(this._hide,this),0)},_hide:function(){BX.onCustomEvent(this,"onQuoteHide",[this]);if(this.params.autoHide&&this.isAutoHideBinded){BX.unbind(this.node,"click",this.cancelBubble);BX.unbind(document,"click",this.isAutoHideBinded);this.isAutoHideBinded=false}BX.remove(this.node)},getPosition:function(e,t){var i;if(t.pageX==null){var s=document.documentElement,o=document.body;var a=t.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s.clientLeft||0);var n=t.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s.clientTop||0);i={x:a,y:n}}else{i={x:t.pageX,y:t.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display=="block"},cancelBubble:function(e){if(!e)e=window.event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true},_onKeyUp:function(e){e=e||window.event;if(e.keyCode==27)this.hide(e)}};window.mplCheckForQuote=function(e,t,i,s){e=document.all?window.event:e;var o="",a,n=null;if(window.getSelection){a=window.getSelection();o=a.toString()}else if(document.selection){a=document.selection;o=a.createRange().text}if(o!=""){var r=BX.findParent(a.focusNode,{tagName:t.tagName,className:t.className},t),d=BX.findParent(a.anchorNode,{tagName:t.tagName,className:t.className},t);if(r!=d||r!=t){o=""}else{if(!!s&&BX(s,true)){var l=BX(s,true);if(!!l&&l.hasAttribute("bx-post-author-id")){n={id:parseInt(l.getAttribute("bx-post-author-id")),name:l.innerHTML}}}}}if(o!=""){BX.onCustomEvent(window,"onQuote"+i,[e,{text:o,author:n}]);return true}return false};window.mplReplaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return""}if(BX("MPL_IS_EXTRANET_SITE")=="Y"){e=e.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{e=e.replace("/extranet/contacts/personal/user/","/company/personal/user/")}e=e.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return e}})(window);
//# sourceMappingURL=script.map.js