BX.namespace("BX.Bizproc");if(typeof BX.Bizproc.doInlineTask==="undefined"){BX.Bizproc.doInlineTask=function(a,o,p){if(p){if(p.__waiting)return false;p.__waiting=true;if(BX.hasClass(p,"bp-button"))BX.addClass(p,"bp-button-wait")}if(!a||!a["TASK_ID"])return false;a["sessid"]=BX.bitrix_sessid();BX.ajax.post("/bitrix/tools/bizproc_do_task_ajax.php",a,function(){if(p){p.__waiting=false;BX.removeClass(p,"bp-button-wait")}if(o)o(arguments)});return false};BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.Bizproc.showTaskPopup=function(a,o,p,t,e){if(t){if(t.__waiting)return false;t.__waiting=true;if(BX.hasClass(t,"bp-button"))BX.addClass(t,"bp-button-wait")}BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.task/popup.php?site_id="+BX.message("SITE_ID")+"&TASK_ID="+a+(p?"&USER_ID="+p:"")+(e?"&IFRAME=Y":""),onsuccess:function(p){BX.load(["/bitrix/components/bitrix/bizproc.task/templates/.default/style.css"],function(){if(t){t.__waiting=false;BX.removeClass(t,"bp-button-wait")}var e=BX.create("div",{style:{width:"800px"}});e.innerHTML=p;BX.Bizproc.taskPopupInstance=new BX.PopupWindow("bp-task-popup-"+a+Math.round(Math.random()*1e5),null,{content:e,closeIcon:{right:"20px",top:"10px"},zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupShow:function(a){var o=BX.findChild(a.contentContainer,{"class":"bp-popup-title"},true);if(o){o.style.cursor="move";BX.bind(o,"mousedown",BX.proxy(a._startDrag,a))}},onPopupClose:function(a){a.destroy()}}});BX.Bizproc.taskPopupInstance.show();BX.Bizproc.taskPopupCallback=o})}});return false};BX.Bizproc.showWorkflowInfoPopup=function(a){BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.workflow.info/popup.php?site_id="+BX.message("SITE_ID")+"&WORKFLOW_ID="+a,onsuccess:function(o){BX.load(["/bitrix/components/bitrix/bizproc.workflow.info/templates/.default/style.css"],function(){var p=BX.create("div",{style:{width:"800px"}});p.innerHTML=o;var t=new BX.PopupWindow("bp-wfi-popup-"+a+Math.round(Math.random()*1e5),null,{content:p,closeIcon:{right:"20px",top:"10px"},zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupShow:function(a){var o=BX.findChild(a.contentContainer,{"class":"bp-popup-title"},true);if(o){o.style.cursor="move";BX.bind(o,"mousedown",BX.proxy(a._startDrag,a))}},onPopupClose:function(a){a.destroy()}}});t.show()})}});return false};BX.Bizproc.postTaskForm=function(a,o){if(a.BPRUNNING){return}BX.PreventDefault(o);a.action="/bitrix/tools/bizproc_do_task_ajax.php";a.BPRUNNING=true;var p,t,e=document.activeElement;if((!e||!e.type)&&o.explicitOriginalTarget){e=o.explicitOriginalTarget}if(!!e&&e.type&&e.type.toLowerCase()=="submit"&&!!e.name&&!!e.value){p=e.name;t=e.value}if(!a.target){if(null==a.BXFormTarget){var i="formTarget_"+Math.random();a.BXFormTarget=document.body.appendChild(BX.create("IFRAME",{props:{name:i,id:i,src:"javascript:void(0)"},style:{display:"none"}}))}a.target=a.BXFormTarget.name}var n=null;if(p){n=BX.findChild(a,{property:{type:"submit",name:p}},true)}if(n){BX.addClass(n,"bp-button-wait")}a.BXFormCallback=function(o){a.BPRUNNING=false;if(n){BX.removeClass(n,"bp-button-wait")}o=BX.parseJSON(o);if(o.ERROR)alert(o.ERROR);else{if(!!BX.Bizproc.taskPopupInstance)BX.Bizproc.taskPopupInstance.close();if(!!BX.Bizproc.taskPopupCallback)BX.Bizproc.taskPopupCallback()}};BX.bind(a.BXFormTarget,"load",BX.proxy(BX.ajax._submit_callback,a));BX.submit(a,p,t)}}if(typeof BX.Bizproc.WorkflowFaces==="undefined"){BX.Bizproc.WorkflowFaces={};BX.Bizproc.WorkflowFaces.showFaces=function(a,o,p,t){if(typeof o.__popup==="undefined"){o.__popup=new BX.PopupWindow("bp-wf-faces-"+Math.round(Math.random()*1e5),o,{lightShadow:true,offsetLeft:-51,offsetTop:3,zIndex:0,autoHide:true,closeByEsc:true,bindOptions:{position:"bottom"},angle:{position:"top",offset:78},content:BX.Bizproc.WorkflowFaces.createMenu(a,p,t)})}if(o.__popup.isShown())o.__popup.close();else o.__popup.show();return false};BX.Bizproc.WorkflowFaces.createMenu=function(a,o,p){var t,e,i=a.length,n;var s=[];for(t=0;t<i;++t){var r,l=a[t],c=[];for(e=0,n=l.USERS.length;e<n;++e){r="bp-popup-parallel-avatar-ready";if(l.USERS[e].STATUS=="0")r="";else if(l.USERS[e].STATUS=="2")r="bp-popup-parallel-avatar-cancel";var u=["<a>",'<span class="bp-popup-parallel-avatar '+r+'"><span>'+(l.USERS[e].PHOTO_SRC?'<img src="'+l.USERS[e].PHOTO_SRC+'" alt="">':"")+"</span></span>",'<span class="bp-popup-parallel-name" title="'+l.USERS[e].FULL_NAME+'">'+l.USERS[e].FULL_NAME+"</span>","</a>"];c.push(u.join(""))}var f=c.join("");if(i==1&&!p)s.push(f);else{r="bp-popup-parallel-avatar-ready";if(l.USERS[0].STATUS=="0")r="";else if(l.USERS[0].STATUS=="2")r="bp-popup-parallel-avatar-cancel";var B=['<a class="'+(c.length>1||o?"bp-popup-parallel-parent":"")+'">',!o?'<span class="bp-popup-parallel-avatar '+r+'"><span>'+(l.USERS[0].PHOTO_SRC?'<img src="'+l.USERS[0].PHOTO_SRC+'" alt="">':"")+"</span></span>":"",'<span class="bp-popup-parallel-name" title="'+l.NAME+'">'+(!o?l.USERS[0].FULL_NAME:l.NAME)+"</span>","</a>"];s.push('<div class="bp-popup-parallel-sub">'+B.join("")+(c.length>1||o?'<div class="bp-popup-parallel">'+f+"</div></div>":""))}}return'<div class="bp-popup-parallel">'+s.join("")+"</div>"}}
//# sourceMappingURL=tools.map.js