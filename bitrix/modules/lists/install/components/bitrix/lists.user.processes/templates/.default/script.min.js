BX.ListsProcessesClass=function(){var s=function(s){this.ajaxUrl="/bitrix/components/bitrix/lists.user.processes/ajax.php"};s.prototype.showProcesses=function(s){var e=BX("bx-lists-store_items"),t=[],a=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true);if(a.length){t=this.getMenuItems(a);this.showMoreMenuLists(t)}else{var i=null,r=null;if(BX("bx-lists-select-site-id")){i=BX("bx-lists-select-site-id").value}if(BX("bx-lists-select-site")){r=BX("bx-lists-select-site").value}BX.ajax({method:"POST",dataType:"json",url:this.addToLinkParam(this.ajaxUrl,"action","showProcesses"),data:{siteDir:r,siteId:i,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(s){if(s.status=="success"){for(var i in s.lists){e.appendChild(BX.create("span",{attrs:{"data-name":s.lists[i].name,"data-picture":s.lists[i].picture,"data-url":'document.location.href = "'+s.lists[i].url+'"'},props:{className:"feed-add-post-form-link-lists",id:"bx-lists-tab-create-processes"},style:{display:"none"}}))}a=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true);t=this.getMenuItems(a);this.showMoreMenuLists(t)}else{s.errors=s.errors||[{}];this.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}},this)})}};s.prototype.getMenuItems=function(s){var e=[];for(var t=0;t<s.length;t++){e.push({tabId:"lists",text:s[t].getAttribute("data-name"),className:"feed-add-post-form-lists",onclick:s[t].getAttribute("data-url")})}return e};s.prototype.showMoreMenuLists=function(s){var e=BX.PopupMenu.create("lists",BX("bx-lists-create-processes"),s,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var t=BX.findChildren(BX("popup-window-content-menu-popup-lists"),{tag:"span",className:"menu-popup-item-icon"},true),a=BX.findChildren(BX("bx-lists-store_items"),{tag:"span",className:"feed-add-post-form-link-lists"},true);for(var i=0;i<t.length;i++){t[i].innerHTML=a[i].getAttribute("data-picture")}e.popupWindow.show()};s.prototype.addToLinkParam=function(s,e,t){if(!s.length){return"?"+e+"="+t}s=BX.util.remove_url_param(s,e);if(s.indexOf("?")!=-1){return s+"&"+e+"="+t}return s+"?"+e+"="+t};s.prototype.showModalWithStatusAction=function(s,e){s=s||{};if(!s.message){if(s.status=="success"){s.message=BX.message("LISTS_JS_STATUS_ACTION_SUCCESS")}else{s.message=BX.message("LISTS_JS_STATUS_ACTION_ERROR")+". "+this.getFirstErrorFromResponse(s)}}var t=BX.create("div",{props:{className:"bx-lists-alert"},children:[BX.create("span",{props:{className:"bx-lists-aligner"}}),BX.create("span",{props:{className:"bx-lists-alert-text"},text:s.message}),BX.create("div",{props:{className:"bx-lists-alert-footer"}})]});var a=BX.PopupWindowManager.getCurrentPopup();if(a){a.destroy()}var i=setTimeout(function(){var s=BX.PopupWindowManager.getCurrentPopup();if(!s||s.uniquePopupId!="bx-lists-status-action"){return}s.close();s.destroy()},3e3);var r=BX.PopupWindowManager.create("bx-lists-status-action",null,{content:t,onPopupClose:function(){this.destroy();clearTimeout(i)},autoHide:true,zIndex:2e3,className:"bx-lists-alert-popup"});r.show();BX("bx-lists-status-action").onmouseover=function(s){clearTimeout(i)};BX("bx-lists-status-action").onmouseout=function(s){i=setTimeout(function(){var s=BX.PopupWindowManager.getCurrentPopup();if(!s||s.uniquePopupId!="bx-lists-status-action"){return}s.close();s.destroy()},3e3)}};return s}();
//# sourceMappingURL=script.map.js