BX.CatalogProcessesClass=function(){var t=function(t){this.ajaxUrl="/bitrix/components/bitrix/lists.catalog.processes/ajax.php";this.randomString=t.randomString};t.prototype.removeElement=function(t){return t.parentNode?t.parentNode.removeChild(t):t};t.prototype.addToLinkParam=function(t,e,s){if(!t.length){return"?"+e+"="+s}t=BX.util.remove_url_param(t,e);if(t.indexOf("?")!=-1){return t+"&"+e+"="+s}return t+"?"+e+"="+s};t.prototype.showModalWithStatusAction=function(t,e){t=t||{};if(!t.message){if(t.status=="success"){t.message=BX.message("LISTS_LCP_TEMPLATE_STATUS_ACTION_SUCCESS")}else{t.message=BX.message("LISTS_LCP_TEMPLATE_STATUS_ACTION_ERROR")+". "+this.getFirstErrorFromResponse(t)}}var s=BX.create("div",{props:{className:"bx-lists-alert"},children:[BX.create("span",{props:{className:"bx-lists-aligner"}}),BX.create("span",{props:{className:"bx-lists-alert-text"},text:t.message}),BX.create("div",{props:{className:"bx-lists-alert-footer"}})]});var o=BX.PopupWindowManager.getCurrentPopup();if(o){o.destroy()}var a=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-lists-status-action"){return}t.close();t.destroy()},3500);var n=BX.PopupWindowManager.create("bx-lists-status-action",null,{content:s,onPopupClose:function(){this.destroy();clearTimeout(a)},autoHide:true,zIndex:2e3,className:"bx-lists-alert-popup"});n.show();BX("bx-lists-status-action").onmouseover=function(t){clearTimeout(a)};BX("bx-lists-status-action").onmouseout=function(t){a=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t||t.uniquePopupId!="bx-lists-status-action"){return}t.close();t.destroy()},3500)}};t.prototype.show=function(t){if(this.getRealDisplay(t)!="none")return;var e=t.getAttribute("displayOld");t.style.display=e||"";if(this.getRealDisplay(t)==="none"){var s=t.nodeName,o=document.body,a;if(displayCache[s]){a=displayCache[s]}else{var n=document.createElement(s);o.appendChild(n);a=this.getRealDisplay(n);if(a==="none"){a="block"}o.removeChild(n);displayCache[s]=a}t.setAttribute("displayOld",a);t.style.display=a}};t.prototype.hide=function(t){if(!t.getAttribute("displayOld")){t.setAttribute("displayOld",t.style.display)}t.style.display="none"};t.prototype.getRealDisplay=function(t){if(t.currentStyle){return t.currentStyle.display}else if(window.getComputedStyle){var e=window.getComputedStyle(t,null);return e.getPropertyValue("display")}};t.prototype.modalWindow=function(t){t=t||{};t.title=t.title||false;t.bindElement=t.bindElement||null;t.overlay=typeof t.overlay=="undefined"?true:t.overlay;t.autoHide=t.autoHide||false;t.closeIcon=typeof t.closeIcon=="undefined"?{right:"20px",top:"10px"}:t.closeIcon;t.modalId=t.modalId||"lists_modal_window_"+(Math.random()*(2e5-100)+100);t.withoutContentWrap=typeof t.withoutContentWrap=="undefined"?false:t.withoutContentWrap;t.contentClassName=t.contentClassName||"";t.contentStyle=t.contentStyle||{};t.content=t.content||[];t.buttons=t.buttons||false;t.events=t.events||{};t.withoutWindowManager=!!t.withoutWindowManager||false;var e=[];if(t.title){e.push(BX.create("div",{props:{className:"bx-lists-popup-title"},text:t.title}))}if(t.withoutContentWrap){e=e.concat(t.content)}else{e.push(BX.create("div",{props:{className:"bx-lists-popup-content "+t.contentClassName},style:t.contentStyle,children:t.content}))}var s=[];if(t.buttons){for(var o in t.buttons){if(!t.buttons.hasOwnProperty(o)){continue}if(o>0){s.push(BX.create("SPAN",{html:"&nbsp;"}))}s.push(t.buttons[o])}e.push(BX.create("div",{props:{className:"bx-lists-popup-buttons"},children:s}))}var a=BX.create("div",{props:{className:"bx-lists-popup-container"},children:e});t.events.onPopupShow=BX.delegate(function(){if(s.length){firstButtonInModalWindow=s[0];BX.bind(document,"keydown",BX.proxy(this._keyPress,this))}if(t.events.onPopupShow)BX.delegate(t.events.onPopupShow,BX.proxy_context)},this);var n=t.events.onPopupClose;t.events.onPopupClose=BX.delegate(function(){firstButtonInModalWindow=null;try{BX.unbind(document,"keydown",BX.proxy(this._keypress,this))}catch(e){}if(n){BX.delegate(n,BX.proxy_context)()}if(t.withoutWindowManager){delete windowsWithoutManager[t.modalId]}BX.proxy_context.destroy()},this);var i;if(t.withoutWindowManager){if(!!windowsWithoutManager[t.modalId]){return windowsWithoutManager[t.modalId]}i=new BX.PopupWindow(t.modalId,t.bindElement,{content:a,closeByEsc:true,closeIcon:t.closeIcon,autoHide:t.autoHide,overlay:t.overlay,events:t.events,buttons:[],zIndex:isNaN(t["zIndex"])?0:t.zIndex});windowsWithoutManager[t.modalId]=i}else{i=BX.PopupWindowManager.create(t.modalId,t.bindElement,{content:a,closeByEsc:true,closeIcon:t.closeIcon,autoHide:t.autoHide,overlay:t.overlay,events:t.events,buttons:[],zIndex:isNaN(t["zIndex"])?0:t.zIndex})}i.show();return i};t.prototype.installProcesses=function(t){BX.addClass(t,"webform-small-button-wait");t.setAttribute("onclick","");var e=BX.findChildrenByClassName(BX("bx-lists-lcp-total-div"),"bx-lists-lcp-table-tr-mousedown");var s=[];for(var o in e){s.push(e[o].getAttribute("data-file"))}var a=null;if(BX("bx-lists-lcp-site-id")){a=BX("bx-lists-lcp-site-id").value}BX.ajax({method:"POST",dataType:"json",url:this.addToLinkParam(this.ajaxUrl,"action","installProcesses"),data:{siteId:a,processes:s,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(s){if(s.status=="success"){for(var o in e){e[o].setAttribute("id","not allocated");e[o].setAttribute("data-pick-out","not allocated");e[o].setAttribute("class","bx-lists-lcp-table-tr-mouseout");var a=BX.findChildrenByClassName(e[o],"bx-lists-lcp-table-td-name");for(var n=0;n<a.length;n++){a[n].innerHTML=a[n].innerHTML+BX.message("LISTS_LCP_TEMPLATE_PROCESS_INSTALLED")}}this.showModalWithStatusAction({status:"success",message:s.message})}else{s.errors=s.errors||[{}];this.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}BX.removeClass(t,"webform-small-button-wait");t.setAttribute("onclick",'BX["CatalogProcessesClass_'+this.randomString+'"].installProcesses(this);')},this)})};t.prototype.mousedown=function(t){var e=t.getAttribute("data-pick-out");if(e=="allocate"){if(t.className=="bx-lists-lcp-table-tr-mousedown"){t.className="bx-lists-lcp-table-tr-mouseout"}else{t.className="bx-lists-lcp-table-tr-mousedown"}}};t.prototype.mouseover=function(t){var e=t.getAttribute("data-pick-out");if(e=="allocate"){if(t.className!="bx-lists-lcp-table-tr-mousedown"){t.className="bx-lists-lcp-table-tr-mouseover"}}};t.prototype.mouseout=function(t){var e=t.getAttribute("data-pick-out");if(e=="allocate"){if(t.className!="bx-lists-lcp-table-tr-mousedown"){t.className="bx-lists-lcp-table-tr-mouseout"}}};return t}();
//# sourceMappingURL=script.map.js