function updateBasketTable(e,t){var a=BX("basket_items"),s,i,l,r,n,_,o=false,u=false,c=false,d=false,p,T,f,A,b,B,E,X,v,m,I,y,S,D,U,k,C,N,h,O,g,L,P,R,M,x,F,Y,Q,H,w,V,K,W,j,G;if(!a||typeof t!=="object"){return}s=a.rows;r=s[s.length-1];p=t.PARAMS.QUANTITY_FLOAT==="Y";if(e!==null&&!!t.BASKET_DATA){i=t.BASKET_ID;l=t.BASKET_DATA.GRID.ROWS[i];_=t.COLUMNS.split(",");n=document.createElement("tr");T=BX(e);n.setAttribute("id",t.BASKET_ID);r.parentNode.insertBefore(n,T.nextSibling);if(t.DELETE_ORIGINAL==="Y"){T.parentNode.removeChild(T)}f=n.insertCell(-1);f.setAttribute("class","margin");for(A=0;A<_.length;A++){if(_[A]==="DELETE"){o=true}else if(_[A]==="DELAY"){u=true}else if(_[A]==="PROPS"){c=true}else if(_[A]==="TYPE"){d=true}}for(A=0;A<_.length;A++){switch(_[A]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":b=n.insertCell(-1);B="";E="";b.setAttribute("class","itemphoto");if(l.PREVIEW_PICTURE_SRC.length>0){B=l.PREVIEW_PICTURE_SRC}else if(l.DETAIL_PICTURE_SRC.length>0){B=l.DETAIL_PICTURE_SRC}else{B=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}if(l.DETAIL_PAGE_URL.length>0){E='<div class="bx_ordercart_photo_container">							<a href="'+l.DETAIL_PAGE_URL+'">								<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>							</a>						</div>"}else{E='<div class="bx_ordercart_photo_container">							<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>						</div>"}if(l.BRAND&&l.BRAND.length>0){E+='<div class="bx_ordercart_brand">							<img alt="" src="'+l.BRAND+'"/>						</div>'}b.innerHTML=E;X=n.insertCell(-1);v="";X.setAttribute("class","item");if(l["DETAIL_PAGE_URL"].length>0)v+='<h2 class="bx_ordercart_itemtitle"><a href="'+l["DETAIL_PAGE_URL"]+'">'+l["NAME"]+"</a></h2>";else v+='<h2 class="bx_ordercart_itemtitle">'+l["NAME"]+"</h2>";v+='<div class="bx_ordercart_itemart">';if(c){for(I=0;I<l["PROPS"].length;I++){y=l["PROPS"][I];if(l.SKU_DATA){m=false;for(S in l.SKU_DATA){if(l.SKU_DATA.hasOwnProperty(S)){D=l.SKU_DATA[S];if(D["CODE"]===y["CODE"]){m=true;break}}}if(m)continue}v+=y["NAME"]+":&nbsp;<span>"+y["VALUE"]+"</span><br/>"}}v+="</div>";if(l.SKU_DATA){for(S in l.SKU_DATA){if(l.SKU_DATA.hasOwnProperty(S)){D=l.SKU_DATA[S];U=false;k=BX.util.array_keys(D["VALUES"]).length>5?"full":"";for(N in D["VALUES"]){C=D["VALUES"][N];if(!!C&&typeof C==="object"&&!!C["PICT"]){U=true;break}}if(U){v+='<div class="bx_item_detail_scu_small_noadaptive '+k+'">';v+='<span class="bx_item_section_name_gray">'+D["NAME"]+"</span>";v+='<div class="bx_scu_scroller_container">';v+='<div class="bx_scu">';v+='<ul id="prop_'+D["CODE"]+"_"+l["ID"]+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';for(g in D["VALUES"]){h=D["VALUES"][g];O="";for(L=0;L<l["PROPS"].length;L++){P=l["PROPS"][L];if(P["CODE"]===D["CODE"]){if(P["VALUE"]===h["NAME"]||P["VALUE"]===h["XML_ID"])O="bx_active"}}v+='<li style="width:10%;"															class="sku_prop '+O+'"															data-value-id="'+h["XML_ID"]+'"															data-element="'+l["ID"]+'"															data-property="'+D["CODE"]+'"															>															<a href="javascript:void(0);">																<span style="background-image:url('+h["PICT"]["SRC"]+')"></span>															</a>														</li>'}v+="</ul>";v+="</div>";v+='<div class="bx_slide_left" onclick="leftScroll(\''+D["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(D["VALUES"]).length+');"></div>';v+='<div class="bx_slide_right" onclick="rightScroll(\''+D["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(D["VALUES"]).length+');"></div>';v+="</div>";v+="</div>"}else{v+='<div class="bx_item_detail_size_small_noadaptive '+k+'">';v+='<span class="bx_item_section_name_gray">'+D["NAME"]+"</span>";v+='<div class="bx_size_scroller_container">';v+='<div class="bx_size">';v+='<ul id="prop_'+D["CODE"]+"_"+l["ID"]+'" style="width: 200%; margin-left:0%;" class="sku_prop_list">';for(g in D["VALUES"]){h=D["VALUES"][g];O="";for(L=0;L<l["PROPS"].length;L++){P=l["PROPS"][L];if(P["CODE"]===D["CODE"]){if(P["VALUE"]===h["NAME"])O="bx_active"}}v+='<li style="width:10%;"															class="sku_prop '+O+'"															data-value-id="'+h["NAME"]+'"															data-element="'+l["ID"]+'"															data-property="'+D["CODE"]+'"															>															<a href="javascript:void(0);">'+h["NAME"]+"</span></a>														</li>"}v+="</ul>";v+="</div>";v+='<div class="bx_slide_left" onclick="leftScroll(\''+D["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(D["VALUES"]).length+');"></div>';v+='<div class="bx_slide_right" onclick="rightScroll(\''+D["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(D["VALUES"]).length+');"></div>';v+="</div>";v+="</div>"}}}}X.innerHTML=v;break;case"QUANTITY":R=n.insertCell(-1);M="";x=parseFloat(l["MEASURE_RATIO"])>0?l["MEASURE_RATIO"]:1;F=parseFloat(l["AVAILABLE_QUANTITY"])>0?'max="'+l["AVAILABLE_QUANTITY"]+'"':"";Y=false;if(x!=0&&x!=""){Q=l["QUANTITY"];l["QUANTITY"]=getCorrectRatioQuantity(l["QUANTITY"],x,p);if(Q!=l["QUANTITY"]){Y=true}}R.setAttribute("class","custom");M+="<span>"+getColumnName(t,_[A])+":</span>";M+='<div class="centered">';M+='<table cellspacing="0" cellpadding="0" class="counter">';M+="<tr>";M+="<td>";M+='<input type="text" size="3" id="QUANTITY_INPUT_'+l["ID"]+'"											name="QUANTITY_INPUT_'+l["ID"]+'"											size="2" maxlength="18" min="0" '+F+"step="+x+'											style="max-width: 50px"											value="'+l["QUANTITY"]+'"											onchange="updateQuantity(\'QUANTITY_INPUT_'+l["ID"]+"','"+l["ID"]+"', "+x+","+p+')"						>';M+="</td>";if(x!=0&&x!=""){M+='<td id="basket_quantity_control">							<div class="basket_quantity_control">								<a href="javascript:void(0);" class="plus" onclick="setQuantity('+l["ID"]+", "+x+", 'up', "+p+');"></a>								<a href="javascript:void(0);" class="minus" onclick="setQuantity('+l["ID"]+", "+x+", 'down', "+p+');"></a>							</div>						</td>'}if(l.hasOwnProperty("MEASURE_TEXT")&&l["MEASURE_TEXT"].length>0)M+='<td style="text-align: left">'+l["MEASURE_TEXT"]+"</td>";M+="</tr>";M+="</table>";M+="</div>";M+='<input type="hidden" id="QUANTITY_'+l["ID"]+'" name="QUANTITY_'+l["ID"]+'" value="'+l["QUANTITY"]+'" />';R.innerHTML=M;if(Y){updateQuantity("QUANTITY_INPUT_"+l["ID"],l["ID"],x,p)}break;case"PRICE":H=n.insertCell(-1);w=l["FULL_PRICE_FORMATED"]!=l["PRICE_FORMATED"]?l["FULL_PRICE_FORMATED"]:"";H.setAttribute("class","price");H.innerHTML+='<div class="current_price" id="current_price_'+l["ID"]+'">'+l["PRICE_FORMATED"]+"</div>";H.innerHTML+='<div class="old_price" id="old_price_'+l["ID"]+'">'+w+"</div>";if(d&&l["NOTES"].length>0){H.innerHTML+='<div class="type_price">'+basketJSParams["SALE_TYPE"]+"</div>";H.innerHTML+='<div class="type_price_value">'+l["NOTES"]+"</div>"}break;case"DISCOUNT":K=n.insertCell(-1);K.setAttribute("class","custom");K.innerHTML="<span>"+getColumnName(t,_[A])+":</span>";K.innerHTML+='<div id="discount_value_'+l["ID"]+'">'+l["DISCOUNT_PRICE_PERCENT_FORMATED"]+"</div>";break;case"WEIGHT":W=n.insertCell(-1);W.setAttribute("class","custom");W.innerHTML="<span>"+getColumnName(t,_[A])+":</span>";W.innerHTML+=l["WEIGHT_FORMATED"];break;default:j=n.insertCell(-1);G="";j.setAttribute("class","custom");j.innerHTML="<span>"+getColumnName(t,_[A])+":</span>";if(_[A]=="SUM")G+='<div id="sum_'+l["ID"]+'">';if(typeof l[_[A]]!="undefined"){G+=l[_[A]]}if(_[A]=="SUM")G+="</div>";j.innerHTML+=G;break}}if(o||u){var J=n.insertCell(-1);J.setAttribute("class","control");if(o)J.innerHTML='<a href="'+basketJSParams["DELETE_URL"].replace("#ID#",l["ID"])+'">'+basketJSParams["SALE_DELETE"]+"</a><br />";if(u)J.innerHTML+='<a href="'+basketJSParams["DELAY_URL"].replace("#ID#",l["ID"])+'">'+basketJSParams["SALE_DELAY"]+"</a>"}var q=n.insertCell(-1);q.setAttribute("class","margin");var z=BX.findChildren(BX(i),{tagName:"li",className:"sku_prop"},true);if(!!z&&z.length>0){for(A=0;z.length>A;A++){BX.bind(z[A],"click",BX.delegate(function(e){skuPropClickHandler(e)},this))}}}if(!!t.BASKET_DATA){for(V in t.BASKET_DATA.GRID.ROWS){if(t.BASKET_DATA.GRID.ROWS.hasOwnProperty(V)){var Z=t.BASKET_DATA.GRID.ROWS[V];if(BX("discount_value_"+V))BX("discount_value_"+V).innerHTML=Z.DISCOUNT_PRICE_PERCENT_FORMATED;if(BX("current_price_"+V))BX("current_price_"+V).innerHTML=Z.PRICE_FORMATED;if(BX("old_price_"+V))BX("old_price_"+V).innerHTML=Z.FULL_PRICE_FORMATED!=Z.PRICE_FORMATED?Z.FULL_PRICE_FORMATED:"";if(BX("sum_"+V))BX("sum_"+V).innerHTML=Z.SUM;if(BX("QUANTITY_"+V)){BX("QUANTITY_INPUT_"+V).value=Z.QUANTITY;BX("QUANTITY_INPUT_"+V).defaultValue=Z.QUANTITY;BX("QUANTITY_"+V).value=Z.QUANTITY}}}}if(!!t.BASKET_DATA)couponListUpdate(t.BASKET_DATA);if(t.hasOwnProperty("WARNING_MESSAGE")){var $="";for(A=t["WARNING_MESSAGE"].length-1;A>=0;A--)$+=t["WARNING_MESSAGE"][A]+"<br/>";BX("warning_message").innerHTML=$}if(!!t.BASKET_DATA){if(BX("allWeight_FORMATED"))BX("allWeight_FORMATED").innerHTML=t["BASKET_DATA"]["allWeight_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allSum_wVAT_FORMATED"))BX("allSum_wVAT_FORMATED").innerHTML=t["BASKET_DATA"]["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allVATSum_FORMATED"))BX("allVATSum_FORMATED").innerHTML=t["BASKET_DATA"]["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allSum_FORMATED"))BX("allSum_FORMATED").innerHTML=t["BASKET_DATA"]["allSum_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("PRICE_WITHOUT_DISCOUNT"))BX("PRICE_WITHOUT_DISCOUNT").innerHTML=t["BASKET_DATA"]["PRICE_WITHOUT_DISCOUNT"]!=t["BASKET_DATA"]["allSum_FORMATED"]?t["BASKET_DATA"]["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):"";BX.onCustomEvent("OnBasketChange")}}function couponCreate(e,t){var a="disabled";if(!BX.type.isElementNode(e))return;if(t.JS_STATUS==="BAD")a="bad";else if(t.JS_STATUS==="APPLYED")a="good";e.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:a,type:"text",value:t.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:true,readonly:true}}),BX.create("span",{props:{className:a},attrs:{"data-coupon":t.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:t.JS_CHECK_CODE})]}))}function couponListUpdate(e){var t,a,s,i,l,r,n,_;if(!!e&&typeof e!=="object"){return}t=BX("coupons_block");if(!!t){if(!!e.COUPON_LIST&&BX.type.isArray(e.COUPON_LIST)){s=BX("coupon");if(!!s){s.value=""}i=BX.findChildren(t,{tagName:"input",property:{name:"OLD_COUPON[]"}},true);if(!!i){if(BX.type.isElementNode(i)){i=[i]}for(r=0;r<e.COUPON_LIST.length;r++){l=false;_=-1;for(n=0;n<i.length;n++){if(i[n].value===e.COUPON_LIST[r].COUPON){l=true;_=n;i[n].couponUpdate=true;break}}if(l){a="disabled";if(e.COUPON_LIST[r].JS_STATUS==="BAD")a="bad";else if(e.COUPON_LIST[r].JS_STATUS==="APPLYED")a="good";BX.adjust(i[_],{props:{className:a}});BX.adjust(i[_].nextSibling,{props:{className:a}});BX.adjust(i[_].nextSibling.nextSibling,{html:e.COUPON_LIST[r].JS_CHECK_CODE})}else{couponCreate(t,e.COUPON_LIST[r])}}for(n=0;n<i.length;n++){if(typeof i[n].couponUpdate==="undefined"||!i[n].couponUpdate){BX.remove(i[n].parentNode);i[n]=null}else{i[n].couponUpdate=null}}}else{for(r=0;r<e.COUPON_LIST.length;r++){couponCreate(t,e.COUPON_LIST[r])}}}}t=null}function skuPropClickHandler(e){if(!e){e=window.event}var t=BX.proxy_context,a,s,i={},l={},r,n,_,o,u;if(!!t&&t.hasAttribute("data-value-id")){BX.showWait();a=t.getAttribute("data-element");s=t.getAttribute("data-property");r=BX("action_var").value;i[s]=t.getAttribute("data-value-id");if(BX.hasClass(t,"bx_active")){BX.closeWait();return}n=BX.findChildren(BX(a),{tagName:"ul",className:"sku_prop_list"},true);if(!!n&&n.length>0){for(_=0;n.length>_;_++){if(n[_].id!=="prop_"+s+"_"+a){o=BX.findChildren(BX(n[_].id),{tagName:"li",className:"bx_active"},true);if(!!o&&o.length>0){for(u=0;o.length>u;u++){if(o[u].hasAttribute("data-value-id")){i[o[u].getAttribute("data-property")]=o[u].getAttribute("data-value-id")}}}}}}l={basketItemId:a,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:i,action_var:r,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};l[r]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:l,dataType:"json",onsuccess:function(e){BX.closeWait();updateBasketTable(a,e)}})}}function getColumnName(e,t){if(BX("col_"+t)){return BX.util.trim(BX("col_"+t).innerHTML)}else{return""}}function leftScroll(e,t,a){a=parseInt(a,10);var s=BX("prop_"+e+"_"+t);if(s){var i=parseInt(s.style.marginLeft,10);if(i<=(6-a)*20)s.style.marginLeft=i+20+"%"}}function rightScroll(e,t,a){a=parseInt(a,10);var s=BX("prop_"+e+"_"+t);if(s){var i=parseInt(s.style.marginLeft,10);if(i>(5-a)*20)s.style.marginLeft=i-20+"%"}}function checkOut(){if(!!BX("coupon"))BX("coupon").disabled=true;BX("basket_form").submit();return true}function enterCoupon(){var e=BX("coupon");if(!!e&&!!e.value)recalcBasketAjax({coupon:e.value})}function updateQuantity(e,t,a,s){var i=BX(e).defaultValue,l=parseFloat(BX(e).value)||0,r=false;if(a===0||a==1){r=true}else{var n=l*1e4,_=a*1e4,o=n%_,u=parseInt(l);if(o===0){r=true}}var c=false;if(parseInt(l)!=parseFloat(l)){c=true}l=s===false&&c===false?parseInt(l):parseFloat(l).toFixed(2);if(r){BX(e).defaultValue=l;BX("QUANTITY_INPUT_"+t).value=l;BX("QUANTITY_"+t).value=l;recalcBasketAjax({})}else{l=getCorrectRatioQuantity(l,a,s);if(l!=i){BX("QUANTITY_INPUT_"+t).value=l;BX("QUANTITY_"+t).value=l;recalcBasketAjax({})}else{BX(e).value=i}}}function setQuantity(e,t,a,s){var i=parseFloat(BX("QUANTITY_INPUT_"+e).value),l;l=a=="up"?i+t:i-t;if(l<0)l=0;if(s){l=l.toFixed(2)}if(t>0&&l<t){l=t}if(!s&&l!=l.toFixed(2)){l=l.toFixed(2)}l=getCorrectRatioQuantity(l,t,s);BX("QUANTITY_INPUT_"+e).value=l;BX("QUANTITY_INPUT_"+e).defaultValue=l;updateQuantity("QUANTITY_INPUT_"+e,e,t,s)}function getCorrectRatioQuantity(e,t,a){var s=e*1e4,i=t*1e4,l=s%i,r=e,n=false,_;t=parseFloat(t);if(l===0){return r}if(t!==0&&t!=1){for(_=t,max=parseFloat(e)+parseFloat(t);_<=max;_=parseFloat(parseFloat(_)+parseFloat(t)).toFixed(2)){r=_}}else if(t===1){r=e|0}if(parseInt(r,10)!=parseFloat(r)){n=true}r=a===false&&n===false?parseInt(r,10):parseFloat(r).toFixed(2);return r}function recalcBasketAjax(e){BX.showWait();var t={},a=BX("action_var").value,s=BX("basket_items"),i=BX("delayed_items"),l,r;l={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:t,action_var:a,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};l[a]="recalculate";if(!!e&&typeof e==="object"){for(r in e){if(e.hasOwnProperty(r))l[r]=e[r]}}if(!!s&&s.rows.length>0){for(r=1;s.rows.length>r;r++)l["QUANTITY_"+s.rows[r].id]=BX("QUANTITY_"+s.rows[r].id).value}if(!!i&&i.rows.length>0){for(r=1;i.rows.length>r;r++)l["DELAY_"+i.rows[r].id]="Y"}BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:l,dataType:"json",onsuccess:function(e){BX.closeWait();updateBasketTable(null,e)}})}function showBasketItemsList(e){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(e==2){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current");BX("delay_count").style.display="none"}if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}else if(e==3){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current");BX("subscribe_count").style.display="none"}if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}else if(e==4){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current");BX("not_available_count").style.display="none"}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current");BX("normal_count").style.display="none"}if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}}function deleteCoupon(e){var t=BX.proxy_context,a;if(!!t&&t.hasAttribute("data-coupon")){a=t.getAttribute("data-coupon");if(!!a&&a.length>0){recalcBasketAjax({delete_coupon:a})}}}BX.ready(function(){var e=BX.findChildren(BX("basket_items"),{tagName:"li",className:"sku_prop"},true),t,a;if(!!e&&e.length>0){for(t=0;e.length>t;t++){BX.bind(e[t],"click",BX.delegate(function(e){skuPropClickHandler(e)},this))}}a=BX("coupons_block");if(!!a)BX.bindDelegate(a,"click",{attribute:"data-coupon"},BX.delegate(function(e){deleteCoupon(e)},this))});
//# sourceMappingURL=script.map.js