if(typeof BX.CrmDealStageManager==="undefined"){BX.CrmDealStageManager=function(){};BX.CrmDealStageManager.prototype={getInfos:function(){return BX.CrmDealStageManager.infos},getMessage:function(t){var e=BX.CrmDealStageManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""}};BX.CrmDealStageManager.current=new BX.CrmDealStageManager;BX.CrmDealStageManager.infos=[{id:"NEW",name:"In Progress",sort:10,semantics:"process"},{id:"WON",name:"Is Won",sort:20,semantics:"success"},{id:"LOSE",name:"Is Lost",sort:30,semantics:"failure"}];BX.CrmDealStageManager.messages={}}if(typeof BX.CrmLeadStatusManager==="undefined"){BX.CrmLeadStatusManager=function(){};BX.CrmLeadStatusManager.prototype={getInfos:function(){return BX.CrmLeadStatusManager.infos},getMessage:function(t){var e=BX.CrmLeadStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""}};BX.CrmLeadStatusManager.current=new BX.CrmLeadStatusManager;BX.CrmLeadStatusManager.infos=[{id:"NEW",name:"Not Processed",sort:10,semantics:"process"},{id:"CONVERTED",name:"Converted",sort:20,semantics:"success"},{id:"JUNK",name:"Junk",sort:30,semantics:"failure"}];BX.CrmLeadStatusManager.messages={}}if(typeof BX.CrmQuoteStatusManager==="undefined"){BX.CrmQuoteStatusManager=function(){};BX.CrmQuoteStatusManager.prototype={getInfos:function(){return BX.CrmQuoteStatusManager.infos},getMessage:function(t){var e=BX.CrmQuoteStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""}};BX.CrmQuoteStatusManager.current=new BX.CrmQuoteStatusManager;BX.CrmQuoteStatusManager.infos=[{id:"DRAFT",name:"In Progress",sort:10,semantics:"process"},{id:"APPROVED",name:"Is Approved",sort:20,semantics:"success"},{id:"DECLAINED",name:"Is Declained",sort:30,semantics:"failure"}];BX.CrmQuoteStatusManager.messages={}}if(typeof BX.CrmInvoiceStatusManager==="undefined"){BX.CrmInvoiceStatusManager=function(){this.dlg=null};BX.CrmInvoiceStatusManager.prototype={getSetting:function(t,e){return typeof BX.CrmInvoiceStatusManager.settings[t]!=="undefined"?BX.CrmInvoiceStatusManager.settings[t]:e},setSetting:function(t,e){BX.CrmInvoiceStatusManager.settings[t]=e},getInfos:function(){return BX.CrmInvoiceStatusManager.infos},getMessage:function(t){var e=BX.CrmInvoiceStatusManager.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},_handleDateInputClick:function(t){var e=BX(this.dlgDateControlId);BX.calendar({node:BX(e),field:e,bTime:false,serverTime:this.getSetting("serverTime",""),bHideTimebar:true})},_handleDateImageMouseOver:function(t){BX.addClass(t.target,"calendar-icon-hover")},_handleDateImageMouseOut:function(t){if(!t){t=window.event}BX.removeClass(t.target,"calendar-icon-hover")}};BX.CrmInvoiceStatusManager.current=new BX.CrmInvoiceStatusManager;BX.CrmInvoiceStatusManager.settings={};BX.CrmInvoiceStatusManager.statusInfoValues=[];BX.CrmInvoiceStatusManager.infos=[{id:"N",name:"In Progress",sort:10,semantics:"process"},{id:"F",name:"Is Paid",sort:20,semantics:"success",hasParams:true},{id:"D",name:"Is Dismiss",sort:30,semantics:"failure"}];BX.CrmInvoiceStatusManager.messages={};BX.CrmInvoiceStatusManager.failureDialogEventsBinded=false;BX.CrmInvoiceStatusManager.failureDialogEventsBind=function(){if(!BX.CrmInvoiceStatusManager.failureDialogEventsBinded){BX.CrmInvoiceStatusManager.failureDialogEventsBinded=true;BX.addCustomEvent("CrmProcessFailureDialogContentCreated",function(t){var e=BX.CrmInvoiceStatusManager.current;var i=t.getEntityType();if(i==="INVOICE"){var s=parseInt(t.getEntityId());var n=t.getWrapper();var a=t.getValue()===t.getSuccessValue();var r="crm_"+i+s+"_params";var o=r+"_success";var l=r+"_failure";var u="crm_"+i+s+"_date_success";var c="crm_"+i+s+"_date_fail";e.isSuccess=a;e.successParamsId=o;e.failureParamsId=l;e.dlgDateControlId=a?u:c;if(n&&s>0&&i.length>0){var h=BX.CrmInvoiceStatusManager.statusInfoValues[s];var p=null;p=BX.create("DIV",{attrs:{id:r},children:[BX.create("DIV",{attrs:{id:o,"class":"crm-invoice-term-dialog-params",style:a?"":"display: none;"},children:[BX.create("TABLE",{children:[BX.create("TR",{children:[BX.create("TD",{"class":"left-column",text:e.getMessage("dateLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{className:"bx-crm-dialog-input"},props:{type:"text",id:u,name:"PAY_VOUCHER_DATE",value:h["PAY_VOUCHER_DATE"]?h["PAY_VOUCHER_DATE"]:BX.formatDate(null,BX.message("FORMAT_DATE"))},style:{width:"70px"},events:{click:BX.delegate(e._handleDateInputClick,e)}}),BX.create("A",{props:{href:"javascript:void(0);",title:e.getMessage("setDate")},children:[BX.create("IMG",{attrs:{src:e.getSetting("imagePath","")+"calendar.gif",className:"calendar-icon",alt:e.getMessage("setDate")},events:{click:BX.delegate(e._handleDateInputClick,e),mouseover:BX.delegate(e._handleDateImageMouseOver,e),mouseout:BX.delegate(e._handleDateImageMouseOut,e)}})]})]})]}),BX.create("TR",{children:[BX.create("TD",{"class":"left-column",text:e.getMessage("payVoucherNumLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{"class":"bx-crm-dialog-input",type:"text",name:"PAY_VOUCHER_NUM",value:h["PAY_VOUCHER_NUM"]?h["PAY_VOUCHER_NUM"].substring(0,20):"",maxlength:20,size:20}})]})]})]}),BX.create("DIV",{attrs:{"class":"separator"}}),BX.create("SPAN",{attrs:{"class":"comment-header"},text:e.getMessage("commentLabelText")+":"}),BX.create("TEXTAREA",{attrs:{"class":"bx-crm-dialog-invoice-textarea",name:"REASON_MARKED_SUCCESS"},text:h["REASON_MARKED"]?h["REASON_MARKED"]:""})]}),BX.create("DIV",{attrs:{id:l,"class":"crm-invoice-term-dialog-params",style:a?"display: none;":""},children:[BX.create("TABLE",{children:[BX.create("TR",{children:[BX.create("TD",{"class":"left-column",text:e.getMessage("dateLabelText")+":"}),BX.create("TD",{children:[BX.create("INPUT",{attrs:{className:"bx-crm-dialog-input"},props:{type:"text",id:c,name:"DATE_MARKED",value:h["DATE_MARKED"]?h["DATE_MARKED"]:BX.formatDate(null,BX.message("FORMAT_DATE"))},style:{width:"70px"},events:{click:BX.delegate(e._handleDateInputClick,e)}}),BX.create("A",{props:{href:"javascript:void(0);",title:e.getMessage("setDate")},children:[BX.create("IMG",{attrs:{src:e.getSetting("imagePath","")+"calendar.gif",className:"calendar-icon",alt:e.getMessage("setDate")},events:{click:BX.delegate(e._handleDateInputClick,e),mouseover:BX.delegate(e._handleDateImageMouseOver,e),mouseout:BX.delegate(e._handleDateImageMouseOut,e)}})]})]})]})]}),BX.create("DIV",{attrs:{"class":"separator"}}),BX.create("SPAN",{attrs:{"class":"comment-header"},text:e.getMessage("commentLabelText")+":"}),BX.create("TEXTAREA",{attrs:{"class":"bx-crm-dialog-invoice-textarea",name:"REASON_MARKED"},text:h["REASON_MARKED"]?h["REASON_MARKED"]:""})]})]});if(p)n.appendChild(p)}}});BX.addCustomEvent("CrmProcessFailureDialogValueChanged",function(t,e){var i=BX.CrmInvoiceStatusManager.current;var s=t.getEntityType();if(s==="INVOICE"){var n=parseInt(t.getEntityId());var a=t.getWrapper();var r=e===t.getSuccessValue();var o="crm_"+s+n+"_params";var l=o+"_success";var u=o+"_failure";var c=BX(l);var h=BX(u);var p="crm_"+s+n+"_date_success";var g="crm_"+s+n+"_date_fail";i.isSuccess=r;i.dlgDateControlId=r?p:g;if(c)c.setAttribute("style",r?"":"display: none;");if(h)h.setAttribute("style",r?"display: none;":"")}});BX.addCustomEvent("CrmProgressControlBeforeFailureDialogClose",function(t,e){var i=e.getEntityType();if(i==="INVOICE"){var s=BX.CrmInvoiceStatusManager.current;var n=BX(s.isSuccess?s.successParamsId:s.failureParamsId);s.saveParams={};if(n){var a=[];var r=BX.findChildren(n,{tag:"input"},true);if(r)a=a.concat(r);var o=BX.findChildren(n,{tag:"textarea"},true);if(o)a=a.concat(o);var l;for(var u in a){l=a[u].getAttribute("name");if(l)s.saveParams[l]=a[u].value}}}});BX.addCustomEvent("CrmProgressControlBeforeSave",function(t,e){var i=BX.CrmInvoiceStatusManager.current;if(typeof i.saveParams==="object"){var s=t.getEntityId();var n;for(var a in i.saveParams){if(s>0){if(a==="REASON_MARKED_SUCCESS")n="REASON_MARKED";else n=a;BX.CrmInvoiceStatusManager.statusInfoValues[s][n]=i.saveParams[a]}e[a]=i.saveParams[a]}}e["STATE_SUCCESS"]=i.isSuccess?"Y":"N"})}}}if(typeof BX.CrmProgressControl==="undefined"){BX.CrmProgressControl=function(){this._id="";this._settings=null;this._container=null;this._legendContainer=null;this._entityId=0;this._entityType=null;this._currentStepId="";this._manager=null;this._stepInfos=null;this._steps=[];this._terminationDlg=null;this._failureDlg=null;this._isFrozen=false;this._isReadOnly=false};BX.CrmProgressControl.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._container=BX(this.getSetting("containerId"));this._legendContainer=BX.findNextSibling(this._container,{className:"crm-list-stage-bar-title"});this._entityId=parseInt(this.getSetting("entityId",0));this._entityType=this.getSetting("entityType");this._currentStepId=this.getSetting("currentStepId");if(this._entityType==="DEAL"){this._manager=BX.CrmDealStageManager.current}else if(this._entityType==="LEAD"){this._manager=BX.CrmLeadStatusManager.current}else if(this._entityType==="QUOTE"){this._manager=BX.CrmQuoteStatusManager.current}else if(this._entityType==="INVOICE"){this._manager=BX.CrmInvoiceStatusManager.current}var i=this._stepInfos=this._manager.getInfos();var s=this._findStepInfoIndex(this._currentStepId);var n=s>=0?i[s]:null;this._isReadOnly=this.getSetting("readOnly",false);this._isFrozen=this._isReadOnly||(n&&BX.type.isBoolean(n["isFrozen"])?n["isFrozen"]:false);for(var a=0;a<i.length;a++){var r=i[a];var o=this.getStepContainer(r["id"]);if(!o){continue}var l=parseInt(r["sort"]);this._steps.push(BX.CrmProgressStep.create(r["id"],BX.CrmParamBag.create({name:r["name"],hint:BX.type.isNotEmptyString(r["hint"])?r["hint"]:"",sort:l,isPassed:a<=s,control:this})))}},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){this._settings.setParam(t,e)},getId:function(){return this._id},getEntityType:function(){return this._entityType},getEntityId:function(){return this._entityId},getCurrentStepId:function(){return this._currentStepId},isFrozen:function(){return this._isFrozen},isReadOnly:function(){return this._isReadOnly},getStepContainer:function(t){return BX.type.isNotEmptyString(t)?BX.findChild(this._container,{tag:"DIV","class":"crm-stage-"+t.toLowerCase()},true):null},setCurrentStep:function(t){this._closeTerminationDialog();if(this._isReadOnly||this._isFrozen){return}var e=this._findStepInfoIndex(t.getId());if(e<0){return}if(e===this._steps.length-1&&this._findStepInfoBySemantics("success")&&this._findStepInfoBySemantics("failure")){this._openTerminationDialog();return}if(this._currentStepId!==t.getId()){this._currentStepId=t.getId();this._layout();this._save()}},setCurrentStepId:function(t){if(this._currentStepId!==t){this._currentStepId=t;this._layout()}},getCurrentStepInfo:function(){var t=this._findStepInfoIndex(this._currentStepId);return t>=0?this._stepInfos[t]:null},_layout:function(){var t=this._findStepInfoIndex(this._currentStepId);if(t<0){return}for(var e=0;e<this._steps.length;e++){this._steps[e].setPassed(e<=t)}var i=this._stepInfos[t];this._isFrozen=BX.type.isBoolean(i["isFrozen"])?i["isFrozen"]:false;var s=BX.type.isNotEmptyString(i["semantics"])?i["semantics"]:"";if(s==="success"){BX.addClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}else if(s==="failure"||s==="apology"){BX.removeClass(this._container,"crm-list-stage-end-good");BX.addClass(this._container,"crm-list-stage-end-bad")}else{BX.removeClass(this._container,"crm-list-stage-end-good");BX.removeClass(this._container,"crm-list-stage-end-bad")}if(this._legendContainer){this._legendContainer.innerHTML=BX.util.htmlspecialchars(BX.type.isNotEmptyString(i["name"])?i["name"]:i["id"])}},_openTerminationDialog:function(){this._enableStepHints(false);if(this._terminationDlg){this._terminationDlg.close();this._terminationDlg=null}var t=this._findAllStepInfoBySemantics("apology");this._terminationDlg=BX.CrmProcessTerminationDialog.create(this._id+"_TERMINATION",BX.CrmParamBag.create({title:this._manager.getMessage("dialogTitle"),failureTitle:t.length>0?this._manager.getMessage("failureTitle"):"",anchor:this._container,success:this._findStepInfoBySemantics("success"),failure:this._findStepInfoBySemantics("failure"),apologies:t,callback:BX.delegate(this._onTerminationDialogClose,this)}));this._terminationDlg.open()},_closeTerminationDialog:function(){if(!this._terminationDlg){return}this._terminationDlg.close(false);this._terminationDlg=null;this._enableStepHints(true)},_onTerminationDialogClose:function(t,e){if(this._terminationDlg!==t){return}this._closeTerminationDialog();var i=BX.type.isNotEmptyString(e["result"])?e["result"]:"";var s=this._findStepInfoIndex(i);if(s<0){return}this._currentStepId=i;var n=false;var a=this._stepInfos[s];var r=this._findStepInfoBySemantics("failure");if(r&&r["id"]===i){n=true}else if(a["semantics"]==="success"){if(typeof a["hasParams"]!=="undefined"&&a["hasParams"]===true){n=true}else{var o=this.getSetting("finalUrl","");if(o!==""){window.location=o;return}}}if(n){this._openFailureDialog();return}this._layout();this._save()},_openFailureDialog:function(){this._enableStepHints(false);if(this._failureDlg){this._failureDlg.close();this._failureDlg=null}var t=this._findStepInfoIndex(this._currentStepId);var e=t>=0?this._stepInfos[t]:null;var i=e?e["id"]:"";var s=this._findAllStepInfoBySemantics("apology");this._failureDlg=BX.CrmProcessFailureDialog.create(this._id+"_FAILURE",BX.CrmParamBag.create({entityType:this._entityType,entityId:this._entityId,initValue:i,failureTitle:s.length>0?this._manager.getMessage("failureTitle"):"",selectorTitle:this._manager.getMessage("selectorTitle"),anchor:this._container,success:this._findStepInfoBySemantics("success"),failure:this._findStepInfoBySemantics("failure"),apologies:s,callback:BX.delegate(this._onFailureDialogClose,this)}));this._failureDlg.open()},_closeFailureDialog:function(){if(!this._failureDlg){return}this._failureDlg.close(false);this._failureDlg=null;this._enableStepHints(true)},_onFailureDialogClose:function(t,e){if(this._failureDlg!==t){return}BX.onCustomEvent(this,"CrmProgressControlBeforeFailureDialogClose",[this,this._failureDlg]);this._closeFailureDialog();var i=BX.type.isNotEmptyString(e["bid"])?e["bid"]:"";if(i!=="accept"){return}var s=BX.type.isNotEmptyString(e["result"])?e["result"]:"";var n=this._findStepInfoIndex(s);if(n>=0){var a=this._stepInfos[n];if(a["semantics"]==="success"){var r=this.getSetting("finalUrl","");if(r!==""){window.location=r;return}}this._currentStepId=a["id"];this._layout();this._save()}},_save:function(){var t=this.getSetting("serviceUrl");var e=this.getCurrentStepId();var i=this.getEntityType();var s=this.getEntityId();if(t===""||e===""||i===""||s<=0){return}var n={ACTION:"SAVE_PROGRESS",VALUE:e,TYPE:i,ID:s};BX.onCustomEvent(this,"CrmProgressControlBeforeSave",[this,n]);var a=this;BX.ajax({url:t,method:"POST",dataType:"json",data:n,onsuccess:function(t){BX.onCustomEvent(a,"CrmProgressControlAfterSaveSucces",[a,t]);BX.CrmProgressControl._synchronize(a)},onfailure:function(t){BX.onCustomEvent(a,"CrmProgressControlAfterSaveFailed",[a,t])}})},_findStepInfoBySemantics:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){var s=e[i];var n=BX.type.isNotEmptyString(s["semantics"])?s["semantics"]:"";if(t===n){return s}}return null},_findAllStepInfoBySemantics:function(t){var e=[];var i=this._stepInfos;for(var s=0;s<i.length;s++){var n=i[s];var a=BX.type.isNotEmptyString(n["semantics"])?n["semantics"]:"";if(t===a){e.push(n)}}return e},_findStepInfoIndex:function(t){var e=this._stepInfos;for(var i=0;i<e.length;i++){if(e[i]["id"]===t){return i}}return-1},_enableStepHints:function(t){for(var e=0;e<this._steps.length;e++){this._steps[e].enableHint(t)}}};BX.CrmProgressControl.items={};BX.CrmProgressControl.create=function(t,e){var i=new BX.CrmProgressControl;i.initialize(t,e);this.items[t]=i;return i};BX.CrmProgressControl._synchronize=function(t){var e=t.getEntityType();var i=t.getEntityId();for(var s in this.items){if(!this.items.hasOwnProperty(s)){continue}var n=this.items[s];if(n===t){continue}if(n.getEntityType()===e&&n.getEntityId()===i){n.setCurrentStepId(t.getCurrentStepId())}}}}if(typeof BX.CrmProgressStep==="undefined"){BX.CrmProgressStep=function(){this._id="";this._settings=null;this._control=null;this._container=null;this._name="";this._hint="";this._isPassed=false;this._enableHint=true;this._hintPopup=null;this._hintPopupTimeoutId=null};BX.CrmProgressStep.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._control=this.getSetting("control");this._container=this._control.getStepContainer(this._id);this._name=this.getSetting("name");this._hint=this.getSetting("hint","");this._isPassed=this.getSetting("isPassed",false);BX.bind(this._container,"mouseover",BX.delegate(this._onMouseOver,this));BX.bind(this._container,"mouseout",BX.delegate(this._onMouseOut,this));BX.bind(this._container,"click",BX.delegate(this._onClick,this))},getId:function(){return this._id},getName:function(){return this._name},getSetting:function(t,e){return this._settings.getParam(t,e)},isPassed:function(){return this._isPassed},setPassed:function(t){t=!!t;if(this._isPassed===t){return}this._isPassed=t;var e=BX.findParent(this._container,{"class":"crm-list-stage-bar-part"});if(t){BX.addClass(e,"crm-list-stage-passed")}else{BX.removeClass(e,"crm-list-stage-passed")}},isHintEnabled:function(){return this._enableHint},enableHint:function(t){t=!!t;if(this._enableHint===t){return}this._enableHint=t;if(!t){this.hideStepHint()}},displayStepHint:function(t){if(!this._enableHint||this._hintPopup){return}var e=BX.pos(this._container);this._hintPopup=BX.PopupWindowManager.create("step-hint-"+this._id,t,{angle:{position:"bottom",offset:0},offsetLeft:e["width"]/2,offsetTop:5,content:BX.create("SPAN",{attrs:{"class":"crm-list-bar-popup-text"},text:this._hint!==""?this._hint:this._name}),className:"crm-list-bar-popup-table"});this._hintPopup.show()},hideStepHint:function(){if(!this._hintPopup){return}this._hintPopup.close();this._hintPopup.destroy();this._hintPopup=null},_onClick:function(t){this._control.setCurrentStep(this)},_onMouseOver:function(t){if(this._hintPopupTimeoutId!==null){window.clearTimeout(this._hintPopupTimeoutId)}t=t||window.event;var e=t.target||t.srcElement;var i=this;this._hintPopupTimeoutId=window.setTimeout(function(){i._hintPopupTimeoutId=null;i.displayStepHint(e)},300)},_onMouseOut:function(t){if(this._hintPopupTimeoutId!==null){window.clearTimeout(this._hintPopupTimeoutId)}if(!this._enableHint){return}var e=this;this._hintPopupTimeoutId=window.setTimeout(function(){e._hintPopupTimeoutId=null;e.hideStepHint()},300)}};BX.CrmProgressStep.create=function(t,e){var i=new BX.CrmProgressStep;i.initialize(t,e);return i}}if(typeof BX.CrmProcessTerminationDialog==="undefined"){BX.CrmProcessTerminationDialog=function(){this._id="";this._settings=null;this._popup=null;this._wrapper=null;this._result="";this._enableCallback=true};BX.CrmProcessTerminationDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null)},getSetting:function(t,e){return this._settings.getParam(t,e)},getId:function(){return this._id},getResult:function(){return this._result},open:function(){if(!this._popup){this._popup=BX.PopupWindowManager.create(this._id,this.getSetting("anchor"),{closeByEsc:true,autoHide:true,offsetLeft:-50,closeIcon:true,className:"crm-list-end-deal",content:this._prepareContent(),events:{onPopupClose:BX.delegate(this._onPopupClose,this)}})}this._popup.show()},close:function(t){this._enableCallback=!!t;if(this._popup){this._popup.close()}},_onPopupClose:function(){if(this._popup){this._popup.destroy();this._popup=null}this._executeCallback()},_prepareContent:function(){var t=this._wrapper=BX.create("DIV",{attrs:{"class":"crm-list-end-deal-block"}});var e=this.getSetting("title","");t.appendChild(BX.create("DIV",{attrs:{"class":"crm-list-end-deal-text"},text:e}));var i=BX.create("DIV",{attrs:{"class":"crm-list-end-deal-buttons-block"}});var s=this.getSetting("success");if(s){var n=BX.type.isNotEmptyString(s["name"])?s["name"]:"Success";var a=BX.create("A",{attrs:{className:"webform-small-button webform-small-button-accept",href:"#"},children:[BX.create("SPAN",{attrs:{className:"webform-small-button-left"}}),BX.create("SPAN",{attrs:{className:"webform-small-button-text"},text:n}),BX.create("SPAN",{attrs:{className:"webform-small-button-right"}})]});i.appendChild(a);var r=BX.type.isNotEmptyString(s["id"])?s["id"]:"success";BX.CrmSubscriber.subscribe(this.getId()+"_"+r,a,"click",BX.delegate(this._onButtonClick,this),BX.CrmParamBag.create({id:r,preventDefault:true}))}var o=this.getSetting("failure");if(o){var l=this.getSetting("failureTitle","");if(l===""){l=BX.type.isNotEmptyString(o["name"])?o["name"]:"Failure"}var u=BX.create("A",{attrs:{className:"webform-small-button webform-small-button-decline",href:"#"},children:[BX.create("SPAN",{attrs:{className:"webform-small-button-left"}}),BX.create("SPAN",{attrs:{className:"webform-small-button-text"},text:l}),BX.create("SPAN",{attrs:{className:"webform-small-button-right"}})]});i.appendChild(u);var c=BX.type.isNotEmptyString(o["id"])?o["id"]:"failure";BX.CrmSubscriber.subscribe(this.getId()+"_"+c,u,"click",BX.delegate(this._onButtonClick,this),BX.CrmParamBag.create({id:c,preventDefault:true}))}t.appendChild(i);return t},_onButtonClick:function(t,e){this._result=t.getSetting("id","");this._executeCallback()},_executeCallback:function(){if(this._enableCallback){var t=this.getSetting("callback");if(BX.type.isFunction(t)){t(this,{result:this._result})}}}};BX.CrmProcessTerminationDialog.create=function(t,e){var i=new BX.CrmProcessTerminationDialog;i.initialize(t,e);return i}}if(typeof BX.CrmProcessFailureDialog==="undefined"){BX.CrmProcessFailureDialog=function(){this._id="";this._settings=null;this._popup=null;this._wrapper=null;this._callback=null;this._enableCallback=true;this._value="";this._bid="";this._successInfo=null;this._failureInfo=null;this._apologyInfos=null;this._failureTitle="";this._selectorTitle="";this._radioButtonBlock=null;this._popupMenuId="";this._popupMenu=null};BX.CrmProcessFailureDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._callback=this.getSetting("callback",null);this._successInfo=this.getSetting("success",null);if(!this._successInfo){throw"BX.CrmProcessFailureDialog: 'success' setting is not found!"}this._failureInfo=this.getSetting("failure",null);if(!this._failureInfo){throw"BX.CrmProcessFailureDialog: 'failure' setting is not found!"}this._apologyInfos=this.getSetting("apologies",null);if(!BX.type.isArray(this._apologyInfos)){this._apologyInfos=[]}var i=this.getSetting("initValue","");if(i===""){i=this._failureInfo["id"]}this._value=i;this._failureTitle=this.getSetting("failureTitle","");this._selectorTitle=this.getSetting("selectorTitle","");this._popupMenuId=this._id+"_MENU"},getSetting:function(t,e){return this._settings.getParam(t,e)},getEntityType:function(){return this.getSetting("entityType")},getEntityId:function(){return this.getSetting("entityId")},getId:function(){return this._id},getValue:function(){return this._value},setValue:function(t,e){if(this._value===t){return}this._value=t;if(typeof e==="undefined"){e=true}else{e=!!e}if(e){var i=BX.findChildren(this._wrapper,{className:"crm-list-fail-deal-button"},true);for(var s=0;s<i.length;s++){var n=i[s];n.checked=n.value===t}}BX.onCustomEvent(this,"CrmProcessFailureDialogValueChanged",[this,t])},getSuccessValue:function(){return this._successInfo["id"]},getBid:function(){return this._bid},getWrapper:function(){return this._wrapper},open:function(){if(this._popup){this._popup.show();return}this._popup=new BX.PopupWindow(this._id,this.getSetting("anchor"),{closeByEsc:true,autoHide:true,offsetLeft:-50,closeIcon:true,className:"crm-list-fail-deal",titleBar:{content:this._prepareTitle()},content:this._prepareContent(),events:{onPopupClose:BX.delegate(this._onPopupClose,this)},buttons:[new BX.PopupWindowButton({text:BX.message["JS_CORE_WINDOW_SAVE"],className:"popup-window-button-accept",events:{click:BX.delegate(this._onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message["JS_CORE_WINDOW_CANCEL"],className:"popup-window-button-link-cancel",events:{click:BX.delegate(this._onCancelButtonClick,this)}})]});this._popup.show()},close:function(t){this._enableCallback=!!t;if(this._popup){this._popup.close()}},getFailureTitle:function(){var t=this._failureTitle;if(t==""){t=BX.type.isNotEmptyString(this._failureInfo["name"])?this._failureInfo["name"]:this._failureInfo["id"]}return t},getSuccessTitle:function(){return BX.type.isNotEmptyString(this._successInfo["name"])?this._successInfo["name"]:this._successInfo["id"]},_onPopupClose:function(){this._closePopupMenu();if(this._popup){this._popup.destroy();this._popup=null}this._executeCallback()},_closePopupMenu:function(){if(this._popupMenu){BX.PopupMenu.Data[this._popupMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._popupMenuId];this._popupMenu=null}},_prepareTitle:function(){var t=BX.create("DIV",{attrs:{"class":"crm-list-fail-deal-selector-block"}});t.appendChild(BX.create("SPAN",{text:this._selectorTitle+": "}));var e=this._value===this._successInfo["id"];this._selector=BX.create("DIV",{attrs:{"class":"crm-list-end-deal-option crm-list-end-deal-option-"+(e?"success":"fail")},events:{click:BX.delegate(this._onSelectorClick,this)},text:e?this.getSuccessTitle():this.getFailureTitle()});t.appendChild(this._selector);return t},_prepareContent:function(){var t=this._wrapper=BX.create("DIV",{attrs:{"class":"crm-list-fail-deal-block"}});var e=this.getSetting("title","");if(e!==""){t.appendChild(BX.create("DIV",{attrs:{"class":"crm-list-end-deal-text"},text:e}))}this._radioButtonBlock=BX.create("DIV",{attrs:{"class":"crm-list-end-deal-block-section"}});var i=[this._failureInfo];var s=this._apologyInfos;if(BX.type.isArray(s)&&s.length>0){for(var n=0;n<s.length;n++){i.push(s[n])}}for(var a=0;a<i.length;a++){var r=BX.create("DIV",{attrs:{"class":"crm-list-end-deal-button-wrapper"}});var o=i[a];var l=o["id"];var u=this._id+"_"+l;var c=BX.create("INPUT",{attrs:{id:u,name:this._id,"class":"crm-list-fail-deal-button",type:"radio",value:o["id"]}});c.checked=this._value===l;BX.CrmSubscriber.subscribe(this._id+"_"+l,c,"change",BX.delegate(this._onRadioButtonClick,this),BX.CrmParamBag.create({id:l}));r.appendChild(c);r.appendChild(BX.create("LABEL",{attrs:{"class":"crm-list-fail-deal-button-label","for":u},text:BX.type.isNotEmptyString(o["name"])?o["name"]:l}));this._radioButtonBlock.appendChild(r)}if(this._value===this._successInfo["id"]||s.length===0){this._radioButtonBlock.style.display="none"}t.appendChild(this._radioButtonBlock);BX.onCustomEvent(this,"CrmProcessFailureDialogContentCreated",[this,t]);return t},_onRadioButtonClick:function(t,e){this.setValue(t.getSetting("id",""),false)},_onAcceptButtonClick:function(t){this._bid="accept";this._executeCallback()},_onCancelButtonClick:function(t){this._bid="cancel";this._value="";this._executeCallback()},_onSelectorClick:function(){if(this._popupMenu){this._closePopupMenu();return}if(typeof BX.PopupMenu.Data[this._popupMenuId]!=="undefined"){BX.PopupMenu.Data[this._popupMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._popupMenuId]}var t=this;BX.PopupMenu.show(this._popupMenuId,this._selector,[{text:this.getFailureTitle(),onclick:function(){t.setValue(t._failureInfo["id"],true);if(t._radioButtonBlock.style.display==="none"&&t._apologyInfos.length>0){t._radioButtonBlock.style.display=""}t._selector.innerHTML=BX.util.htmlspecialchars(t.getFailureTitle());BX.removeClass(t._selector,"crm-list-end-deal-option-success");BX.addClass(t._selector,"crm-list-end-deal-option-fail");t._closePopupMenu()}},{text:this.getSuccessTitle(),onclick:function(){t.setValue(t._successInfo["id"],true);if(t._radioButtonBlock.style.display!=="none"){t._radioButtonBlock.style.display="none"}t._selector.innerHTML=BX.util.htmlspecialchars(t.getSuccessTitle());BX.removeClass(t._selector,"crm-list-end-deal-option-fail");BX.addClass(t._selector,"crm-list-end-deal-option-success");t._closePopupMenu()}}],{autoHide:true,offsetTop:0,offsetLeft:-30});this._popupMenu=BX.PopupMenu.Data[this._popupMenuId]},_executeCallback:function(){if(this._enableCallback){var t=this._callback;if(BX.type.isFunction(t)){t(this,{bid:this._bid,result:this._value})}}}};BX.CrmProcessFailureDialog.create=function(t,e){var i=new BX.CrmProcessFailureDialog;i.initialize(t,e);return i}}
//# sourceMappingURL=progress_control.map.js