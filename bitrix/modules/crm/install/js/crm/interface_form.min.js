function BxCrmInterfaceForm(t,e){var i=this;this.name=t;this.aTabs=e;this.bExpandTabs=false;this.vars={};this.oTabsMeta={};this.aTabsEdit=[];this.oFields={};this.menu=new PopupMenu("bxFormMenu_"+this.name,1010);this.settingsMenu=[];this.tabSettingsWnd=null;this.fieldSettingsWnd=null;this.activeTabClass="bx-crm-view-tab-active";this._isSubmitted=false;this._enableSigleSubmit=true;this.isVisibleInViewMode=true;var s=BX("container_"+this.name.toLowerCase());if(s){this.isVisibleInViewMode=s.style.display!=="none"}this.Initialize=function(){if(this._enableSigleSubmit){this._submitHandler=BX.delegate(this._OnSubmit,this);BX.bind(BX("form_"+this.name),"submit",this._submitHandler)}BX.onCustomEvent(window,"CrmInterfaceFormCreated",[this])};this.EnableSigleSubmit=function(t){t=!!t;if(this._enableSigleSubmit===t){return}if(this._enableSigleSubmit&&this._submitHandler){BX.unbind(BX("form_"+this.name),"submit",this._submitHandler);this._submitHandler=null}this._enableSigleSubmit=t;if(this._enableSigleSubmit){this._submitHandler=BX.delegate(this._OnSubmit,this);BX.bind(BX("form_"+this.name),"submit",this._submitHandler)}};this._OnSubmit=function(t){if(!this._enableSigleSubmit){return true}if(this._isSubmitted){return BX.PreventDefault(t)}this._isSubmitted=true;window.setTimeout(BX.delegate(this._LockSubmits,this),10);return true};this._LockSubmits=function(){var t=BX(this.name+"_saveAndView");if(t){t.disabled="disabled"}var e=BX(this.name+"_saveAndAdd");if(e){e.disabled="disabled"}var i=BX(this.name+"_apply");if(i){i.disabled="disabled"}};this.GetTabs=function(){var t=BX.findChildren(BX(this.name+"_tab_block"),{tagName:"a",className:"bx-crm-view-tab"},false);return t?t:[]};this.GetActiveTabId=function(){var t=this.GetTabs();for(var e=0;e<t.length;e++){var i=t[e];if(BX.hasClass(i,this.activeTabClass)){return i.id.substring((this.name+"_tab_").length)}}return""};this.ShowOnDemand=function(t){var e=BX.findParent(t,{tagName:"DIV",className:"bx-crm-view-fieldset"});var i=BX.findChildren(e,{tagName:"tr",className:"bx-crm-view-on-demand"},true);if(!BX.type.isArray(i)){return}for(var s=0;s<i.length;s++){i[s].style.display=""}if(t){BX.findParent(t,{tagName:"tr",className:"bx-crm-view-show-more"}).style.display="none"}};this.SelectTab=function(t){var e=BX("inner_tab_"+t);if(!e||e.style.display!="none")return;for(var i=0,s=this.aTabs.length;i<s;i++){var n=BX("inner_tab_"+this.aTabs[i]);if(!n)continue;if(n.style.display!="none"){this.ShowTab(this.aTabs[i],false);n.style.display="none";break}}this.ShowTab(t,true);e.style.display="block";var a=BX(this.name+"_active_tab");if(a)a.value=t;BX.onCustomEvent(window,"BX_CRM_INTERFACE_FORM_TAB_SELECTED",[this,this.name,t,e])};this.ShowTab=function(t,e){var i=this.name+"_tab_"+t;var s=this.GetTabs();for(var n=0;n<s.length;n++){var a=s[n];if(i!==a.id){continue}if(e){BX.addClass(a,"bx-crm-view-tab-active");BX.onCustomEvent(this,"OnTabShow",[t])}else{BX.removeClass(a,"bx-crm-view-tab-active");BX.onCustomEvent(this,"OnTabHide",[t])}break}};this.HoverTab=function(t,e){var i=document.getElementById("tab_"+t);if(i.className=="bx-tab-selected")return;document.getElementById("tab_left_"+t).className=e?"bx-tab-left-hover":"bx-tab-left";i.className=e?"bx-tab-hover":"bx-tab";var s=document.getElementById("tab_right_"+t);s.className=e?"bx-tab-right-hover":"bx-tab-right"};this.ShowDisabledTab=function(t,e){var s=document.getElementById("tab_cont_"+t);if(e){s.className="bx-tab-container-disabled";s.onclick=null;s.onmouseover=null;s.onmouseout=null}else{s.className="bx-tab-container";s.onclick=function(){i.SelectTab(t)};s.onmouseover=function(){i.HoverTab(t,true)};s.onmouseout=function(){i.HoverTab(t,false)}}};this.ToggleTabs=function(t){this.bExpandTabs=!this.bExpandTabs;var e=document.getElementById("bxForm_"+this.name+"_expand_link");e.title=this.bExpandTabs?this.vars.mess.collapseTabs:this.vars.mess.expandTabs;e.className=this.bExpandTabs?e.className.replace(/\s*bx-down/gi," bx-up"):e.className.replace(/\s*bx-up/gi," bx-down");var i;for(var s in this.aTabs){var n=this.aTabs[s];this.ShowTab(n,false);this.ShowDisabledTab(n,this.bExpandTabs);i=document.getElementById("inner_tab_"+n);i.style.display=this.bExpandTabs?"block":"none"}if(!this.bExpandTabs){this.ShowTab(this.aTabs[0],true);i=document.getElementById("inner_tab_"+this.aTabs[0]);i.style.display="block"}if(t!==true)BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.php?FORM_ID="+this.name+"&action=expand&expand="+(this.bExpandTabs?"Y":"N")+"&sessid="+this.vars.sessid)};this.SetTheme=function(t,e){BX.loadCSS(this.vars.template_path+"/themes/"+e+"/style.css");var s=this.menu.GetMenuByItemId(t.id);s.SetAllItemsIcon("");s.SetItemIcon(t,"checked");BX.ajax.get("/bitrix/components"+i.vars.component_path+"/settings.php?FORM_ID="+this.name+"&GRID_ID="+this.vars.GRID_ID+"&action=settheme&theme="+e+"&sessid="+this.vars.sessid)};this.ShowSettings=function(){var t=false;if(!window["formSettingsDialog"+this.name]){window["formSettingsDialog"+this.name]=new BX.CDialog({content:'<form name="form_settings_'+this.name+'"></form>',title:this.vars.mess.settingsTitle,width:this.vars.settingWndSize.width,height:this.vars.settingWndSize.height,resize_id:"InterfaceFormSettingWnd"});t=true}window["formSettingsDialog"+this.name].ClearButtons();window["formSettingsDialog"+this.name].SetButtons([{title:this.vars.mess.settingsSave,action:function(){i.SaveSettings();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["formSettingsDialog"+this.name].Show();var e=document["form_settings_"+this.name];if(t)e.appendChild(BX("form_settings_"+this.name));var s;this.aTabsEdit=[];for(s in this.oTabsMeta){var n=[];for(var a in this.oTabsMeta[s].fields)n[n.length]=BX.clone(this.oTabsMeta[s].fields[a]);this.aTabsEdit[this.aTabsEdit.length]=BX.clone(this.oTabsMeta[s]);this.aTabsEdit[this.aTabsEdit.length-1].fields=n}jsSelectUtils.deleteAllOptions(e.tabs);for(s in this.aTabsEdit)e.tabs.options[e.tabs.length]=new Option(this.aTabsEdit[s].name,this.aTabsEdit[s].id,false,false);e.tabs.selectedIndex=0;this.OnSettingsChangeTab();this.aAvailableFields=BX.clone(this.oFields);jsSelectUtils.deleteAllOptions(e.all_fields);for(s in this.aAvailableFields)e.all_fields.options[e.all_fields.length]=new Option(this.aAvailableFields[s].name,this.aAvailableFields[s].id,false,false);jsSelectUtils.sortSelect(e.all_fields);this.HighlightSections(e.all_fields);this.ProcessButtons();e.tabs.focus()};this.OnSettingsChangeTab=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;jsSelectUtils.deleteAllOptions(t.fields);for(var i in this.aTabsEdit[e].fields){var s=new Option(this.aTabsEdit[e].fields[i].name,this.aTabsEdit[e].fields[i].id,false,false);if(this.aTabsEdit[e].fields[i].type=="section")s.className="bx-section";t.fields.options[t.fields.length]=s}this.ProcessButtons()};this.TabMoveUp=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e>0){var i=BX.clone(this.aTabsEdit[e]);var s=BX.clone(this.aTabsEdit[e-1]);this.aTabsEdit[e]=s;this.aTabsEdit[e-1]=i}jsSelectUtils.moveOptionsUp(t.tabs)};this.TabMoveDown=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e<t.tabs.length-1){var i=BX.clone(this.aTabsEdit[e]);this.aTabsEdit[e]=BX.clone(this.aTabsEdit[e+1]);this.aTabsEdit[e+1]=i}jsSelectUtils.moveOptionsDown(t.tabs)};this.TabEdit=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e<0)return;this.ShowTabSettings(this.aTabsEdit[e],function(){var s=document["tab_settings_"+i.name];i.aTabsEdit[e].name=s.tab_name.value;i.aTabsEdit[e].title=s.tab_title.value;t.tabs[e].text=s.tab_name.value})};this.TabAdd=function(){this.ShowTabSettings({name:"",title:""},function(){var t="tab_"+Math.round(Math.random()*1e6);var e=document["tab_settings_"+i.name];i.aTabsEdit[i.aTabsEdit.length]={id:t,name:e.tab_name.value,title:e.tab_title.value,fields:[]};var s=document["form_settings_"+i.name];s.tabs[s.tabs.length]=new Option(e.tab_name.value,t,true,true);i.OnSettingsChangeTab()})};this.TabDelete=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e<0)return;var i;for(i in this.aTabsEdit[e].fields){this.aAvailableFields[this.aTabsEdit[e].fields[i].id]=this.aTabsEdit[e].fields[i];jsSelectUtils.addNewOption(t.all_fields,this.aTabsEdit[e].fields[i].id,this.aTabsEdit[e].fields[i].name,true,false)}this.HighlightSections(t.all_fields);this.aTabsEdit=BX.util.deleteFromArray(this.aTabsEdit,e);t.tabs.remove(e);if(t.tabs.length>0){i=e<t.tabs.length?e:t.tabs.length-1;t.tabs[i].selected=true;this.OnSettingsChangeTab()}else{jsSelectUtils.deleteAllOptions(t.fields);this.ProcessButtons()}};this.ShowTabSettings=function(t,e){var i=this.tabSettingsWnd;if(!i){this.tabSettingsWnd=i=new BX.CDialog({content:'<form name="tab_settings_'+this.name+'">'+'<table width="100%">'+"<tr>"+'<td width="50%" align="right">'+this.vars.mess.tabSettingsName+"</td>"+'<td><input type="text" name="tab_name" size="30" value="" style="width:90%"></td>'+"</tr>"+"<tr>"+'<td align="right">'+this.vars.mess.tabSettingsCaption+"</td>"+'<td><input type="text" name="tab_title" size="30" value="" style="width:90%"></td>'+"</tr>"+"</table>"+"</form>",title:this.vars.mess.tabSettingsTitle,width:this.vars.tabSettingWndSize.width,height:this.vars.tabSettingWndSize.height,resize_id:"InterfaceFormTabSettingWnd"})}i.ClearButtons();i.SetButtons([{title:this.vars.mess.tabSettingsSave,action:function(){e();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);i.Show();var s=document["tab_settings_"+this.name];s.tab_name.value=t.name;s.tab_title.value=t.title;s.tab_name.focus()};this.ShowFieldSettings=function(t,e){var i=this.fieldSettingsWnd;if(!i){this.fieldSettingsWnd=i=new BX.CDialog({content:'<form name="field_settings_'+this.name+'">'+'<table width="100%">'+"<tr>"+'<td width="50%" align="right" id="field_name_'+this.name+'"></td>'+'<td><input type="text" name="field_name" size="30" value="" style="width:90%"></td>'+"</tr>"+"</table>"+"</form>",width:this.vars.fieldSettingWndSize.width,height:this.vars.fieldSettingWndSize.height,resize_id:"InterfaceFormFieldSettingWnd"})}i.SetTitle(t.type&&t.type=="section"?this.vars.mess.sectSettingsTitle:this.vars.mess.fieldSettingsTitle);BX("field_name_"+this.name).innerHTML=t.type&&t.type=="section"?this.vars.mess.sectSettingsName:this.vars.mess.fieldSettingsName;i.ClearButtons();i.SetButtons([{title:this.vars.mess.tabSettingsSave,action:function(){e();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);i.Show();var s=document["field_settings_"+this.name];s.field_name.value=t.name;s.field_name.focus()};this.FieldEdit=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;var s=t.fields.selectedIndex;if(e<0||s<0)return;this.ShowFieldSettings(this.aTabsEdit[e].fields[s],function(){var n=document["field_settings_"+i.name];i.aTabsEdit[e].fields[s].name=n.field_name.value;t.fields[s].text=n.field_name.value})};this.FieldAdd=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e<0)return;this.ShowFieldSettings({name:"",type:"section"},function(){var s="field_"+Math.round(Math.random()*1e6);var n=document["field_settings_"+i.name];i.aTabsEdit[e].fields[i.aTabsEdit[e].fields.length]={id:s,name:n.field_name.value,type:"section"};var a=new Option(n.field_name.value,s,true,true);a.className="bx-section";t.fields[t.fields.length]=a;i.ProcessButtons()})};this.FieldsMoveUp=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;var i=t.fields.length;for(var s=0;s<i;s++){if(t.fields[s].selected&&s>0&&t.fields[s-1].selected==false){var n=BX.clone(this.aTabsEdit[e].fields[s]);this.aTabsEdit[e].fields[s]=BX.clone(this.aTabsEdit[e].fields[s-1]);this.aTabsEdit[e].fields[s-1]=n;var a=new Option(t.fields[s].text,t.fields[s].value);var r=new Option(t.fields[s-1].text,t.fields[s-1].value);a.className=t.fields[s].className;r.className=t.fields[s-1].className;t.fields[s]=r;t.fields[s].selected=false;t.fields[s-1]=a;t.fields[s-1].selected=true}}};this.FieldsMoveDown=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;var i=t.fields.length;for(var s=i-1;s>=0;s--){if(t.fields[s].selected&&s<i-1&&t.fields[s+1].selected==false){var n=BX.clone(this.aTabsEdit[e].fields[s]);this.aTabsEdit[e].fields[s]=BX.clone(this.aTabsEdit[e].fields[s+1]);this.aTabsEdit[e].fields[s+1]=n;var a=new Option(t.fields[s].text,t.fields[s].value);var r=new Option(t.fields[s+1].text,t.fields[s+1].value);a.className=t.fields[s].className;r.className=t.fields[s+1].className;t.fields[s]=r;t.fields[s].selected=false;t.fields[s+1]=a;t.fields[s+1].selected=true}}};this.FieldsAdd=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e==-1)return;var i=this.aTabsEdit[e].fields;var s=t.all_fields.length,n;for(n=0;n<s;n++)if(t.all_fields[n].selected)i[i.length]={id:t.all_fields[n].value,name:t.all_fields[n].text,type:this.aAvailableFields[t.all_fields[n].value].type};jsSelectUtils.addSelectedOptions(t.all_fields,t.fields,false,false);jsSelectUtils.deleteSelectedOptions(t.all_fields);for(n=0,s=t.fields.length;n<s;n++)if(i[n].type=="section")t.fields[n].className="bx-section";this.ProcessButtons()};this.FieldsDelete=function(){var t=document["form_settings_"+this.name];var e=t.tabs.selectedIndex;if(e==-1)return;var i=t.fields.length;var s=0;for(var n=0;n<i;n++){if(t.fields[n].selected){this.aAvailableFields[t.fields[n].value]=this.aTabsEdit[e].fields[n-s];this.aTabsEdit[e].fields=BX.util.deleteFromArray(this.aTabsEdit[e].fields,n-s);s++}}jsSelectUtils.addSelectedOptions(t.fields,t.all_fields,false,true);jsSelectUtils.deleteSelectedOptions(t.fields);this.HighlightSections(t.all_fields);this.ProcessButtons()};this.ProcessButtons=function(){var t=document["form_settings_"+this.name];t.add_btn.disabled=t.all_fields.selectedIndex==-1||t.tabs.selectedIndex==-1;t.del_btn.disabled=t.up_btn.disabled=t.down_btn.disabled=t.field_edit_btn.disabled=t.fields.selectedIndex==-1;t.tab_up_btn.disabled=t.tab_down_btn.disabled=t.tab_edit_btn.disabled=t.tab_del_btn.disabled=t.field_add_btn.disabled=t.tabs.selectedIndex==-1};this.HighlightSections=function(t){for(var e=0,i=t.length;e<i;e++)if(this.aAvailableFields[t[e].value].type=="section")t[e].className="bx-section"};this.SaveSettings=function(){var t={FORM_ID:this.name,action:"savesettings",sessid:this.vars.sessid,tabs:this.aTabsEdit};var e=document["form_settings_"+this.name];if(e&&e["set_default_settings"]){t.set_default_settings=e.set_default_settings.checked?"Y":"N";t.delete_users_settings=e.delete_users_settings.checked?"Y":"N"}BX.ajax.post("/bitrix/components"+i.vars.component_path+"/settings.php",t,function(){i.Reload()})};this.SaveSettings=function(t){if(!BX.type.isPlainObject(t)){t={}}var e=BX.type.isFunction(t["callback"])?t["callback"]:null;var s={FORM_ID:this.name,action:"savesettings",sessid:this.vars.sessid,tabs:this.aTabsEdit};var n=document["form_settings_"+this.name];if(n&&n["set_default_settings"]){s["set_default_settings"]=n.set_default_settings.checked?"Y":"N";s["delete_users_settings"]=n.delete_users_settings.checked?"Y":"N"}else{if(BX.type.isBoolean(t["setDefaultSettings"])){s["set_default_settings"]=t["setDefaultSettings"]?"Y":"N"}if(BX.type.isBoolean(t["deleteUserSettings"])){s["delete_users_settings"]=t["deleteUserSettings"]?"Y":"N"}}var a="/bitrix/components"+i.vars.component_path+"/settings.php";if(e){BX.ajax.post(a,s,e)}else{BX.ajax.post(a,s,function(){i.Reload()})}};this.EnableSettings=function(t,e){var s="/bitrix/components"+this.vars.component_path+"/settings.php?FORM_ID="+this.name+"&action=enable&enabled="+(t?"Y":"N")+"&sessid="+this.vars.sessid;if(BX.type.isFunction(e)){BX.ajax.get(s,e)}else{BX.ajax.get(s,function(){i.Reload()})}};this.Reload=function(){var t=this.vars.ajax.AJAX_ID;if(t!=""){var e=BX.util.remove_url_param(this.vars.current_url,"bxajaxid");if(e[e.length-1]==="?"){e=e.substr(0,e.length-1)}BX.ajax.insertToNode(e+(e.indexOf("?")<0?"?":"&")+"bxajaxid="+t,"comp_"+t)}else{window.location=window.location.href}};this.ReloadActiveTab=function(){var t=this.name+"_active_tab";var e=BX.util.remove_url_param(this.vars.current_url,t);if(e[e.length-1]==="?"){e=e.substr(0,e.length-1)}e+=(e.indexOf("?")<0?"?":"&")+t+"="+this.GetActiveTabId();var i=this.vars.ajax.AJAX_ID;if(i!=""){BX.ajax.insertToNode(e+"&bxajaxid="+i,"comp_"+i)}else{window.location=e}};this.SetViewModeVisibility=function(t){t=!!t;if(this.isVisibleInViewMode===t){return}this.isVisibleInViewMode=t;var e=BX("container_"+this.name.toLowerCase());if(e){e.style.display=this.isVisibleInViewMode?"":"none"}BX.userOptions.save("main.interface.form",this.name,"show_in_view_mode",t?"Y":"N",false)}}BX.CmrSidebarFieldSelector=function(){this._id="";this._fieldId="";this._currentItem=null;this._elem=null;this._settings={};this._items={};this._popupMenu=null};BX.CmrSidebarFieldSelector.prototype={initialize:function(t,e,i,s){this._id=t;this._fieldId=e;this._elem=i;this._settings=s;this._items={};var n=this.getSettings("options",null);if(n){for(var a=0;a<n.length;a++){var r=n[a];if(BX.type.isNotEmptyString(r["id"])){var o=r["id"];this._items[o]=BX.CmrSidebarFieldSelectorItem.create(o,this,{text:BX.type.isNotEmptyString(r["caption"])?r["caption"]:o})}}}BX.bind(this._elem,"click",BX.proxy(this._onElementClick,this));var l=BX(this.getSettings("buttonId",""));if(l){BX.bind(l,"click",BX.proxy(this._onElementClick,this))}},getSettings:function(t,e){var i=this._settings;return i[t]?i[t]:e},getFieldId:function(){return this._fieldId},getCurrentItem:function(){return this._currentItem},setCurrentItemId:function(t,e){var i=null;for(var s in this._items){if(!this._items.hasOwnProperty(s)){continue}if(this._items[s].getId()===t){i=this._items[s]}}if(!i){return}this._currentItem=i;if(this._elem){this._elem.innerHTML=i.getTitle()}e=!!e;if(e){var n=BX.CrmInstantEditor.getDefault();if(n){n.saveFieldValue(this._fieldId,i.getId())}BX.CmrSidebarFieldSelector._synchronize(this)}},_onElementClick:function(t){var e=[];for(var i in this._items){if(!this._items.hasOwnProperty(i)){continue}var s=this._items[i].createMenuItem();if(s){e.push(s)}}BX.PopupMenu.show(this._id,this._elem,e,{offsetTop:0,offsetLeft:0});this._popupMenu=BX.PopupMenu.currentItem},handleItemChange:function(t){if(this._popupMenu&&this._popupMenu.popupWindow){this._popupMenu.popupWindow.close()}this.setCurrentItemId(t.getId(),true)}};BX.CmrSidebarFieldSelector.items={};BX.CmrSidebarFieldSelector.create=function(t,e,i,s){var n=new BX.CmrSidebarFieldSelector;n.initialize(t,e,i,s);this.items[t]=n;return n};BX.CmrSidebarFieldSelector._synchronize=function(t){var e=t.getCurrentItem();if(!e){return}var i=t.getFieldId();for(var s in this.items){if(!this.items.hasOwnProperty(s)){continue}var n=this.items[s];if(n===t){continue}if(i===n.getFieldId()){n.setCurrentItemId(e.getId(),false)}}};BX.CmrSidebarFieldSelectorItem=function(){this._id="";this._parent=null;this._settings={}};BX.CmrSidebarFieldSelectorItem.prototype={initialize:function(t,e,i){this._id=t;this._parent=e;this._settings=i},getSettings:function(t,e){var i=this._settings;return i[t]?i[t]:e},getId:function(){return this._id},getTitle:function(){return this.getSettings("text",this._id)},createMenuItem:function(){return{text:this.getTitle(),onclick:BX.proxy(this._onMenuItemClick,this)}},_onMenuItemClick:function(){if(this._parent){this._parent.handleItemChange(this)}}};BX.CmrSidebarFieldSelectorItem.create=function(t,e,i){var s=new BX.CmrSidebarFieldSelectorItem;s.initialize(t,e,i);return s};BX.CrmSidebarUserSelector=function(){this._id="";this._settings={};this._button=null;this._container=null;this.componentName="";this._componentContainer=null;this._componentObj=null;this._fieldId="";this._editor=null;this._dlg=null;this._dlgDisplayed=false;this._userInfo=null;this._userInfoProvider=null;this._enableLazyLoad=false;this._isLoaded=false;this._serviceUrl="";this._options={};this._userSelectorScriptLoaded=null};BX.CrmSidebarUserSelector.prototype={initialize:function(t,e,i,s,n){this._id=BX.type.isNotEmptyString(t)?t:"crm_sidebar_user_sel_"+Math.random();if(!BX.type.isElementNode(e)){throw"BX.CrmSidebarUserSelector: button is not defined"}this._button=e;if(!BX.type.isElementNode(i)){throw"BX.CrmSidebarUserSelector: container is not defined"}this._container=i;if(!BX.type.isNotEmptyString(s)){throw"BX.CrmSidebarUserSelector: componentName is not defined"}this.componentName=s;this._options=n?n:{};this._enableLazyLoad=this.getOption("enableLazyLoad",false);this._serviceUrl=this.getOption("serviceUrl","");if(!this._enableLazyLoad){this._componentContainer=BX(s+"_selector_content");var a="O_"+s;if(window[a]){this._componentObj=window[a];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this);this._isLoaded=true}}BX.bind(this._button,"click",BX.delegate(this._handleButtonClick,this));this._fieldId=this.getStringOption("fieldId");this._userInfoProvider=BX.CrmUserInfoProvider.getItemById(this.getStringOption("userInfoProviderId"));if(this._fieldId!==""){var r=this.getOption("editorId","");if(r!==""){var o=BX.CrmInstantEditor.items[r];if(o){this._setupEditor(o)}else{BX.addCustomEvent("CrmInstantEditorCreated",BX.delegate(this._handleEditorCreation,this))}}}},openDialog:function(){this._dlg=new BX.PopupWindow(this._id,this._button,{autoHide:true,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(function(){this._dlgDisplayed=true},this),onPopupClose:BX.delegate(function(){this._dlgDisplayed=false;this._dlg.destroy()},this),onPopupDestroy:BX.delegate(function(){this._dlg=null},this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},getSetting:function(t,e){return this._settings[t]?this._settings[t]:e},getOption:function(t,e){return this._options.hasOwnProperty(t)?this._options[t]:e},getStringOption:function(t){return BX.type.isNotEmptyString(this._options[t])?this._options[t]:""},layout:function(){this._container.href=this._userInfo?this._userInfo.getProfileUrl():"#";var t=BX.findChild(this._container,{className:"crm-detail-info-resp-name"},true,false);if(t){t.innerHTML=BX.util.htmlspecialchars(this._userInfo?this._userInfo.getFullName():"")}var e=BX.findChild(this._container,{className:"crm-detail-info-resp-descr"},true,false);if(e){e.innerHTML=BX.util.htmlspecialchars(this._userInfo?this._userInfo.getWorkPosition():"")}var i=BX.findChild(this._container,{className:"crm-detail-info-resp-img"},true,false);if(i){BX.cleanNode(i,false);i.appendChild(BX.create("IMG",{attrs:{src:this._userInfo?this._userInfo.getPhotoUrl():""}}))}},toggleDialog:function(){if(this._dlg&&this._dlgDisplayed){this.closeDialog()}else{this.openDialog()}},_handleButtonClick:function(){if(this._isLoaded){this.toggleDialog();return}if(this._enableLazyLoad&&this._serviceUrl!==""){this._userSelectorScriptLoaded=BX.delegate(this._handleUserSelectorScriptLoaded,this);BX.addCustomEvent("onAjaxSuccessFinish",this._userSelectorScriptLoaded);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{MODE:"GET_USER_SELECTOR",NAME:this.componentName},onsuccess:BX.delegate(this._handleUserSelectorHtmlLoaded,this)})}},_handleUserSelectorHtmlLoaded:function(t){this._container.parentNode.appendChild(BX.create("DIV",{html:t}));this._isLoaded=true},_handleUserSelectorScriptLoaded:function(t){if(t["url"]!==this._serviceUrl){return}BX.removeCustomEvent("onAjaxSuccessFinish",this._userSelectorScriptLoaded);this._userSelectorScriptLoaded=null;this._componentContainer=BX(this.componentName+"_selector_content");var e="O_"+this.componentName;if(window[e]){this._componentObj=window[e];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this)}this.openDialog()},_handleUserSelect:function(t){this.closeDialog();if(!this._userInfoProvider){return}var e=this;this._userInfoProvider.getInfo(t.id,function(t){e._userInfo=t;e.layout();if(e._fieldId.length>0){var i=e._editor;if(!i){i=BX.CrmInstantEditor.getDefault()}if(i){i.saveFieldValue(e._fieldId,t.getId())}}})},_handleEditorCreation:function(t){var e=this.getOption("editorId","");if(e!==""&&t.getId()===e){this._setupEditor(t)}},_handleEditorFieldValueSaved:function(t,e){if(this._fieldId!==t||!this._userInfoProvider){return}if(this._userInfo&&this._userInfo.getId()===e){return}var i=this;this._userInfoProvider.getInfo(e,function(t){i._userInfo=t;i.layout()})},_setupEditor:function(t){if(this._editor){BX.removeCustomEvent(this._editor,"CrmInstantEditorFieldValueSaved",BX.delegate(this._handleEditorFieldValueSaved,this))}this._editor=t;if(this._editor){BX.addCustomEvent(this._editor,"CrmInstantEditorFieldValueSaved",BX.delegate(this._handleEditorFieldValueSaved,this))}}};BX.CrmSidebarUserSelector.create=function(t,e,i,s,n){var a=new BX.CrmSidebarUserSelector;a.initialize(t,e,i,s,n);return a};BX.CrmUserSearchField=function(){this._id="";this._search_input=null;this._data_input=null;this._componentName="";this._componentContainer=null;this._componentObj=null;this._dlg=null;this._dlgDisplayed=false;this._currentUser={}};BX.CrmUserSearchField.prototype={initialize:function(t,e,i,s,n){this._id=BX.type.isNotEmptyString(t)?t:"crm_user_search_field_"+Math.random();if(!BX.type.isElementNode(e)){throw"BX.CrmUserSearchField: 'search_input' is not defined!"}this._search_input=e;if(!BX.type.isElementNode(i)){throw"BX.CrmUserSearchField: 'data_input' is not defined!"}this._data_input=i;if(!BX.type.isNotEmptyString(s)){throw"BX.CrmUserSearchField: 'componentName' is not defined!"}this._componentName=s;this._componentContainer=BX(s+"_selector_content");var a="O_"+s;if(window[a]){this._componentObj=window[a];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this);this._componentObj.searchInput=e;BX.bind(e,"keyup",BX.proxy(this._handleSearchKey,this));BX.bind(e,"focus",BX.proxy(this._handleSearchFocus,this));BX.bind(document,"click",BX.delegate(this._handleExternalClick,this))}this._currentUser=n?n:{};this._adjustUser()},openDialog:function(){this._dlg=new BX.PopupWindow(this._id,this._search_input,{autoHide:false,draggable:false,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(function(){this._dlgDisplayed=true},this),onPopupClose:BX.delegate(function(){this._dlgDisplayed=false;this._dlg.destroy()},this),onPopupDestroy:BX.delegate(function(){this._dlg=null},this)}});this._dlg.show()},_adjustUser:function(){this._search_input.value=this._currentUser["name"]?this._currentUser.name:"";this._data_input.value=this._currentUser["id"]?this._currentUser.id:0},closeDialog:function(){if(this._dlg){this._dlg.close()}},_handleExternalClick:function(t){if(!t){t=window.event}if(t.target!==this._search_input&&!BX.findParent(t.target,{attribute:{id:this._componentName+"_selector_content"}})){this._adjustUser();this.closeDialog()}},_handleSearchKey:function(t){if(!this._dlg||!this._dlgDisplayed){this.openDialog()}this._componentObj.search()},_handleSearchFocus:function(t){if(!this._dlg||!this._dlgDisplayed){this.openDialog()}this._componentObj._onFocus(t)},_handleUserSelect:function(t){this._currentUser=t;this._adjustUser();this.closeDialog()}};BX.CrmUserSearchField.items={};BX.CrmUserSearchField.create=function(t,e,i,s,n){var a=new BX.CrmUserSearchField;a.initialize(t,e,i,s,n);this.items[t]=a;return a};BX.CrmUserLinkField=function(){this._settings={};this._container=null;this._fieldId="";this._editor=null;this._userInfoProvider=null;this._userInfo=null};BX.CrmUserLinkField.prototype={initialize:function(t){this._settings=t?t:{};this._container=this.getSetting("container",null);if(!this._container){this._container=BX(this.getSetting("containerId",""))}if(!this._container){throw"BX.CrmUserLinkField: container is not found"}this._userInfoProvider=BX.CrmUserInfoProvider.getItemById(this.getSetting("userInfoProviderId",""));this._userInfo=this.getSetting("userInfo",null);this._fieldId=this.getSetting("fieldId","");if(this._fieldId!==""){var e=this.getSetting("editorId","");if(e!==""){var i=BX.CrmInstantEditor.items[e];if(i){this._setupEditor(i)}else{BX.addCustomEvent("CrmInstantEditorCreated",BX.delegate(this._handleEditorCreation,this))}}}},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},layout:function(){this._container.href=this._userInfo?this._userInfo.getProfileUrl():"#";var t=BX.findChild(this._container,{className:"crm-detail-info-resp-name"},true,false);if(t){t.innerHTML=BX.util.htmlspecialchars(this._userInfo?this._userInfo.getFullName():"")}var e=BX.findChild(this._container,{className:"crm-detail-info-resp-descr"},true,false);if(e){e.innerHTML=BX.util.htmlspecialchars(this._userInfo?this._userInfo.getWorkPosition():"")}var i=BX.findChild(this._container,{className:"crm-detail-info-resp-img"},true,false);if(i){BX.cleanNode(i,false);i.appendChild(BX.create("IMG",{attrs:{src:this._userInfo?this._userInfo.getPhotoUrl():""}}))}},_handleEditorCreation:function(t){var e=this.getSetting("editorId","");if(e!==""&&t.getId()===e){this._setupEditor(t)}},_setupEditor:function(t){if(this._editor){BX.removeCustomEvent(this._editor,"CrmInstantEditorFieldValueSaved",BX.delegate(this._handleEditorFieldValueSaved,this))}this._editor=t;if(this._editor){BX.addCustomEvent(this._editor,"CrmInstantEditorFieldValueSaved",BX.delegate(this._handleEditorFieldValueSaved,this))}},_handleEditorFieldValueSaved:function(t,e){if(this._fieldId!==t||!this._userInfoProvider){return}var i=this;this._userInfoProvider.getInfo(e,function(t){i._userInfo=t;i.layout()})}};BX.CrmUserLinkField.create=function(t){var e=new BX.CrmUserLinkField;e.initialize(t);return e};BX.CrmUserInfo=function(){this._data={}};BX.CrmUserInfo.prototype={initialize:function(t){this._data=t?t:{}},getId:function(){return BX.type.isNotEmptyString(this._data["ID"])?this._data["ID"]:""},getProfileUrl:function(){return BX.type.isNotEmptyString(this._data["USER_PROFILE"])?this._data["USER_PROFILE"]:""},getFullName:function(){return BX.type.isNotEmptyString(this._data["FULL_NAME"])?this._data["FULL_NAME"]:""},getWorkPosition:function(){return BX.type.isNotEmptyString(this._data["WORK_POSITION"])?this._data["WORK_POSITION"]:""},getPhotoUrl:function(){return BX.type.isNotEmptyString(this._data["PERSONAL_PHOTO"])?this._data["PERSONAL_PHOTO"]:""}};BX.CrmUserInfo.items={};BX.CrmUserInfo.create=function(t){var e=new BX.CrmUserInfo;e.initialize(t);this.items[e.getId()]=e;return e};BX.CrmUserInfoProvider=function(){this._id="";this._settings={};this._serviceUrl="";this._items={}};BX.CrmUserInfoProvider.prototype={initialize:function(t,e){if(!BX.type.isNotEmptyString(t)){throw"BX.CrmUserInfoProvider: id is not defined"}this._id=t;this._settings=e?e:{};var i=this.getSetting("serviceUrl","");if(i===""){throw"BX.CrmUserInfoProvider: serviceUrl is not found"}this._serviceUrl=i},getId:function(){return this._id},getSetting:function(t,e){return this._settings[t]?this._settings[t]:e},getInfo:function(t,e){if(!BX.type.isString(t)){t=t.toString()}if(!BX.type.isNotEmptyString(t)){if(BX.type.isFunction(e)){e(null)}return}if(typeof this._items[t]!=="undefined"){if(BX.type.isFunction(e)){e(this._items[t])}return}var i=this;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{MODE:"GET_USER_INFO",USER_ID:t,USER_PROFILE_URL_TEMPLATE:this.getSetting("userProfileUrlTemplate","")},onsuccess:function(s){var n=BX.CrmUserInfo.create(s["USER_INFO"]?s["USER_INFO"]:{});i._items[t]=n;if(BX.type.isFunction(e)){e(n)}},onfailure:function(t){i._showError(i.getMessage("generalError"));if(BX.type.isFunction(e)){e(null)}}})},getMessage:function(t){var e=BX.CrmUserInfoProvider.messages;return typeof e[t]!=="undefined"?e[t]:""},_showError:function(t){alert(t)}};BX.CrmUserInfoProvider.items={};BX.CrmUserInfoProvider.getItemById=function(t){return typeof this.items[t]?this.items[t]:null};BX.CrmUserInfoProvider.createIfNotExists=function(t,e){
if(typeof this.items[t]!=="undefined"){return this.items[t]}var i=new BX.CrmUserInfoProvider;i.initialize(t,e);this.items[i.getId()]=i;return i};if(typeof BX.CrmUserInfoProvider.messages==="undefined"){BX.CrmUserInfoProvider.messages={}}BX.CrmDateLinkField=function(){this._dataElem=null;this._viewElem=null;this._settings={}};BX.CrmDateLinkField.prototype={initialize:function(t,e,i){if(!BX.type.isElementNode(t)){throw"BX.CrmDateLinkField: 'dataElem' is not defined!"}this._dataElem=t;if(BX.type.isElementNode(e)){this._viewElem=e;BX.bind(e,"click",BX.delegate(this._onViewClick,this))}else{BX.bind(t,"click",BX.delegate(this._onViewClick,this))}this._settings=i?i:{}},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},_onViewClick:function(t){BX.calendar({node:this._viewElem?this._viewElem:this._dataElem,field:this._dataElem,bTime:this.getSetting("showTime",true),bSetFocus:this.getSetting("setFocusOnShow",true),callback:BX.delegate(this._onCalendarSaveValue,this)})},_onCalendarSaveValue:function(t){var e=BX.calendar.ValueToString(t,this.getSetting("showTime",true),false);this._dataElem.value=e;if(this._viewElem){this._viewElem.innerHTML=e}}};BX.CrmDateLinkField.create=function(t,e,i){var s=new BX.CrmDateLinkField;s.initialize(t,e,i);return s};BX.CrmEntityEditor=function(){this._id="";this._settings={};this._readonly=false;this._dlg=null;this._data=null;this._info=null;this._container=null;this._selector=null;this._advInfoContainer=null};BX.CrmEntityEditor.prototype={initialize:function(t,e,i,s){this._id=BX.type.isNotEmptyString(t)?t:"CRM_ENTITY_EDITOR"+Math.random();this._settings=e?e:{};if(!i){i=this._prepareData()}if(!i){throw"BX.CrmEntityEditor: Could not find data!"}this._data=i;this._info=s?s:BX.CrmEntityInfo.create();var n=this.getSetting("entitySelectorId","");if(obCrm&&obCrm[n]){var a=this._selector=obCrm[n];a.AddOnSaveListener(BX.delegate(this._onEntitySelect,this))}var r=this._container=BX(this.getSetting("containerId",""));if(!r){throw"BX.CrmEntityEditor: Could not find field container!"}this._advInfoContainer=BX(this.getSetting("containerId","")+"_descr");BX.bind(BX.findChild(r,{className:"crm-element-item-delete"},true,false),"click",BX.delegate(this._onDeleteButtonClick,this));var o=this.getSetting("buttonChangeIgnore",false);if(!o)BX.bind(BX.findChild(r,{className:"bx-crm-edit-crm-entity-change"},true,false),"click",BX.delegate(this._onChangeButtonClick,this));var l=BX(this.getSetting("buttonAddId",""));BX.bind(l?l:BX.findChild(r,{className:"bx-crm-edit-crm-entity-add"},true,false),"click",BX.delegate(this._onAddButtonClick,this))},getId:function(){return this._id},getTypeName:function(){return this.getSetting("typeName","")},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getData:function(){return this._data},getMessage:function(t){var e=BX.CrmEntityEditor.messages;return BX.type.isNotEmptyString(e[t])?e[t]:""},openDialog:function(t,e){if(this._dlg){this._dlg.setData(this._data);this._dlg.open(t,e);return}switch(this.getTypeName()){case"CONTACT":this._dlg=BX.CrmContactEditDialog.create(this._id,this.getSetting("dialog",{}),this._data,BX.delegate(this._onSaveDialogData,this));break;case"COMPANY":this._dlg=BX.CrmCompanyEditDialog.create(this._id,this.getSetting("dialog",{}),this._data,BX.delegate(this._onSaveDialogData,this));break}if(this._dlg){this._dlg.open(t,e)}},closeDialog:function(){if(this._dlg){this._dlg.close()}},isReadOnly:function(){return this._readonly},setReadOnly:function(t){t=!!t;if(this._readonly===t){return}this._readonly=t;var e=BX.findChild(this._container,{className:"crm-element-item-delete"},true,false);if(e){e.style.display=t?"none":""}var i=BX.findChild(this._container,{className:"bx-crm-entity-buttons-wrapper"},true,false);if(i){i.style.display=t?"none":""}},_prepareData:function(t){var e=this.getTypeName();var i=this.getSetting("enableValuePrefix",false);if(e==="CONTACT"){if(t&&i)t["id"]="C_"+t["id"];return BX.CrmContactData.create(t)}if(e==="COMPANY"){if(t&&i)t["id"]="CO_"+t["id"];return BX.CrmCompanyData.create(t)}if(e==="LEAD"){if(t&&i)t["id"]="L_"+t["id"];return BX.CrmLeadData.create(t)}if(e==="DEAL"){if(t&&i)t["id"]="D_"+t["id"];return BX.CrmDealData.create(t)}if(e==="QUOTE"){if(t&&i)t["id"]="Q_"+t["id"];return BX.CrmQuoteData.create(t)}return null},_onDeleteButtonClick:function(t){if(this._readonly){return}var e=BX(this.getSetting("dataInputId",""));if(e){e.value=0}BX.cleanNode(BX.findChild(this._container,{className:"bx-crm-entity-info-wrapper"},true,false));if(this._advInfoContainer)BX.cleanNode(this._advInfoContainer);BX.onCustomEvent("CrmEntitySelectorChangeValue",[this.getId(),this.getTypeName(),0,this])},_onChangeButtonClick:function(t){if(this._readonly){return}var e=this._selector;if(e){e.Open()}},_onAddButtonClick:function(t){if(this._readonly){return}this._data.reset();this.openDialog(BX.findChild(this._container,{className:"bx-crm-edit-crm-entity-add"},true,false),"CREATE")},_onSaveDialogData:function(t){this._data=this._dlg.getData();var e=this.getSetting("serviceUrl","");var i=this.getSetting("actionName","");if(!(BX.type.isNotEmptyString(e)&&BX.type.isNotEmptyString(i))){return}var s=this;BX.ajax({url:e,method:"POST",dataType:"json",data:{ACTION:i,DATA:this._data.toJSON()},onsuccess:function(t){if(t["ERROR"]){s._showDialogError(t["ERROR"])}else if(!t["DATA"]){s._showDialogError("BX.CrmEntityEditor: Could not find contact data!")}else{s._data=s._prepareData(t["DATA"]);s._info=BX.CrmEntityInfo.create(t["INFO"]?t["INFO"]:{});var e=BX(s.getSetting("newDataInputId",""));if(e){e.value=s._data.getId();BX.onCustomEvent("CrmEntitySelectorChangeValue",[s.getId(),s.getTypeName(),s._data.getId(),s])}s.layout();s.closeDialog()}},onfailure:function(t){s._showDialogError(t["ERROR"]?t["ERROR"]:s.getMessage("unknownError"))}})},layout:function(){var t=BX(this.getSetting("dataInputId",""));if(t){t.value=this._data.getId()}var e=BX.findChild(this._container,{className:"bx-crm-entity-info-wrapper"},true,false);if(!e){return}BX.cleanNode(e);e.appendChild(BX.create("A",{attrs:{className:"bx-crm-entity-info-link",href:this._info.getSetting("url",""),target:"_blank"},text:this._info.getSetting("title",this._data.getId())}));e.appendChild(BX.create("SPAN",{attrs:{className:"crm-element-item-delete"},events:{click:BX.delegate(this._onDeleteButtonClick,this)}}));if(this._advInfoContainer){this._advInfoContainer.innerHTML=this._prepareAdvInfoHTML()}},_onEntitySelect:function(t){var e=this.getTypeName().toLowerCase();var i=t[e]&&t[e][0]?t[e][0]:null;if(!i){return}this._data.setId(i["id"]);this._info=BX.CrmEntityInfo.create(i);this.layout();BX.onCustomEvent("CrmEntitySelectorChangeValue",[this.getId(),this.getTypeName(),i["id"],this])},_showDialogError:function(t){if(this._dlg){this._dlg.showError(t)}},_prepareAdvInfoHTML:function(){var t="";var e,i,s;var n="";var a=[],r=[];e=this._info.getSetting("type",null);if(e){i=this._info.getSetting("advancedInfo",null);if(i){if(i["contactType"]&&i["contactType"]["name"]&&typeof i["contactType"]["name"]==="string"){n=BX.util.trim(i["contactType"]["name"])}if(i["multiFields"]&&i["multiFields"]instanceof Array){var o=i["multiFields"];for(s=0;s<o.length;s++){if(o[s]["TYPE_ID"]&&o[s]["TYPE_ID"]==="PHONE"){a.push({VALUE:BX.util.trim(o[s]["VALUE"])})}if(o[s]["TYPE_ID"]&&o[s]["TYPE_ID"]==="EMAIL"){r.push({VALUE:BX.util.trim(o[s]["VALUE"])})}}}switch(e){case"contact":if(a.length>0){t+='<span class="crm-offer-info-descrip-tem crm-offer-info-descrip-tel">'+this.getMessage("prefPhone")+": "+BX.util.htmlspecialchars(a[0]["VALUE"])+'<a href="callto:'+BX.util.htmlspecialchars(a[0]["VALUE"])+'" class="crm-offer-info-descrip-icon"></a></span><br/>'}if(r.length>0){t+='<span class="crm-offer-info-descrip-tem crm-offer-info-descrip-imail">'+this.getMessage("prefEmail")+": "+BX.util.htmlspecialchars(r[0]["VALUE"])+'<a href="mailto:'+BX.util.htmlspecialchars(r[0]["VALUE"])+'" class="crm-offer-info-descrip-icon"></a></span><br/>'}if(n){t+='<span class="crm-offer-info-descrip-tem crm-offer-info-descrip-type">'+this.getMessage("prefContactType")+": "+BX.util.htmlspecialchars(n)+"</span><br/>"}break;case"company":case"lead":if(a.length>0){t+='<span class="crm-offer-info-descrip-tem crm-offer-info-descrip-tel">'+this.getMessage("prefPhone")+": "+BX.util.htmlspecialchars(a[0]["VALUE"])+'<a href="callto:'+BX.util.htmlspecialchars(a[0]["VALUE"])+'" class="crm-offer-info-descrip-icon"></a></span><br/>'}if(r.length>0){t+='<span class="crm-offer-info-descrip-tem crm-offer-info-descrip-imail">'+this.getMessage("prefEmail")+": "+BX.util.htmlspecialchars(r[0]["VALUE"])+'<a href="mailto:'+BX.util.htmlspecialchars(r[0]["VALUE"])+'" class="crm-offer-info-descrip-icon"></a></span><br/>'}break}}}return t}};if(typeof BX.CrmEntityEditor.messages==="undefined"){BX.CrmEntityEditor.messages={}}BX.CrmEntityEditor.items={};BX.CrmEntityEditor.create=function(t,e,i,s){var n=new BX.CrmEntityEditor;n.initialize(t,e,i,s);this.items[t]=n;return n};BX.CrmContactEditDialog=function(){this._id="";this._settings={};this._dlg=null;this._dlgCfg={};this._data=null;this._mode="CREATE";this._onSaveCallback=null};BX.CrmContactEditDialog.prototype={initialize:function(t,e,i,s){this._id=BX.type.isNotEmptyString(t)?t:"CRM_CONTACT_EDIT_DIALOG_"+Math.random();this._settings=e?e:{};this._data=i?i:BX.CrmContactData.create();this._onSaveCallback=BX.type.isFunction(s)?s:null},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getData:function(){return this._data},setData:function(t){this._data=t?t:BX.CrmContactData.create()},isOpened:function(){return this._dlg&&this._dlg.isShown()},open:function(t,e){if(!BX.type.isNotEmptyString(e)||e!=="CREATE"&&e!=="EDIT"){e=this._mode}if(this._dlg&&this._mode===e){if(!this._dlg.isShown()){this._dlg.show()}return}if(this._mode!==e){this._mode=e}var i=this._dlgCfg={};i["id"]=this._id;this._dlg=new BX.PopupWindow(i["id"],t,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:{content:BX.CrmPopupWindowHelper.prepareTitle(this.getSetting("title","New contact"))},events:{onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this._prepareContent(),buttons:this._prepareButtons()});this._dlg.show()},close:function(){if(this._dlg){this._dlg.close()}},showError:function(t){var e=BX(this._getElementId("errors"));if(e){e.innerHTML=t;e.style.display=""}},_onPopupClose:function(){this._dlg.destroy()},_onPopupDestroy:function(){this._dlg=null},_prepareContent:function(){var t=BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-popup"}});var e=this._data;t.appendChild(BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-error-wrap",style:"display:none"},props:{id:this._getElementId("errors")}}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("lastName"),title:this.getSetting("lastNameTitle","Last Name"),value:e.getLastName()}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("name"),title:this.getSetting("nameTitle","Name"),value:e.getName()}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("secondName"),title:this.getSetting("secondNameTitle","Second Name"),value:e.getSecondName()}));if(this.getSetting("enableEmail",true)){t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("email"),title:this.getSetting("emailTitle","E-mail"),value:e.getEmail()}))}if(this.getSetting("enablePhone",true)){t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("phone"),title:this.getSetting("phoneTitle","Phone"),value:e.getPhone()}))}if(this.getSetting("enableExport",true)){if(this._mode==="CREATE"){e.markAsExportable(true)}t.appendChild(BX.CrmPopupWindowHelper.prepareCheckBoxField({id:this._getElementId("export"),title:this.getSetting("exportTitle","Enable Export"),value:e.isExportable()}))}return t},_prepareButtons:function(){return BX.CrmPopupWindowHelper.prepareButtons([{type:"button",settings:{text:this.getSetting("addButtonName","Add"),className:"popup-window-button-accept",events:{click:BX.delegate(this._onSaveButtonClick,this)}}},{type:"link",settings:{text:this.getSetting("cancelButtonName","Cancel"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}}}])},_getElementId:function(t){return this._dlgCfg["id"]+"_"+t},_onSaveButtonClick:function(){this._data.setLastName(BX(this._getElementId("lastName")).value);this._data.setName(BX(this._getElementId("name")).value);this._data.setSecondName(BX(this._getElementId("secondName")).value);if(this.getSetting("enableEmail",true)){this._data.setEmail(BX(this._getElementId("email")).value)}if(this.getSetting("enablePhone",true)){this._data.setPhone(BX(this._getElementId("phone")).value)}if(this.getSetting("enableExport",true)){this._data.markAsExportable(BX(this._getElementId("export")).checked)}if(this._onSaveCallback){this._onSaveCallback(this)}}};BX.CrmContactEditDialog.create=function(t,e,i,s){var n=new BX.CrmContactEditDialog;n.initialize(t,e,i,s);return n};BX.CrmCompanyEditDialog=function(){this._id="";this._settings={};this._dlg=null;this._dlgCfg={};this._data=null;this._mode="CREATE";this._onSaveCallback=null};BX.CrmCompanyEditDialog.prototype={initialize:function(t,e,i,s){this._id=BX.type.isNotEmptyString(t)?t:"CRM_COMPANY_EDIT_DIALOG_"+Math.random();this._settings=e?e:{};this._data=i?i:BX.CrmCompanyData.create();this._onSaveCallback=BX.type.isFunction(s)?s:null},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getData:function(){return this._data},setData:function(t){this._data=t?t:BX.CrmCompanyData.create()},isOpened:function(){return this._dlg&&this._dlg.isShown()},open:function(t,e){if(!BX.type.isNotEmptyString(e)||e!=="CREATE"&&e!=="EDIT"){e=this._mode}if(this._dlg&&this._mode===e){this._dlg.setContent(this._prepareContent());if(!this._dlg.isShown()){this._dlg.show()}return}if(this._mode!==e){this._mode=e}var i=this._dlgCfg={};i["id"]=this._id;this._dlg=new BX.PopupWindow(i["id"],t,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:{content:BX.CrmPopupWindowHelper.prepareTitle(this.getSetting("title","New contact"))},events:{onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this._prepareContent(),buttons:this._prepareButtons()});this._dlg.show()},close:function(){if(this._dlg){this._dlg.close()}},showError:function(t){var e=BX(this._getElementId("errors"));if(e){e.innerHTML=t;e.style.display=""}},_onPopupClose:function(){this._dlg.destroy()},_onPopupDestroy:function(){this._dlg=null},_prepareContent:function(){var t=BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-popup"}});var e=this._data;t.appendChild(BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-error-wrap",style:"display:none"},props:{id:this._getElementId("errors")}}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("title"),title:this.getSetting("titleTitle","Title"),value:e.getTitle()}));t.appendChild(BX.CrmPopupWindowHelper.prepareSelectField({id:this._getElementId("companyType"),title:this.getSetting("companyTypeTitle","Company Type"),value:e.getCompanyType(),items:this.getSetting("companyTypeItems",null)}));t.appendChild(BX.CrmPopupWindowHelper.prepareSelectField({id:this._getElementId("industry"),title:this.getSetting("industryTitle","Industry"),value:e.getIndustry(),items:this.getSetting("industryItems",null)}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("email"),title:this.getSetting("emailTitle","E-mail"),value:e.getEmail()}));t.appendChild(BX.CrmPopupWindowHelper.prepareTextField({id:this._getElementId("phone"),title:this.getSetting("phoneTitle","Phone"),value:e.getPhone()}));return t},_prepareButtons:function(){return BX.CrmPopupWindowHelper.prepareButtons([{type:"button",settings:{text:this.getSetting("addButtonName","Add"),className:"popup-window-button-accept",events:{click:BX.delegate(this._onSaveButtonClick,this)}}},{type:"link",settings:{text:this.getSetting("cancelButtonName","Cancel"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}}}])},_getElementId:function(t){return this._dlgCfg["id"]+"_"+t},_onSaveButtonClick:function(){this._data.setTitle(BX(this._getElementId("title")).value);this._data.setCompanyType(BX(this._getElementId("companyType")).value);this._data.setIndustry(BX(this._getElementId("industry")).value);this._data.setEmail(BX(this._getElementId("email")).value);this._data.setPhone(BX(this._getElementId("phone")).value);if(this._onSaveCallback){this._onSaveCallback(this)}}};BX.CrmCompanyEditDialog.create=function(t,e,i,s){var n=new BX.CrmCompanyEditDialog;n.initialize(t,e,i,s);return n};BX.CrmContactData=function(){this._id=0;this._name=this._secondName=this._lastName=this._email=this._phone="";this._export=null};BX.CrmContactData.prototype={initialize:function(t){if(!t){return}if(t["id"]){this.setId(t["id"])}if(t["name"]){this.setName(t["name"])}if(t["secondName"]){this.setSecondName(t["secondName"])}if(t["lastName"]){this.setLastName(t["lastName"])}if(t["email"]){this.setEmail(t["email"])}if(t["phone"]){this.setPhone(t["phone"])}if(t["export"]){this.markAsExportable(t["export"])}},reset:function(){this._id=0;this._name=this._secondName=this._lastName=this._email=this._phone="";this._export=null},getId:function(){return this._id},setId:function(t){this._id=t},getName:function(){return this._name},setName:function(t){this._name=BX.type.isNotEmptyString(t)?t:""},getSecondName:function(){return this._secondName},setSecondName:function(t){this._secondName=BX.type.isNotEmptyString(t)?t:""},getLastName:function(){return this._lastName},setLastName:function(t){this._lastName=BX.type.isNotEmptyString(t)?t:""},getEmail:function(){return this._email},setEmail:function(t){this._email=BX.type.isNotEmptyString(t)?t:""},getPhone:function(){return this._phone},setPhone:function(t){this._phone=BX.type.isNotEmptyString(t)?t:""},isExportable:function(){return!!this._export},markAsExportable:function(t){this._export=!!t},toJSON:function(){var t={id:this._id,name:this._name,secondName:this._secondName,lastName:this._lastName,email:this._email,phone:this._phone};if(this._export!==null){t["export"]=this._export?"Y":"N"}return t}};BX.CrmContactData.create=function(t){var e=new BX.CrmContactData;e.initialize(t);return e};BX.CrmCompanyData=function(){this._id=0;this._title=this._companyType=this._industry=this._email=this._phone=this._addressLegal=""};BX.CrmCompanyData.prototype={initialize:function(t){if(!t){return}if(t["id"]){this.setId(t["id"])}if(t["title"]){this.setTitle(t["title"])}if(t["companyType"]){this.setCompanyType(t["companyType"])}if(t["industry"]){this.setIndustry(t["industry"])}if(t["email"]){this.setEmail(t["email"])}if(t["phone"]){this.setPhone(t["phone"])}},reset:function(){this._id=0;this._title=this._companyType=this._industry=this._email=this._phone=this._addressLegal=""},getId:function(){return this._id},setId:function(t){this._id=t},getTitle:function(){return this._title},setTitle:function(t){this._title=BX.type.isNotEmptyString(t)?t:""},getCompanyType:function(){return this._companyType},setCompanyType:function(t){this._companyType=BX.type.isNotEmptyString(t)?t:""},getIndustry:function(){return this._industry},setIndustry:function(t){this._industry=BX.type.isNotEmptyString(t)?t:""},getEmail:function(){return this._email},setEmail:function(t){this._email=BX.type.isNotEmptyString(t)?t:""},getPhone:function(){return this._phone},setPhone:function(t){this._phone=BX.type.isNotEmptyString(t)?t:""},getAddressLegal:function(){return this._addressLegal},setAddressLegal:function(t){this._addressLegal=BX.type.isNotEmptyString(t)?t:""},toJSON:function(){return{id:this.id,title:this._title,companyType:this._companyType,industry:this._industry,email:this._email,phone:this._phone}}};BX.CrmCompanyData.create=function(t){var e=new BX.CrmCompanyData;e.initialize(t);return e};BX.CrmLeadData=function(){this._id=0;this._title=this._name=this._secondName=this._lastName=this._email=this._phone=""};BX.CrmLeadData.prototype={initialize:function(t){if(!t){return}if(t["id"]){this.setId(t["id"])}if(t["title"]){this.setTitle(t["title"])}if(t["name"]){this.setName(t["name"])}if(t["secondName"]){this.setSecondName(t["secondName"])}if(t["lastName"]){this.setLastName(t["lastName"])}if(t["email"]){this.setEmail(t["email"])}if(t["phone"]){this.setPhone(t["phone"])}},reset:function(){this._id=0;this._name=this._secondName=this._lastName=this._email=this._phone=""},getId:function(){return this._id},setId:function(t){this._id=t},getName:function(){return this._name},setTitle:function(t){this._title=BX.type.isNotEmptyString(t)?t:""},setName:function(t){this._name=BX.type.isNotEmptyString(t)?t:""},getSecondName:function(){return this._secondName},setSecondName:function(t){this._secondName=BX.type.isNotEmptyString(t)?t:""},getLastName:function(){return this._lastName},setLastName:function(t){this._lastName=BX.type.isNotEmptyString(t)?t:""},getEmail:function(){return this._email},setEmail:function(t){this._email=BX.type.isNotEmptyString(t)?t:""},getPhone:function(){return this._phone},setPhone:function(t){this._phone=BX.type.isNotEmptyString(t)?t:""},toJSON:function(){return{id:this._id,name:this._name,secondName:this._secondName,lastName:this._lastName,email:this._email,phone:this._phone}}};BX.CrmLeadData.create=function(t){var e=new BX.CrmLeadData;e.initialize(t);return e};BX.CrmDealData=function(){this._id=this._dealPrice=0;this._title=this._dealType=""};BX.CrmDealData.prototype={initialize:function(t){if(!t){return}if(t["id"]){this.setId(t["id"])}if(t["title"]){this.setTitle(t["title"])}if(t["dealType"]){this.setDealType(t["dealType"])}if(t["dealPrice"]){this.setDealType(t["dealPrice"])}},reset:function(){this._id=this._dealPrice=0;this._title=this._dealType=""},getId:function(){return this._id},setId:function(t){this._id=t},getTitle:function(){return this._title},setTitle:function(t){this._title=BX.type.isNotEmptyString(t)?t:""},getDealType:function(){return this._dealType},setDealType:function(t){this._dealType=BX.type.isNotEmptyString(t)?t:""},getDealPrice:function(){return this._dealPrice},setDealPrice:function(t){this._dealPrice=BX.type.isNumber(t)?t:0}};BX.CrmDealData.create=function(t){var e=new BX.CrmDealData;e.initialize(t);return e};BX.CrmQuoteData=function(){this._id=this._quotePrice=0;this._title=this._quoteType=""};BX.CrmQuoteData.prototype={initialize:function(t){if(!t){return}if(t["id"]){this.setId(t["id"])}if(t["title"]){this.setTitle(t["title"])}if(t["quoteType"]){this.setQuoteType(t["quoteType"])}if(t["quotePrice"]){this.setQuoteType(t["quotePrice"])}},reset:function(){this._id=this._quotePrice=0;this._title=this._quoteType=""},getId:function(){return this._id},setId:function(t){this._id=t},getTitle:function(){return this._title},setTitle:function(t){this._title=BX.type.isNotEmptyString(t)?t:""},getQuoteType:function(){return this._quoteType},setQuoteType:function(t){this._quoteType=BX.type.isNotEmptyString(t)?t:""},getQuotePrice:function(){return this._quotePrice},setQuotePrice:function(t){this._quotePrice=BX.type.isNumber(t)?t:0}};BX.CrmQuoteData.create=function(t){var e=new BX.CrmQuoteData;e.initialize(t);return e};BX.CrmEntityInfo=function(){this._settings={}};BX.CrmEntityInfo.prototype={initialize:function(t){this._settings=t?t:{}},getSetting:function(t,e){return this._settings[t]?this._settings[t]:e}};BX.CrmEntityInfo.create=function(t){var e=new BX.CrmEntityInfo;e.initialize(t);return e};BX.CrmPopupWindowHelper={};BX.CrmPopupWindowHelper.prepareButtons=function(t){var e=[];for(var i=0;i<t.length;i++){var s=t[i];e.push(s["type"]==="link"?new BX.PopupWindowButtonLink(s["settings"]):new BX.PopupWindowButton(s["settings"]))}return e};BX.CrmPopupWindowHelper.prepareTextField=function(t){return BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-field"},children:[BX.create("SPAN",{attrs:{className:"bx-crm-dialog-quick-create-field-title"},text:t["title"]+":"}),BX.create("INPUT",{attrs:{className:"bx-crm-dialog-quick-create-field-text-input"},props:{id:t["id"],value:t["value"]}})]})};BX.CrmPopupWindowHelper.prepareSelectField=function(t){var e=BX.create("SELECT",{attrs:{className:"bx-crm-dialog-quick-create-field-select"},props:{id:t["id"]}});var i=t["value"]?t["value"]:"";if(t["items"]){for(var s=0;s<t["items"].length;s++){var n=t["items"][s];var a=n["value"]?n["value"]:s.toString();var r=BX.create("OPTION",{text:n["text"]?n["text"]:a,props:{value:a}});if(!BX.browser.isIE){e.add(r,null)}else{try{e.add(r,e.options[null])}catch(o){e.add(r,null)}}if(a===i){r.selected=true}}}return BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-field"},children:[BX.create("SPAN",{attrs:{className:"bx-crm-dialog-quick-create-field-title"},text:t["title"]+":"}),e]})};BX.CrmPopupWindowHelper.prepareTextAreaField=function(t){return BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-field"},children:[BX.create("SPAN",{attrs:{className:"bx-crm-dialog-quick-create-field-title"},text:t["title"]+":"}),BX.create("TEXTAREA",{attrs:{className:"bx-crm-dialog-quick-create-field-text-input"},props:{id:t["id"]},text:t["value"]})]})};BX.CrmPopupWindowHelper.prepareCheckBoxField=function(t){var e=BX.create("INPUT",{attrs:{className:"bx-crm-dialog-quick-create-field-checkbox"},props:{id:t["id"],type:"checkbox",checked:!!t["value"]?"checked":""}});if(!!t["value"]){e.checked=true}return BX.create("DIV",{attrs:{className:"bx-crm-dialog-quick-create-field"},children:[BX.create("LABEL",{attrs:{className:"bx-crm-dialog-quick-create-field-checkbox-label"},children:[e,BX.create("SPAN",{attrs:{className:"bx-crm-dialog-quick-create-field-checkbox-label-text"},text:t["title"]})]})]})};BX.CrmPopupWindowHelper.prepareTitle=function(t){return BX.create("DIV",{attrs:{className:"bx-crm-dialog-tittle-wrap"},children:[BX.create("SPAN",{text:t,props:{className:"bx-crm-dialog-title-text"}})]})};BX.CrmEntityDetailViewDialog=function(){this._id="";this._dlg=null;this._settings={}};BX.CrmEntityDetailViewDialog.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"CRM_ENTITY_DETAIL_VIEW_DIALOG_"+Math.random();this._settings=e?e:{}},getId:function(){return this._id},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},isOpened:function(){return this._dlg&&this._dlg.isShown()},open:function(){if(this._dlg){if(!this._dlg.isShown()){this._dlg.show()}return}var t=BX(this.getSetting("containerId"));if(!t){t=BX.findChild(BX("sidebar"),{"class":"crm-entity-info-details-container"},true,false)}this._dlg=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:{content:BX.CrmPopupWindowHelper.prepareTitle(this.getSetting("title","Details"))},events:{onAfterPopupShow:BX.delegate(this._onAfterPopupShow,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:t});this._dlg.show()},close:function(){if(this._dlg&&this._dlg.isShown()){this._dlg.close()}},toggle:function(){this.isOpened()?this.close():this.open()},_onAfterPopupShow:function(){var t=BX.findChild(BX("sidebar"),{"class":"sidebar-block"},true,false);if(!t){return}var e=BX.pos(t);var i=this._dlg.popupContainer;if(!i){return}var s=BX.pos(i);i.style.top=e.top.toString()+"px";i.style.left=(e.left-s.width-1).toString()+"px"},_onPopupDestroy:function(){this._dlg=null}};BX.CrmEntityDetailViewDialog.items={};BX.CrmEntityDetailViewDialog.create=function(t,e){var i=new BX.CrmEntityDetailViewDialog;i.initialize(t,e);this.items[i.getId()]=i;return i};BX.CrmEntityDetailViewDialog.ensureCreated=function(t,e){return typeof this.items[t]!=="undefined"?this.items[t]:this.create(t,e)};BX.CrmContactEditor=function(){this._id="";this._settings={};this._dlg=null;this._clientField=null;this._mode="CREATE"};BX.CrmContactEditor.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};var i=this.getSetting("data",null);if(i){this._mode="EDIT"}else{i={};this._mode="CREATE"}this._data=BX.CrmContactData.create(i)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},openDialog:function(t){if(this._dlg){this._dlg.setData(this._data);this._dlg.open(t);return}this._dlg=BX.CrmContactEditDialog.create(this._id,this.getSetting("dialog",{}),this._data,BX.delegate(this._onSaveDialogData,this));if(this._dlg){this._dlg.open(t,this._mode)}},closeDialog:function(){if(this._dlg){this._dlg.close()}},openExternalFieldEditor:function(t){this._clientField=t;this.openDialog()},_onSaveDialogData:function(t){this._data=this._dlg.getData();var e=this.getSetting("serviceUrl","");var i=this.getSetting("actionName","");if(!(BX.type.isNotEmptyString(e)&&BX.type.isNotEmptyString(i))){return}var s=this;BX.ajax({url:e,method:"POST",dataType:"json",data:{ACTION:i,DATA:this._data.toJSON(),NAME_TEMPLATE:this.getSetting("nameTemplate","")},onsuccess:function(t){if(t["ERROR"]){s._showDialogError(t["ERROR"])}else if(!t["DATA"]){s._showDialogError("BX.CrmContactEditor: Could not find contact data!")}else{s._data=BX.CrmContactData.create(t["DATA"]);var e=t["INFO"]?t["INFO"]:{};s._clientField.setFieldValue(BX.type.isNotEmptyString(e["title"])?BX.util.htmlspecialchars(e["title"]):"");s.closeDialog()}},onfailure:function(t){s._showDialogError(t["ERROR"]?t["ERROR"]:s.getMessage("unknownError"))}})},_showDialogError:function(t){if(this._dlg){this._dlg.showError(t)}}};BX.CrmContactEditor.create=function(t,e){var i=new BX.CrmContactEditor;i.initialize(t,e);return i};BX.CrmSonetSubscription=function(){this._id="";this._settings={}};BX.CrmSonetSubscription.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},enableSubscription:function(t,e,i){var s=this.getSetting("serviceUrl","");var n=this.getSetting("actionName","");if(!(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyString(n))){return}var a=this.getSetting("reload",false);BX.ajax({url:s,method:"POST",dataType:"json",data:{ACTION:n,ENTITY_TYPE:this.getSetting("entityType",""),ENTITY_ID:t,ENABLE:e?"Y":"N"},onsuccess:function(t){if(BX.type.isFunction(i)){i()}},onfailure:function(t){}})},subscribe:function(t,e){this.enableSubscription(t,true,e)},unsubscribe:function(t,e){this.enableSubscription(t,false,e)}};BX.CrmSonetSubscription.items={};BX.CrmSonetSubscription.create=function(t,e){var i=new BX.CrmSonetSubscription;i.initialize(t,e);this.items[t]=i;return i};if(typeof BX.CrmFormTabLazyLoader=="undefined"){BX.CrmFormTabLazyLoader=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._serviceUrl="";this._formId="";this._tabId="";this._params={};this._formManager=null;this._isRequestRunning=false;this._isLoaded=false;this._waiter=null;this._scrollHandler=BX.delegate(this._onWindowScroll,this);this._formManagerHandler=BX.delegate(this._onFormManagerCreate,this)};BX.CrmFormTabLazyLoader.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_lf_disp_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=BX(this.getSetting("containerID",""));if(!this._container){throw"Error: Could not find container."}this._wrapper=BX.findParent(this._container,{tagName:"DIV",className:"bx-edit-tab-inner"});this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"Error. Could not find service url."}this._formId=this.getSetting("formID","");if(!BX.type.isNotEmptyString(this._formId)){
throw"Error: Could not find form id."}this._tabId=this.getSetting("tabID","");if(!BX.type.isNotEmptyString(this._tabId)){throw"Error: Could not find tab id."}this._params=this.getSetting("params",{});var i=window["bxForm_"+this._formId];if(i){this.setFormManager(i)}else{BX.addCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler)}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},load:function(){if(this._isLoaded){return}var t=this._params;t["FORM_ID"]=this._formId;t["TAB_ID"]=this._tabId;this._startRequest(t)},getContainerRect:function(){var t=this._container.getBoundingClientRect();return{top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:typeof t.width!=="undefined"?t.width:t.right-t.left,height:typeof t.height!=="undefined"?t.height:t.bottom-t.top}},isContanerInClientRect:function(){return this.getContainerRect().top<=document.documentElement.clientHeight},setFormManager:function(t){if(this._formManager===t){return}this._formManager=t;if(!this._formManager){return}if(this._formManager.GetActiveTabId()!==this._tabId){BX.addCustomEvent(window,"BX_CRM_INTERFACE_FORM_TAB_SELECTED",BX.delegate(this._onFormTabSelect,this))}else{if(this.isContanerInClientRect()){this.load()}else{BX.bind(window,"scroll",this._scrollHandler)}}},_startRequest:function(t){if(this._isRequestRunning){return false}this._isRequestRunning=true;this._waiter=BX.showWait(this._container);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{LOADER_ID:this._id,PARAMS:t},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}this._container.innerHTML=t;this._isLoaded=true},_onRequestFailure:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}this._isLoaded=true},_onFormManagerCreate:function(t){if(t["name"]===this._formId){BX.removeCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler);this.setFormManager(t)}},_onFormTabSelect:function(t,e,i,s){if(this._formId===e&&(i===this._tabId||this._wrapper===s)){this.load()}},_onWindowScroll:function(t){if(!this._isLoaded&&!this._isRequestRunning&&this.isContanerInClientRect()){BX.unbind(window,"scroll",this._scrollHandler);this.load()}}};BX.CrmFormTabLazyLoader.items={};BX.CrmFormTabLazyLoader.create=function(t,e){var i=new BX.CrmFormTabLazyLoader;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmCustomDragItem==="undefined"){BX.CrmCustomDragItem=function(){this._id="";this._settings={};this._node=null;this._ghostNode=null;this._ghostOffset={x:0,y:0};this._enableDrag=true;this._isInDragMode=false;this._dragNotifier=null;this._bodyOverflow=""};BX.CrmCustomDragItem.prototype={initialize:function(t,e){if(typeof jsDD==="undefined"){throw"CrmCustomDragItem: Could not find jsDD API."}this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(8);this._settings=e?e:{};this._node=this.getSetting("node");if(!this._node){throw"CrmCustomDragItem: The 'node' parameter is not defined in settings or empty."}this._enableDrag=this.getSetting("enableDrag",true);this._ghostOffset=this.getSetting("ghostOffset",{x:0,y:0});this._dragNotifier=BX.CrmNotifier.create(this);this.doInitialize();this.bindEvents()},doInitialize:function(){},release:function(){this.doRelease();this.unbindEvents()},doRelease:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},bindEvents:function(){this._node.onbxdragstart=BX.delegate(this._onDragStart,this);this._node.onbxdrag=BX.delegate(this._onDrag,this);this._node.onbxdragstop=BX.delegate(this._onDragStop,this);this._node.onbxdragrelease=BX.delegate(this._onDragRelease,this);jsDD.registerObject(this._node);this.doBindEvents()},doBindEvents:function(){},unbindEvents:function(){delete this._node.onbxdragstart;delete this._node.onbxdrag;delete this._node.onbxdragstop;delete this._node.onbxdragrelease;if(BX.type.isFunction(jsDD.unregisterObject)){jsDD.unregisterObject(this._node)}this.doUnbindEvents()},doUnbindEvents:function(){},createGhostNode:function(){throw"CrmCustomDragItem: The 'createGhostNode' function is not implemented."},getGhostNode:function(){return this._ghostNode},removeGhostNode:function(){throw"CrmCustomDragItem: The 'removeGhostNode' function is not implemented."},processDragStart:function(){},processDrag:function(t,e){},processDragStop:function(){},addDragListener:function(t){this._dragNotifier.addListener(t)},removeDragListener:function(t){this._dragNotifier.removeListener(t)},getContextId:function(){return""},getContextData:function(){return{}},getScrollTop:function(){var t=document.documentElement;var e=document.body;var i=t.scrollTop||e&&e.scrollTop||0;i-=t.clientTop;return i},_onDragStart:function(){if(!this._enableDrag){return}this.createGhostNode();var t=BX.pos(this._node);this._ghostNode.style.top=t.top+"px";this._ghostNode.style.left=t.left+"px";this._isInDragMode=true;BX.CrmCustomDragItem.currentDragged=this;BX.onCustomEvent("CrmDragItemDragStart",[this]);this.processDragStart();window.setTimeout(BX.delegate(this._prepareDocument,this),0)},_onDrag:function(t,e){if(!this._isInDragMode){return}if(this._ghostNode){this._ghostNode.style.top=e+this._ghostOffset.y+"px";this._ghostNode.style.left=t+this._ghostOffset.x+"px"}var i=this.getScrollTop();if(i>0&&e<=i){window.scrollTo(0,0);return}this.processDrag(t,e);this._dragNotifier.notify([t,e])},_onDragStop:function(t,e){if(!this._isInDragMode){return}this.removeGhostNode();this._isInDragMode=false;if(BX.CrmCustomDragItem.currentDragged===this){BX.CrmCustomDragItem.currentDragged=null}BX.onCustomEvent("CrmDragItemDragStop",[this]);this.processDragStop();window.setTimeout(BX.delegate(this._resetDocument,this),0)},_onDragRelease:function(t,e){BX.onCustomEvent("CrmDragItemDragRelease",[this])},_prepareDocument:function(){this._bodyOverflow=document.body.style.overflow;document.body.style.overflow="hidden"},_resetDocument:function(){document.body.style.overflow=this._bodyOverflow}};BX.CrmCustomDragItem.currentDragged=null;BX.CrmCustomDragItem.emulateDrag=function(){jsDD.refreshDestArea();if(jsDD.current_node){jsDD.drag({clientX:jsDD.x-jsDD.wndSize.scrollLeft,clientY:jsDD.y-jsDD.wndSize.scrollTop})}}}if(typeof BX.CrmCustomDragContainer==="undefined"){BX.CrmCustomDragContainer=function(){this._id="";this._settings={};this._node=null;this._itemDragHandler=BX.delegate(this._onItemDrag,this);this._draggedItem=null;this._dragFinishNotifier=null;this._enabled=true};BX.CrmCustomDragContainer.prototype={initialize:function(t,e){if(typeof jsDD==="undefined"){throw"CrmCustomDragContainer: Could not find jsDD API."}this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(8);this._settings=e?e:{};this._node=this.getSetting("node");if(!this._node){throw"CrmCustomDragContainer: The 'node' parameter is not defined in settings or empty."}this._dragFinishNotifier=BX.CrmNotifier.create(this);this.doInitialize();this.bindEvents()},doInitialize:function(){},release:function(){this.doRelease();this.unbindEvents()},doRelease:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},bindEvents:function(){this._node.onbxdestdraghover=BX.delegate(this._onDragOver,this);this._node.onbxdestdraghout=BX.delegate(this._onDragOut,this);this._node.onbxdestdragfinish=BX.delegate(this._onDragFinish,this);this._node.onbxdragstop=BX.delegate(this._onDragStop,this);this._node.onbxdragrelease=BX.delegate(this._onDragRelease,this);jsDD.registerDest(this._node,this.getPriority());this.doBindEvents()},doBindEvents:function(){},unbindEvents:function(){delete this._node.onbxdestdraghover;delete this._node.onbxdestdraghout;delete this._node.onbxdestdragfinish;delete this._node.onbxdragstop;delete this._node.onbxdragrelease;if(BX.type.isFunction(jsDD.unregisterDest)){jsDD.unregisterDest(this._node)}this.doUnbindEvents()},doUnbindEvents:function(){},createPlaceHolder:function(t){throw"CrmCustomDragContainer: The 'createPlaceHolder' function is not implemented."},removePlaceHolder:function(){throw"CrmCustomDragContainer: The 'removePlaceHolder' function is not implemented."},initializePlaceHolder:function(t){this.createPlaceHolder(t);this.refresh()},releasePlaceHolder:function(){this.removePlaceHolder();this.refresh()},getPriority:function(){return 100},addDragFinishListener:function(t){this._dragFinishNotifier.addListener(t)},removeDragFinishListener:function(t){this._dragFinishNotifier.removeListener(t)},getDraggedItem:function(){return this._draggedItem},setDraggedItem:function(t){if(this._draggedItem===t){return}if(this._draggedItem){this._draggedItem.removeDragListener(this._itemDragHandler)}this._draggedItem=t;if(this._draggedItem){this._draggedItem.addDragListener(this._itemDragHandler)}},isAllowedContext:function(t){return true},isEnabled:function(){return this._enabled},enable:function(t){t=!!t;if(this._enabled===t){return}this._enabled=t;if(t){jsDD.enableDest(this._node)}else{jsDD.disableDest(this._node)}},refresh:function(){jsDD.refreshDestArea(this._node.__bxddeid)},processDragOver:function(t){this.initializePlaceHolder(t)},processDragOut:function(){this.releasePlaceHolder()},processDragStop:function(){this.releasePlaceHolder()},processDragRelease:function(){this.releasePlaceHolder()},processItemDrop:function(){this.releasePlaceHolder()},_onDragOver:function(t,e,i){var s=BX.CrmCustomDragItem.currentDragged;if(!s){return}if(!this.isAllowedContext(s.getContextId())){return}this.setDraggedItem(s);this.processDragOver({x:e,y:i})},_onDragOut:function(t,e,i){if(!this._draggedItem){return}this.processDragOut();this.setDraggedItem(null)},_onDragFinish:function(t,e,i){if(!this._draggedItem){return}this._dragFinishNotifier.notify([this._draggedItem,e,i]);this.processItemDrop();this.setDraggedItem(null);BX.CrmCustomDragContainer.refresh()},_onDragRelease:function(t,e,i){if(!this._draggedItem){return}this.processDragRelease();this.setDraggedItem(null)},_onDragStop:function(t,e,i){if(!this._draggedItem){return}this.processDragStop();this.setDraggedItem(null)},_onItemDrag:function(t,e,i){if(!this._draggedItem){return}this.initializePlaceHolder({x:e,y:i})}};BX.CrmCustomDragContainer.refresh=function(){jsDD.refreshDestArea()}}BX.CrmDragDropBinState={suspend:0,wait:1,ready:2,open:3,close:4};if(typeof BX.CrmDragDropBin==="undefined"){BX.CrmDragDropBin=function(){this._state=BX.CrmDragDropBinState.suspend;this._chargeItem=null;this._enableChargeItem=false;this._chargeDragStartHandler=BX.delegate(this._onChargeDragStart,this);this._chargeDragStopHandler=BX.delegate(this._onChargeDragStop,this);this._chargeDragReleaseHandler=BX.delegate(this._onChargeDragRelease,this);this._chargeDragHandler=BX.delegate(this._onChargeDrag,this);this._workareaRect=null;this._promptingWrapper=null;this._closePromptingButtonId="crm_dd_bin_close_prompting_btn";this._closePromptingHandler=BX.delegate(this._onClosePromptingButtonClick,this);this._demoButtonId="crm_dd_bin_demo_btn";this._demoHandler=BX.delegate(this._onDemoButtonClick,this)};BX.extend(BX.CrmDragDropBin,BX.CrmCustomDragContainer);BX.CrmDragDropBin.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmDragItemDragStart",this._chargeDragStartHandler);BX.addCustomEvent(window,"CrmDragItemDragStop",this._chargeDragStopHandler);BX.addCustomEvent(window,"CrmDragItemDragRelease",this._chargeDragReleaseHandler);this.cacheWorkareaRect();BX.bind(window,"resize",BX.delegate(this._onWindowResize,this))};BX.CrmDragDropBin.prototype.getPriority=function(){return 10};BX.CrmDragDropBin.prototype.createPlaceHolder=function(t){};BX.CrmDragDropBin.prototype.removePlaceHolder=function(){};BX.CrmDragDropBin.prototype.processDragOver=function(t){if(this._chargeItem){this._enableChargeItem=false}this.setState(BX.CrmDragDropBinState.open)};BX.CrmDragDropBin.prototype.processDragOut=function(){if(this._chargeItem){this._enableChargeItem=true}this.setState(BX.CrmDragDropBinState.ready)};BX.CrmDragDropBin.prototype.processDragStop=function(){this.setState(BX.CrmDragDropBinState.suspend)};BX.CrmDragDropBin.prototype.processDragRelease=function(){this.setState(BX.CrmDragDropBinState.suspend)};BX.CrmDragDropBin.prototype.processItemDrop=function(){if(this._chargeItem){this._chargeItem.removeDragListener(this._chargeDragHandler);this._chargeItem=null}this._enableChargeItem=false;this.setState(BX.CrmDragDropBinState.close);window.setTimeout(BX.delegate(this.reset,this),1e3);BX.onCustomEvent(this,"CrmDragDropBinItemDrop",[this,this.getDraggedItem()])};BX.CrmDragDropBin.prototype.getState=function(){return this._state};BX.CrmDragDropBin.prototype.reset=function(){this.setState(BX.CrmDragDropBinState.suspend)};BX.CrmDragDropBin.prototype.setState=function(t){t=parseInt(t);if(t<BX.CrmDragDropBinState.suspend||t>BX.CrmDragDropBinState.close){t=BX.CrmDragDropBinState.suspend}if(this._state===t){return}this._state=t;var e=["crm-cart-block-wrap"];if(this._state>=BX.CrmDragDropBinState.wait){e.push("crm-cart-start")}if(this._state>=BX.CrmDragDropBinState.ready){e.push("crm-cart-active")}if(this._state>=BX.CrmDragDropBinState.open){e.push("crm-cart-hover")}if(this._state===BX.CrmDragDropBinState.close){e.push("crm-cart-finish")}this._node.className=e.join(" ");window.setTimeout(BX.delegate(BX.CrmCustomDragItem.emulateDrag,this),400);window.setTimeout(BX.delegate(BX.CrmCustomDragItem.emulateDrag,this),800)};BX.CrmDragDropBin.prototype._onChargeDragStart=function(t){this._enableChargeItem=true;this._chargeItem=t;this._chargeItem.addDragListener(this._chargeDragHandler);this.setState(BX.CrmDragDropBinState.wait)};BX.CrmDragDropBin.prototype._onChargeDragStop=function(t){if(!this._enableChargeItem||this._chargeItem!==t){return}this._chargeItem.removeDragListener(this._chargeDragHandler);this._chargeItem=null;this._enableChargeItem=false;this.setState(BX.CrmDragDropBinState.suspend)};BX.CrmDragDropBin.prototype._onChargeDragRelease=function(t){if(!this._enableChargeItem||this._chargeItem!==t){return}this._chargeItem.removeDragListener(this._chargeDragHandler);this._chargeItem=null;this._enableChargeItem=false;this.setState(BX.CrmDragDropBinState.suspend)};BX.CrmDragDropBin.prototype._onChargeDrag=function(t,e,i){if(this._enableChargeItem&&this._chargeItem===t){this.adjust()}};BX.CrmDragDropBin.prototype._onWindowResize=function(t){this.cacheWorkareaRect()};BX.CrmDragDropBin.prototype.cacheWorkareaRect=function(){var t=BX("workarea");if(!t){t=document.documentElement}this._workareaRect=BX.pos(t);this._readyThreshold=this._workareaRect.width/6};BX.CrmDragDropBin.prototype.adjust=function(){if(!this._chargeItem){return}var t=this._chargeItem.getGhostNode();if(!t){return}var e=BX.pos(t);var i=this._state>=BX.CrmDragDropBinState.ready;if(i!==this._workareaRect.right-e.left<=this._readyThreshold){i=!i;this.setState(i?BX.CrmDragDropBinState.ready:BX.CrmDragDropBinState.wait)}};BX.CrmDragDropBin.prototype.getMessage=function(t,e){var i=BX.CrmDragDropBin.messages;return i.hasOwnProperty(t)?i[t]:e};BX.CrmDragDropBin.prototype.showPromptingIfRequired=function(t){if(BX.localStorage.get("crm_dd_bin_show_prompt")!=="N"){this.showPrompting(t)}};BX.CrmDragDropBin.prototype.showPrompting=function(t){if(this._promptingWrapper){return}var e=this.getMessage("prompting");e=e.replace("#CLOSE_BTN_ID#",this._closePromptingButtonId).replace("#DEMO_BTN_ID#",this._demoButtonId);this._promptingWrapper=BX.create("DIV",{attrs:{className:"crm-view-message"},html:e});t.appendChild(this._promptingWrapper);BX.bind(BX(this._closePromptingButtonId),"click",this._closePromptingHandler);BX.bind(BX(this._demoButtonId),"click",this._demoHandler)};BX.CrmDragDropBin.prototype.hidePrompting=function(){if(!this._promptingWrapper){return}BX.localStorage.set("crm_dd_bin_show_prompt","N",31104e3);BX.unbind(BX(this._closePromptingButtonId),"click",this._closePromptingHandler);BX.unbind(BX(this._demoButtonId),"click",this._demoHandler);BX.remove(this._promptingWrapper)};BX.CrmDragDropBin.prototype.demo=function(){this.setState(BX.CrmDragDropBinState.wait);var t=this;window.setTimeout(function(){t.setState(BX.CrmDragDropBinState.ready)},1e3);window.setTimeout(function(){t.setState(BX.CrmDragDropBinState.open)},1500);window.setTimeout(function(){t.setState(BX.CrmDragDropBinState.close)},2e3)};BX.CrmDragDropBin.prototype._onDemoButtonClick=function(t){this.demo();return BX.PreventDefault(t)};BX.CrmDragDropBin.prototype._onClosePromptingButtonClick=function(t){this.hidePrompting();return BX.PreventDefault(t)};BX.CrmDragDropBin.instance=null;BX.CrmDragDropBin.getInstance=function(){if(this.instance){return this.instance}var t=BX.create("DIV",{attrs:{className:"crm-cart-block-wrap"},children:[BX.create("DIV",{attrs:{className:"crm-cart-block"},children:[BX.create("DIV",{attrs:{className:"crm-cart-icon"},children:[BX.create("DIV",{attrs:{className:"crm-cart-icon-top"}}),BX.create("DIV",{attrs:{className:"crm-cart-icon-body"}})]})]})]});document.body.appendChild(t);var e=new BX.CrmDragDropBin;e.initialize("default",{node:t});return this.instance=e};if(typeof BX.CrmDragDropBin.messages==="undefined"){BX.CrmDragDropBin.messages={}}}if(typeof BX.CrmLocalitySearchField==="undefined"){BX.CrmLocalitySearchField=function(){this._id="";this._settings={};this._localityType="";this._serviceUrl="";this._searchInput=null;this._dataInput=null;this._timeoutId=0;this._value="";this._items=[];this._menuId="crm-locality-search";this._menu=null;this._isRequestStarted=false;this._checkHandler=BX.delegate(this.check,this);this._keyPressHandler=BX.delegate(this.onKeyPress,this);this._menuItemClickHandler=BX.delegate(this.onMenuItemClick,this);this._searchCompletionHandler=BX.delegate(this.onSearchRequestComplete,this)};BX.CrmLocalitySearchField.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_loc_search_field_"+Math.random();this._settings=e?e:{};this._localityType=this.getSetting("localityType");if(!BX.type.isNotEmptyString(this._localityType)){throw"BX.CrmLocalitySearchField: localityType is not found!"}this._serviceUrl=this.getSetting("serviceUrl");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmLocalitySearchField: serviceUrl is not found!"}this._searchInput=BX(this.getSetting("searchInputId"));if(!BX.type.isElementNode(this._searchInput)){throw"BX.CrmLocalitySearchField: searchInput is not found!"}this._dataInput=BX(this.getSetting("dataInputId"));if(!BX.type.isElementNode(this._dataInput)){throw"BX.CrmLocalitySearchField: dataInputId is not found!"}BX.bind(this._searchInput,"keyup",BX.proxy(this._keyPressHandler,this));BX.bind(document,"click",BX.delegate(this._handleExternalClick,this))},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},check:function(){this._timeoutId=0;if(this._value!==this._searchInput.value){this._value=this._searchInput.value;this._timeoutId=window.setTimeout(this._checkHandler,750)}else if(this._value.length>=2){this.startSearchRequest(this._value)}},startSearchRequest:function(t){if(this._isRequestStarted){return false}this._isRequestStarted=true;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"FIND_LOCALITIES",LOCALITY_TYPE:this._localityType,NEEDLE:t},onsuccess:this._searchCompletionHandler,onfailure:this._searchCompletionHandler})},showMenu:function(t){BX.PopupMenu.destroy(this._menuId);var e=[];for(var i=0;i<t.length;i++){e.push(this.prepareMenuItem(t[i]))}this._menu=BX.PopupMenu.create(this._menuId,this._searchInput,e,{offsetTop:0,offsetLeft:0});this._menu.popupWindow.show()},closeMenu:function(){BX.PopupMenu.destroy(this._menuId);this._menu=null},prepareMenuItem:function(t){var e=BX.type.isNotEmptyString(t["CODE"])?t["CODE"]:"";if(e===""){throw"BX.CrmLocalitySearchField: could not find item code!"}var i=BX.type.isNotEmptyString(t["CAPTION"])?t["CAPTION"]:e;return{value:e,text:i,onclick:this._menuItemClickHandler}},onMenuItemClick:function(t,e){this.selectItem(e);this.closeMenu()},selectItem:function(t){this._dataInput.value=t["value"];this._searchInput.value=t["text"]},onKeyPress:function(t){if(this._timeoutId!==0){window.clearTimeout(this._timeoutId);this._timeoutId=0}this._timeoutId=window.setTimeout(this._checkHandler,375)},onSearchRequestComplete:function(t){this._isRequestStarted=false;var e=typeof t["DATA"]!=="undefined"&&typeof t["DATA"]["ITEMS"]!=="undefined"?t["DATA"]["ITEMS"]:[];if(e.length>0){this.showMenu(e)}}};BX.CrmLocalitySearchField.create=function(t,e){var i=new BX.CrmLocalitySearchField;i.initialize(t,e);return i}}
//# sourceMappingURL=interface_form.map.js