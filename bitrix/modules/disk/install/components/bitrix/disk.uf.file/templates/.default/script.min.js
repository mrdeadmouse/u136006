(function(e){var t=false,i=false,s=0,o=null,n=null,a={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";BX.addCustomEvent(e,"onUploaderIsAlmostInited",BX.proxy(this.onUploaderIsAlmostInited,this));this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(e,t){var i=BX.findChild(this.controller,{className:"diskuf-simple"},true),s=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(e=="BX.UploaderSimple"){BX.remove(s);BX.show(i)}else{BX.remove(i);BX.show(s)}t.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);t.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=t["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var n=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!n){for(var a in n){if(!n.hasOwnProperty(a))continue;BX.bind(n[a],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{})},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var n=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var a in s){o=s[a];if(s.hasOwnProperty(a)){if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}n=n.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),o)}}var r={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},l;l=BX.create("TR",{attrs:r,props:{className:"wd-inline-file"},html:n});var d=BX.findChild(l,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(l,i);s.element_id=s.id;this.agent.onAttach([s],[l]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)}).start()},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var n in s){var a=s[n];if(s.hasOwnProperty(n)){if(n.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){a=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){a=""}}}o=o.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),a).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),a)}}var r={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},l;if(s["XML_ID"])r["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])r["bx-attach-file-id"]="n"+s["FILE_ID"];l=BX.create("TR",{attrs:r,props:{className:"wd-inline-file"},html:o});if(!e.file.canChangeName){var d=BX.findChild(l,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}}i.parentNode.replaceChild(l,i);s.element_id=s.id;this.onFileIs(l,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=i.getItem(e.id);if(!!s&&(s=s.node)&&!!s){BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this])}},onError:function(e,t,i){var s="Uploading error.",o,n;if(i){if(i["error"]&&typeof i["error"]=="string")s=i["error"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){s=[];for(var a=0;a<i["errors"].length;a++){if(typeof i["errors"][a]=="object"&&i["errors"][a]["message"])s.push(i["errors"][a]["message"])}if(s.length<=0)s.push("Uploading error.");s=s.join(" ")}}e.files=e.files||{};for(n in e.files){if(e.files.hasOwnProperty(n)){o=this.agent.queue.items.getItem(n);this.onUploadError(o,{error:s},this.agent)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,n="file-action-control",a=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),d=BX.findChild(t,{className:"f-wrap"},true);if(!!a&&!!d&&!a.getAttribute(n)){a.setAttribute(n,"enabled");BX.bind(a,"click",BX.delegate(function(){this.move(o,d.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var h=BX.findChild(t,{className:"files-name-edit-inp"},true);if(h){BX.bind(h,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(h,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(h,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var u=BX.findChild(t,{className:"files-preview-wrap",tagName:"SPAN"},true);if(!!u)BX.bind(u,"mouseover",BX.delegate(function(){new r(this)},u));var c=BX.findChild(t,{className:"feed-add-post-loading"},true),m=BX.delegate(function(){this.deleteFile(t,i)},this),p=BX.create("SPAN",{props:{className:"del-but"},events:{click:m}});if(!!c){var f=BX.findChild(c,{className:"del-but"},true);if(!!f)BX.bind(f,"click",m);else c.appendChild(p.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[p]}))}if(!p.hasAttribute("bx-bound")){p.setAttribute("bx-bound","Y");BX.bind(p,"click",m);BX.onCustomEvent(t,"OnMkClose",[t])}},deleteFile:function(e,t){var i=BX.findChild(e,{className:"file-delete"},true),s=BX.proxy_context;if(!!t.__disk_element_id){BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e);if(!!i&&i.getAttribute("href").length>0)BX.ajax.post(i.href,{sessid:BX.bitrix_sessid()})},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&ACTION=FAKEMOVE&IFRAME=Y");while(s.indexOf("&&")>=0)s=s.replace("&&","&");if(!this._checkFileName){this._checkFileName=BX.proxy(this.checkFileName,this);this._selectFolder=BX.proxy(this.selectFolder,this);this._openSection=BX.proxy(this.openSection,this);this._selectItem=BX.proxy(this.selectItem,this);this._unSelectItem=BX.proxy(this.unSelectItem,this)}var o=i||BX("disk-edit-attach"+e),n=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:n.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName);this._checkFileName()},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".").pop();var r=s.value+"."+a;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&r!==n){BX.adjust(o,{text:r});var l=t.getAttribute("bx-agentFileId");var d=l?this.agent.getItem(l):null;if(!!d){d.item.file.name=r;d.item.name=r}var h=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!h){h.name=r}BX.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:r,attachedId:e,sessid:BX.bitrix_sessid()},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".");var r=a.pop();s.value=a.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,n=BX("disk-edit-attach"+o),a=BX.findChild(n,{className:"files-path"},true);BX.cleanNode(a);i=i.split("/").join(" / ");a.innerHTML=i;var r=parseInt(a.offsetWidth);var l=parseInt(a.parentNode.offsetWidth)-150,d;s=l/(r/i.length);if(r>l){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);a.innerHTML=i}var h=BX("diskuf-doc"+o);if(!!h){var u=this._fileUnserialize(h.value);u.section=t["sectionID"];u.iblock=t["iblockID"];h.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,n=false,a,r,l;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];for(a in i){if(i.hasOwnProperty(a)&&a.substr(0,1)=="S"){r=e.name+i[a].path;l={sectionID:a.substr(1),iblockID:e.iblock_id};this.showMovedFile(o,l,r);n=true}}if(!n){r=e.name;l={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){r+=s.path;l.sectionID=s.id.substr(1)}this.showMovedFile(o,l,r)}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=n}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;n=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+n+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!!BX.DD){var i=e["controller"].parentNode,s=i.getAttribute("id");if(BX.type.isElementNode(i)){BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){if(e["dataTransfer"]&&e["dataTransfer"]["files"]){BX.PreventDefault(e);if(BX.Disk.UF.dndCatcher[s]["uploader"]===null){BX.Disk.UF.dndCatcher[s].drop(e["dataTransfer"]["files"])}else{BX.onCustomEvent(BX(s),"DiskLoadFormController",["show"]);BX.Disk.UF.dndCatcher[s]["uploader"].agent.onChange(e["dataTransfer"]["files"])}return false}return true},this));BX.Disk.UF.dndCatcher[s]={files:[],uploader:null,dropZone:null,initdrag:BX.delegate(function(){var e=BX(s);BX.Disk.UF.dndCatcher[s].dropZone=new BX.DD.dropFiles(e);BX.addCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dropFiles",BX.Disk.UF.dndCatcher[s]["drop"]);BX.addCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dragEnter",BX.Disk.UF.dndCatcher[s]["dragover"]);BX.addCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dragLeave",BX.Disk.UF.dndCatcher[s]["dragleave"]);BX.unbind(document,"dragover",BX.Disk.UF.dndCatcher[s]["initdrag"])},this),dragover:BX.delegate(function(e){BX.addClass(BX(s),"bxu-file-input-over");BX.onCustomEvent(BX(s),"DiskLoadFormController",["show"])},this),dragleave:BX.delegate(function(e){BX.removeClass(BX(s),"bxu-file-input-over")},this),drop:BX.delegate(function(e){if(e&&e.length>0){BX.Disk.UF.dndCatcher[s].files=e;BX.onCustomEvent(BX(s),"DiskLoadFormController",["show"]);BX.removeClass(BX(s),"bxu-file-input-over")}},this)};BX.bind(document,"dragover",BX.Disk.UF.dndCatcher[s]["initdrag"]);this.__initCatcher=BX.delegate(function(e){var t=BX(s);e.agent.initDropZone(t);if(BX.Disk.UF.dndCatcher[s].files.length>0){e.agent.onChange(BX.Disk.UF.dndCatcher[s].files);BX.Disk.UF.dndCatcher[s].files=[]}BX.removeCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dropFiles",BX.Disk.UF.dndCatcher[s].drop);BX.removeCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dragEnter",BX.Disk.UF.dndCatcher[s].dragover);BX.removeCustomEvent(BX.Disk.UF.dndCatcher[s].dropZone,"dragLeave",BX.Disk.UF.dndCatcher[s].dragleave);BX.removeCustomEvent(t,"DiskDLoadFormControllerInit",this.__initCatcher);BX.Disk.UF.dndCatcher[s]["uploader"]=e;this.__initCatcher=null},this);BX.addCustomEvent(BX(i),"DiskDLoadFormControllerInit",this.__initCatcher)}}if(!!e["values"]&&e["values"].length>0)BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;a[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],a[t["UID"]]]);o=a[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],a[t["UID"]]])}return a[t["UID"]]};var r=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random();BX.bind(this.node,"mouseover",BX.delegate(function(){this.turnOn()},this));BX.bind(this.node,"mouseout",BX.delegate(function(){this.turnOff()},this))};r.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img,{lightShadow:true,offsetTop:-7,offsetLeft:7,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{attrs:{width:this.img.getAttribute("width"),height:this.img.getAttribute("height")},children:[BX.create("IMG",{attrs:{width:this.img.getAttribute("width"),height:this.img.getAttribute("height"),src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new r(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};e.DiskCreateDocument=function(e){if(!o){return false}if(!e){return false}var t=new BX.CViewer({createDoc:true});var i=t.createBlankElementByParams({docType:e,editUrl:BX.message("DISK_CREATE_BLANK_URL"),renameUrl:BX.message("DISK_RENAME_FILE_URL")});t.setCurrent(i);i.afterSuccessCreate=function(e){var t={};var i=e.name.split(".");i.pop();t["E"+e.objectId]={type:"file",id:"n"+e.objectId,name:e.name,label:i.join("."),storage:e.folderName,size:e.size,sizeInt:e.sizeInt,ext:e.extension,canChangeName:true,link:e.link};o.selectFile({},{},t)};t.runActionByCurrentElement("create",{obElementViewer:t});try{BX.PreventDefault()}catch(s){}return false};e.DiskOpenMenuCreateService=function(e){var t=new BX.CViewer({});t.openMenu("disk_open_menu_with_services",BX(e),[{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(t){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(t)},t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(t){this.setEditService("google");BX.adjust(e,{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(t){this.setEditService("skydrive");BX.adjust(e,{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(t)},t)}],{offsetTop:0,offsetLeft:25})};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false};e.showWebdavHistoryPopup=function(e,s,o){o=o||null;if(t){t.show();return}if(i==s){return}i=s;t=new BX.PopupWindow("bx_webdav_history_popup",o,{closeIcon:true,offsetTop:5,autoHide:true,zIndex:-100,content:BX.create("div",{children:[BX.create("div",{style:{display:"table",width:"665px",height:"225px"},children:[BX.create("div",{style:{display:"table-cell",verticalAlign:"middle",textAlign:"center"},children:[BX.create("div",{props:{className:"bx-viewer-wrap-loading-modal"}}),BX.create("span",{text:""})]})]})]}),closeByEsc:true,draggable:true,titleBar:{content:BX.create("span",{text:BX.message("WDUF_FILE_TITLE_REV_HISTORY")})},events:{onPopupClose:function(){t.destroy();t=i=false}}});t.show();BX.ajax.get(e,function(e){t.setContent(BX.create("DIV",{html:e}))})}})(window);
//# sourceMappingURL=script.map.js