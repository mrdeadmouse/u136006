BX.namespace("BX.Disk");BX.Disk.FolderListClass=function(){var e=function(e){this.errors=e.errors||[];this.grid=e.grid;this.infoPanelContainer=e.infoPanelContainer;this.gridGroupActionButton=BX(e.gridGroupActionButton);this.gridShowTreeButton=BX(e.gridShowTreeButton);this.rootObject=e.rootObject||{};this.storage=e.storage||{};this.storage.manage=this.storage.manage||{};this.currentObjectIdInInfoPanel=null;this.containerWithExtAndIntLinks=null;this.cacheExternalLinks={};this.actionGroupButton="move";this.checkboxes={};this.isBitrix24=e.isBitrix24||false;this.destFormName=e.destFormName||"folder-list-destFormName";this.ajaxUrl="/bitrix/components/bitrix/disk.folder.list/ajax.php";this.grid.SetActionName("move");this.setGroupActionTargetObjectId(this.rootObject.id);this.setEvents();this.workWithLocationHash();if(this.errors.length)this.showErrors();var t=BX.findChildren(this.grid.tableNode,{className:"draggable",tagName:"div"},true);var s=this.grid.isTile?"bx-disk-interface-tile":"bx-disk-interface-filelist";for(var i=0;i<t.length;i++){window.jsDD.registerObject(t[i]);t[i].onbxdragstart=function(){this._parent=this.parentNode;document.body.appendChild(BX.create("div",{props:{className:s},style:{paddingTop:0,border:"none"},children:[this]}));this.style.border="1px solid #E8E8E8";this.style.top="-1000px";this.style.left="-1000px"};t[i].onbxdragrelease=function(){this._parent.appendChild(this);this.style.border="";this.style.position="";this.style.top="";this.style.left="";this.style.zIndex=""};t[i].onbxdrag=function(e,t){this.style.position="absolute";this.style.zIndex=9999999;this.style.left=e+"px";this.style.top=t+"px"};t[i].onbxdragfinish=BX.delegate(function(e,t,s){var i=BX.proxy_context;var a=i.getAttribute("data-object-id");BX.remove(i._parent);BX.remove(i);try{this.removeRow(a)}catch(n){}},this);var a=BX.findChild(t[i],{tagName:"div",className:"bx-file-icon-container-small"},false);if(a&&BX.hasClass(a,"bx-disk-folder-icon")){window.jsDD.registerDest(t[i]);t[i].onbxdestdraghout=function(){BX.removeClass(this,"selected")};t[i].onbxdestdragfinish=BX.delegate(function(e,t,s){if(e.getAttribute("data-object-id")==BX.proxy_context.getAttribute("data-object-id")){return false}BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","moveTo"),data:{objectId:e.getAttribute("data-object-id"),targetObjectId:BX.proxy_context.getAttribute("data-object-id"),sessid:BX.bitrix_sessid()},onsuccess:function(e){BX.Disk.showModalWithStatusAction(e)}});return true},this);t[i].onbxdestdraghover=function(e,t,s){if(BX.hasClass(this,"selected")){return}BX.addClass(this,"selected");return true}}}};e.prototype.showErrors=function(){BX.Disk.showModalWithStatusAction({status:"error",errors:this.errors})};e.prototype.onHashChange=function(){var e=document.location.hash.match(/hl-([0-9]+)/g);if(e){var t=(document.location.hash.match(/!([a-zA-Z]+)/g)||[]).pop();for(var s in e){if(!e.hasOwnProperty(s)){continue}var i=e[s];var a=i.match(/hl-([0-9]+)/);if(a&&a[1]){var n=this.getCheckbox(a[1]);if(n){n.checked=true;var o=this.getRowByCheckBox(n);BX.addClass(o,"active");BX.scrollToNode(o);this.grid.SelectRow(n);this.runCommandOnObjectId(t,a[1])}else if(t){if(window.BXIM&&BXIM.isOpenNotify()){document.location.reload();BXIM.closeMessenger()}}}}if(window.BXIM&&BXIM.isOpenNotify()){BXIM.closeMessenger()}}};e.prototype.workWithLocationHash=function(){setTimeout(BX.delegate(function(){this.onHashChange()},this),350)};e.prototype.setEvents=function(){BX.bind(BX("delete_button_"+this.grid.table_id),"click",BX.proxy(this.onClickDeleteGroup,this));BX.bind(this.gridGroupActionButton,"click",BX.proxy(this.onClickGridGroupActionButton,this));BX.bind(this.gridShowTreeButton,"click",BX.proxy(this.onClickGridShowTreeButton,this));BX.bind(BX(this.storage.manage.connectButtonId),"click",BX.proxy(this.onClickManageConnectButton,this));BX.bind(window,"hashchange",BX.proxy(this.onHashChange,this));BX.addCustomEvent("onSelectRow",BX.proxy(this.onSelectRow,this));BX.addCustomEvent("onUnSelectRow",BX.proxy(this.onUnSelectRow,this));BX.addCustomEvent("onCreateExtendedFolder",BX.proxy(this.onCreateExtendedFolder,this));BX.addCustomEvent("onPullEvent-disk",BX.delegate(function(e,t){t=t||{};switch(t.action){case"commit":if(!t.objectId){break}if(parseInt(t.contentVersion,10)<2){break}var s=this.getRow(t.objectId);var i=BX.findChild(s,{tagName:"a",className:"bx-disk-folder-title"},true);if(!i){break}BX.Disk.showModalWithStatusAction({message:BX.message("DISK_FOLDER_LIST_LABEL_LIVE_UPDATE_FILE").replace("#NAME#",i.text)});break}},this))};e.prototype.runCommandOnObjectId=function(e,t){if(!e){return}switch(e.toLowerCase()){case"!disconnect":case"!detach":var s=this.getRow(t);var i=BX.findChild(s,{tagName:"a",className:"bx-disk-folder-title"},true);var a=BX.findChild(s,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true);this.openConfirmDetach({object:{id:t,name:i.text,isFolder:BX.hasClass(a,"bx-disk-folder-icon")}});break;case"!show":var n=BX("disk_obj_"+t);if(!!n){BX.fireEvent(n,"click")}break;default:break}};function t(e){var t=this.getRow(e);var s=BX.findChild(t,{tagName:"a",className:"bx-disk-folder-title"},true);return BX.findChild(t,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true)}e.prototype.setGroupActionTargetObjectId=function(e){var t=BX("grid_group_action_target_object");if(!t){this.grid.GetForm().appendChild(BX.create("input",{props:{id:"grid_group_action_target_object",name:"grid_group_action_target_object",type:"hidden",value:e}}))}else{t.value=e}};e.prototype.onClickManageConnectButton=function(e){var t=BX.proxy_context;if(!BX.type.isDomNode(BX.proxy_context))return;var s=this.storage.rootObject.id;if(BX.hasClass(t,"connect")){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),data:{objectId:this.storage.rootObject.id,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.Disk.showModalWithStatusAction(e);var s=BX.findChild(t,{className:"popup-current-icon"},true);if(!!s){BX.removeClass(s,"popup-current-icon-connect");BX.addClass(s,"popup-current-icon-disconnect")}var i=BX.findChild(t,{className:"bx-disk-disconnect-connect-disk-text"},true);if(!!i){BX.adjust(i,{text:BX.message("DISK_FOLDER_LIST_LABEL_ALREADY_CONNECT_DISK")})}BX.removeClass(t,"connect");BX.addClass(t,"disconnect");if(!!e.manage.link){this.storage.manage.link=BX.clone(e.manage.link,true)}},this)});BX.PreventDefault(e)}else if(BX.hasClass(t,"disconnect")){this.openConfirmDetach({object:{id:this.storage.manage.link.object.id,name:this.storage.name,isFolder:true},onSuccess:function(e){if(e&&e.status=="success"){e.message=BX.message("DISK_FOLDER_LIST_LABEL_DISCONNECTED_DISK")}BX.Disk.showModalWithStatusAction(e);var s=BX.findChild(t,{className:"popup-current-icon"},true);if(!!s){BX.removeClass(s,"popup-current-icon-disconnect");BX.addClass(s,"popup-current-icon-connect")}var i=BX.findChild(t,{className:"bx-disk-disconnect-connect-disk-text"},true);if(!!i){BX.adjust(i,{text:BX.message("DISK_FOLDER_LIST_LABEL_CONNECT_DISK")})}BX.removeClass(t,"disconnect");BX.addClass(t,"connect")}});BX.PreventDefault(e)}};e.prototype.onClickGridShowTreeButton=function(e){var t=null;var s=null;BX.addCustomEvent("onSelectFolder",BX.delegate(function(e){if(s){BX.removeClass(s,"selected")}t=e.getAttribute("data-object-id");s=e;var i=BX.findChild(s,{className:"bx-disk-wf-folder-name"},true);if(i){var a=BX.findChild(this.gridShowTreeButton,{tagName:"span"});if(a){var n=BX.findChild(i,{tagName:"span"})||{};BX.adjust(a,{text:n.textContent||n.innerText})}}t&&this.setGroupActionTargetObjectId(t);if(BX.PopupWindowManager.isPopupExists("bx-disk-toolbar-tree")){if(BX.PopupWindowManager.getCurrentPopup()){BX.PopupWindowManager.getCurrentPopup().close()}}},this));BX.addCustomEvent("onUnSelectFolder",function(e){t=null;s=null;var i=BX("grid_group_action_target_object");i&&BX.remove(i)});var i=this.rootObject;if(BX.PopupWindowManager.isPopupExists("bx-disk-toolbar-tree")){BX.PopupWindowManager.create("bx-disk-toolbar-tree").show();return}BX.ajax({url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),objectId:i.id},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}var s=this.buildTreeNode(i);var a=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});s.appendChild(a);var n=e.target?e.target:e.srcElement?e.srcElement:null;if(n){n=BX.findParent(n,{className:"popup-control",tagName:"span"},this.grid.tableNode)||n}this.buildTree(s,t);BX.Disk.modalWindow({bindElement:n,overlay:false,autoHide:true,modalId:"bx-disk-toolbar-tree",events:{onPopupClose:function(){}},content:[BX.create("ul",{props:{className:"bx-disk-wood-folder"},children:[s]})]})},this)})};e.prototype.onClickGridGroupActionButton=function(e){function t(e){if(!e)return;return BX.findChild(e,{tagName:"span"})}BX.PopupMenu.show("folder-list-action-all-btn-menu",BX("folder-list-action-all-btn"),[{text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_MOVE_BUTTON"),onclick:BX.delegate(function(e){this.actionGroupButton="move";this.grid.SetActionName("move");var s=BX.PopupMenu.getMenuById("folder-list-action-all-btn-menu");if(s){BX.adjust(t(s.bindElement),{text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_MOVE_BUTTON")});s.popupWindow.close()}},this)},{text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_COPY_BUTTON"),onclick:BX.delegate(function(e){this.actionGroupButton="copy";this.grid.SetActionName("copy");var s=BX.PopupMenu.getMenuById("folder-list-action-all-btn-menu");if(s){BX.adjust(t(s.bindElement),{text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_COPY_BUTTON")});s.popupWindow.close()}},this)}],{autoHide:true})};e.prototype.onClickDeleteGroup=function(e){if(!this.grid.IsActionEnabled())return false;var t=document.getElementById("actallrows_"+this.grid.table_id);this.openConfirmDeleteGroup({attemptDeleteAll:t&&t.checked});BX.PreventDefault(e);return false};e.prototype.removeRow=function(e,t){this.grid.removeRow(e,t);BX.onCustomEvent("onRemoveRowFromDiskList",[e])};e.prototype.getRow=function(e){return this.grid.getRow(e)};e.prototype.getRowByCheckBox=function(e){return this.grid.getRowByCheckBox(e)};e.prototype.getCheckbox=function(e){return this.grid.getCheckbox(e)};e.prototype.renameInline=function(e){var t=this.getCheckbox(e);var s=this.grid;var i=s.table_id;if(t.checked!==true){t.checked=true;s.SelectRow(t);s.EnableActions()}var a={};for(var n in s.oSaveData){if(!s.oSaveData.hasOwnProperty(n)){continue}a[n]={};for(o in s.oSaveData[n]){if(!s.oSaveData[n].hasOwnProperty(o)){continue}a[n][o]=s.oSaveData[n][o]}}s.ActionEdit();for(n in a){if(!a.hasOwnProperty(n)){continue}for(var o in a[n]){if(!a[n].hasOwnProperty(o)){continue}s.oSaveData[n][o]=a[n][o]}}var r=BX.findChild(this.getRowByCheckBox(t),{tag:"input",attr:{type:"text"}},true);if(r){BX.focus(r)}var d=BX.findChild(BX("bx_grid_"+i+"_action_buttons"),{tag:"input",attr:{type:"button"}});d.onclick=function(){s.ActionCancel();var e=BX.findChild(BX(i),{tag:"td","class":"bx-checkbox-col"},true,true);for(var t=0;t<e.length;t++){var a=BX.findChild(e[t],{tag:"input"});if(BX.type.isDomNode(a)&&a.checked){a.checked=false;s.SelectRow(a)}}s.EnableActions()}};e.prototype.openConfirmDelete=function(e){var t=e.object.name;var s=e.object.id;var i=e.object.isFolder;var a=e.canDelete;var n="";if(i){n=BX.message(a?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FOLDER_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FOLDER_CONFIRM")}else{n=BX.message(a?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FILE_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FILE_CONFIRM")}var o=[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","markDelete"),data:{objectId:s,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status=="success"){this.removeRow(s,function(){BX.Disk.showModalWithStatusAction(e)});return}BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}})];if(a){o.push(BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","delete"),data:{objectId:s,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status=="success"){this.removeRow(s,function(){BX.Disk.showModalWithStatusAction(e)});return}BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}}))}o.push(BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);return false}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",t),buttons:o})};e.prototype.openConfirmDetach=function(e){var t=e.object.name;var s=e.object.id;var i=e.object.isFolder;var a=e.onSuccess;var n="";if(i){n=BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_CONFIRM")}else{n=BX.message("DISK_FOLDER_LIST_DETACH_FILE_CONFIRM")}var o=[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_DETACH_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","detach"),data:{objectId:s,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status=="success"){if(BX.type.isFunction(a)){BX.delegate(a,this)(e)}else{this.removeRow(s,function(){BX.Disk.showModalWithStatusAction(e)})}return}BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:i?BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_TITLE"):BX.message("DISK_FOLDER_LIST_DETACH_FILE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",t),buttons:o})};e.prototype.openConfirmDeleteGroup=function(e){var t=BX.message("DISK_FOLDER_LIST_TRASH_DELETE_GROUP_CONFIRM");var s=[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);this.grid.ActionDelete();return false},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:t,buttons:s})};e.prototype.connectObjectToDisk=function(e){var t=e.object.name;var s=e.object.id;var i=e.object.isFolder;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),{id:"folder_list_connect_object_"+s,responseType:"json",postData:{objectId:s},afterSuccessLoad:function(e){if(!e){return}if(e.status=="success"){BX.Disk.showModalWithStatusAction({status:"success",message:i?BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FOLDER").replace("#NAME#",t):BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FILE").replace("#NAME#",t)})}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}})};e.prototype.showShareInfoSmallView=function(e){var t=e.object.name;var s=e.object.id;var i=e.object.isFolder;var a=null;var n=window.event;if(n){a=n.target||n.srcElement}function o(e){if(e.type=="users"){return BX.create("a",{props:{href:e.url||BX.Disk.getPathToUser(e.entityId),target:"_blank",className:"bx-disk-people"},children:[e.avatar?BX.create("span",{style:{backgroundImage:"url("+e.avatar+")"},props:{className:"bx-disk-avatar"}}):null,e.name]})}else{return BX.create("span",{props:{className:"bx-disk-people"},children:[e.avatar?BX.create("span",{style:{backgroundImage:"url("+e.avatar+")"},props:{className:"bx-disk-avatar"}}):null,e.name]})}}BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showShareInfoSmallView"),data:{objectId:s,sessid:BX.bitrix_sessid()},onsuccess:function(e){if(!e||e.status!="success"){return}var t=[];e.members=e.members||[];for(var s in e.members){if(!e.members.hasOwnProperty(s)){continue}t.push(o(e.members[s]))}BX.Disk.modalWindow({closeIcon:null,autoHide:true,overlay:false,bindElement:a,modalId:"bx-disk-share-info-small-view",withoutContentWrap:true,events:{onAfterPopupShow:function(){},onPopupClose:function(){this.destroy()}},content:[BX.create("div",{props:{className:"bx-disk-popup-share-list"},children:[BX.message("DISK_FOLDER_LIST_DETAIL_SHARE_INFO_OWNER")+":",BX.create("br"),o(e.owner),BX.create("br"),BX.message("DISK_FOLDER_LIST_DETAIL_SHARE_INFO_HAVE_ACCESS")+":",BX.create("br")].concat(t)})]})}})};e.prototype.getFirstSelectedCheckbox=function(){var e;for(e in this.checkboxes){if(this.checkboxes.hasOwnProperty(e)&&typeof e!=="function"&&this.checkboxes[e]==true){break}}return this.getCheckbox(e)};e.prototype.addCheckbox=function(e){var t=e.value;if(!this.checkboxes[t]){this.checkboxes[t]=true}};e.prototype.deleteCheckbox=function(e){var t=e.value;if(this.checkboxes[t]){this.checkboxes[t]=false}};e.prototype.onClickCopyInInfoPanelButton=function(e){var t=null;var s=null;BX.addCustomEvent("onSelectFolder",BX.delegate(function(e){if(s){BX.removeClass(s,"selected")}t=e.getAttribute("data-object-id");s=e;var i=BX.findChild(s,{className:"bx-disk-wf-folder-name"},true);if(i){var a=BX.findChild(this.gridShowTreeButton,{tagName:"span"});if(a){var n=BX.findChild(i,{tagName:"span"})||{};BX.adjust(a,{text:n.textContent||n.innerText})}}t&&this.setGroupActionTargetObjectId(t);if(BX.PopupWindowManager.isPopupExists("bx-disk-toolbar-tree")){if(BX.PopupWindowManager.getCurrentPopup()){BX.PopupWindowManager.getCurrentPopup().close()}}},this));BX.addCustomEvent("onUnSelectFolder",function(e){t=null;s=null;var i=BX("grid_group_action_target_object");i&&BX.remove(i)});BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),{id:"bx-disk-copy-modal-loader",responseType:"json",postData:{objectId:this.rootObject.id},afterSuccessLoad:BX.delegate(function(e){if(!e||e.status!="success"){BX.Disk.showModalWithStatusAction(e);return}var t=this.buildTreeNode(this.rootObject);var s=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});t.appendChild(s);BX.Disk.modalWindow({modalId:"bx-disk-copy-tree",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),events:{onPopupClose:function(){this.destroy()}},content:[BX.create("div",{props:{className:"bx-disk-popup-content-title"},text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MANY_COPY_TO")}),BX.create("ul",{props:{className:"bx-disk-wood-folder"},children:[t]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray"},events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);this.actionGroupButton="copy";this.grid.SetActionName("copy");BX.submit(this.grid.GetForm());return false},this)}})]});this.buildTree(t,e)},this)})};e.prototype.showInfoPanelManyObject=function(e){var t="bx-disk-folder-icon double";var s=[];s.push(BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_MANY_COPY_TO_BUTTON"),style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"},events:{click:BX.proxy(this.onClickCopyInInfoPanelButton,this)}}));s.push(BX.create("SPAN",{html:"&nbsp;"}));s.push(BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_MANY_DELETE_BUTTON"),style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"},events:{click:BX.delegate(function(e){BX.fireEvent(BX("delete_button_"+this.grid.table_id),"click")},this)}}));this.showInfoPanel({buttons:s,isFolder:false,isMany:true,icon:{className:t},title:{text:BX.Disk.getNumericCase(e.length,BX.message("DISK_FOLDER_LIST_SELECTED_OBJECT_1"),BX.message("DISK_FOLDER_LIST_SELECTED_OBJECT_21"),BX.message("DISK_FOLDER_LIST_SELECTED_OBJECT_2_4"),BX.message("DISK_FOLDER_LIST_SELECTED_OBJECT_5_20")).replace("#COUNT#",e.length)}})};e.prototype.showInfoPanelSingleObject=function(e){this.currentObjectIdInInfoPanel=e;var t=[];var s="";var i=this.getRow(e);var a=BX.findChild(i,{tagName:"a",className:"bx-disk-folder-title"},true);var n="bx-file-icon-container-small bx-disk-file-icon";var o=BX.findChild(i,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true);if(o){n=o.className}if(!a){return}if(!i.oncontextmenu){return}var r=i.oncontextmenu();for(var d in r){if(!r.hasOwnProperty(d)){continue}var c=r[d];if(c&&c["PSEUDO_NAME"]){switch(c["PSEUDO_NAME"].toLowerCase()){case"open":if(t.length>0){t.push(BX.create("SPAN",{html:"&nbsp;"}))}t.push(BX.create("a",{attrs:{onclick:c["ONCLICK"]},text:c["TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-green"}}));break;case"share":case"delete":case"copy":case"connect":if(t.length>0){t.push(BX.create("SPAN",{html:"&nbsp;"}))}t.push(BX.create("a",{attrs:{onclick:c["ONCLICK"]},text:c["TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"}}));break;case"internal_link":s=c["PSEUDO_VALUE"];break}}}this.showInfoPanel({buttons:t,internalLink:s,isFolder:BX.hasClass(o,"bx-disk-folder-icon"),icon:{className:n},objectId:e,title:{text:a.text,date:a.getAttribute("data-bx-dateModify"),href:a.getAttribute("href")}})};e.prototype.createButtonsInInfoPanel=function(e){var t=e.icon;var s=e.title;var i=e.buttons;return BX.create("div",{props:{className:"bx-disk-info-panel bx-disk-sidebar-section"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-relative"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-icon"},children:[BX.create("div",{props:{className:t.className}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-element-name-container"},children:[BX.create("div",{props:{id:"disk_info_panel_name",className:"bx-disk-info-panel-name"},children:[BX.create("a",{text:s.text,props:{title:s.text,href:s.href||"javascript:void(0);"}})]}),BX.create("div",{text:s.date,props:{className:"bx-disk-info-panel-date"}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-context"}})]}),BX.create("div",{props:{className:"tal"},children:i})]})};e.prototype.showInfoPanel=function(e){var t=e.title||{};var s=e.icon||{};var i=e.buttons||[];var a=e.internalLink||"";var n=e.isFolder;var o=!!e.isMany;var r=e.objectId||null;if(!t){return}var d=BX("disk_info_panel");var c=BX("bx_disk_empty_select_section");if(c)BX.hide(c);d.style.overflow="hidden";d.style.height=0;BX.cleanNode(d);this.containerWithExtAndIntLinks=null;var l=BX.create("div");d.appendChild(l);var p=this.createButtonsInInfoPanel({title:t,icon:s,buttons:i});l.appendChild(p);if(!n&&r&&!o){var h=this.getContainerWithExtAndIntLinks({objectId:r,internalLink:a});l.appendChild(h)}else{this.hideContainerWithExtAndIntLinks()}new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:100,height:l.offsetHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){d.style.height=e.height+"px";d.style.opacity=e.opacity/100},complete:BX.delegate(function(){d.style.cssText="";d.style.display="block"},this)}).animate()};e.prototype.showContainerWithExtAndIntLinks=function(){if(!this.containerWithExtAndIntLinks){return}BX.show(this.containerWithExtAndIntLinks,"block")};e.prototype.hideContainerWithExtAndIntLinks=function(){if(!this.containerWithExtAndIntLinks){return}BX.hide(this.containerWithExtAndIntLinks);this.switchOffExtLinkInPanel()};e.prototype.getExternalLinkByObjectId=function(e){if(this.cacheExternalLinks[e]){return this.cacheExternalLinks[e]}BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","getExternalLink"),data:{objectId:e,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){return}if(t.link){this.switchOnExtLinkInPanel(t);this.cacheExternalLinks[e]=t.link}else{this.switchOffExtLinkInPanel()}},this)});return""};e.prototype.switchOffExtLinkInPanel=function(e){var t=BX("bx-disk-sidebar-shared-outlink-input");var s=BX("bx-disk-sidebar-shared-outlink-label");t.value="";BX.adjust(s,{text:BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_LINK_OFF")});BX.removeClass(s.parentNode,"on");BX.addClass(s.parentNode,"off");BX.hide(BX("bx-disk-sidebar-shared-param"))};e.prototype.switchOnExtLinkInPanel=function(e){var t=BX("bx-disk-sidebar-shared-outlink-input");var s=BX("bx-disk-sidebar-shared-outlink-label");t.value=e.link||"";BX.adjust(s,{text:BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_LINK_ON")});BX.removeClass(s.parentNode,"off");BX.addClass(s.parentNode,"on");BX.show(BX("bx-disk-sidebar-shared-param"),"block")};e.prototype.onClickExternalSwitcher=function(e){if(!this.currentObjectIdInInfoPanel){return}var t=e.target||e.srcElement;if(BX.hasClass(t.parentNode,"on")){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","disableExternalLink"),data:{objectId:this.currentObjectIdInInfoPanel,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){this.cacheExternalLinks[this.currentObjectIdInInfoPanel]=""},this)});this.switchOffExtLinkInPanel()}else{BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","generateExternalLink"),data:{objectId:this.currentObjectIdInInfoPanel,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e||e.status!="success"){return}this.switchOnExtLinkInPanel(e);this.cacheExternalLinks[this.currentObjectIdInInfoPanel]=e.link},this)})}};e.prototype.openExternalLinkDetailSettings=function(e){BX.PreventDefault(e);BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","getDetailSettingsExternalLink"),{id:"bx-disk-external-link-loader",responseType:"json",postData:{objectId:this.currentObjectIdInInfoPanel},afterSuccessLoad:BX.delegate(function(e){if(!e||e.status!="success"){BX.Disk.showModalWithStatusAction(e);return}var t;if(e.linkData.hasDeathTime||e.linkData.hasPassword){t='<div class="bx-disk-popup-content-title noborder">'+e.object.name+" "+'<span class="fwn">'+e.object.size+", "+e.object.date+"</span>"+"</div>"+(e.linkData.hasDeathTime?"<div>"+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_USED_DEATH_TIME").replace("#DATE#",e.linkData.deathTime)+" </div>":"")+(e.linkData.hasPassword?"<div>"+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_USED_PASSWORD")+" </div>":"")}else{t='<div class="bx-disk-popup-content-title noborder">'+e.object.name+" "+'<span class="fwn">'+e.object.size+", "+e.object.date+"</span>"+"</div>"+'<form action="">'+'<ul class="bx-disk-popup-share-link-param-list">'+"<li>"+'<input id="bx-disk-ext-use-death-time" '+(e.linkData.hasDeathTime?'checked="checked"':"")+' type="checkbox">'+'<label for="bx-disk-ext-use-death-time">'+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_USE_DEATH_TIME")+" </label>"+'<span id="bx-disk-ext-use-death-time-table" '+(e.linkData.hasDeathTime?"":'style="display: none;"')+'><input id="bx-disk-ext-use-death-time-value" type="text" autocomplete="off" class="bx-disk-popup-input bx-disk-popup-share-input" style="height: 31px;">'+'<span id="bx-disk-ext-select-time" class="popup-control" style="vertical-align: initial;">'+'<span class="popup-current">'+'<span class="popup-current-text fwn" style="line-height: 29px;height: 29px;">'+'<span id="bx-disk-ext-select-time-text">'+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_HOUR")+"<span>"+'<span class="icon-arrow"></span>'+"</span>"+"</span>"+"</span></span>"+"</li>"+"<li>"+'<input id="bx-disk-ext-use-password" '+(e.linkData.hasPassword?'checked="checked"':"")+' type="checkbox">'+'<label for="bx-disk-ext-use-password">'+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_USE_PASSWORD")+"</label>"+'<table id="bx-disk-ext-use-password-table" class="bx-disk-popup-share-password" '+(e.linkData.hasPassword?"":'style="display: none;"')+">"+"<tbody><tr>"+"<td>"+BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_INPUT_PASSWORD")+":</td>"+'<td><input id="bx-disk-ext-use-password-value" type="password" class="bx-disk-popup-input" style="height: 31px;"></td>'+"</tr>"+"</tbody></table>"+"</li>"+"</ul>"+"</form>"}var s=60*60;var i=[BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})];if(!e.linkData.hasDeathTime&&!e.linkData.hasPassword){i.unshift(BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){var e=(parseInt(BX("bx-disk-ext-use-death-time-value").value,10)||0)*s;BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveSettingsExternalLink"),data:{objectId:this.currentObjectIdInInfoPanel,deathTime:e,password:BX("bx-disk-ext-use-password-value").value,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().close();BX.Disk.showModalWithStatusAction(e)},this)})},this)}}))}BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),events:{onAfterPopupShow:function(){BX.bind(BX("bx-disk-ext-use-password"),"click",function(e){if(this.checked){BX.show(BX("bx-disk-ext-use-password-table"),"block")}else{BX("bx-disk-ext-use-password-value").value="";BX.hide(BX("bx-disk-ext-use-password-table"))}});BX.bind(BX("bx-disk-ext-use-death-time"),"click",function(e){if(this.checked){BX.show(BX("bx-disk-ext-use-death-time-table"),"inline")}else{BX.hide(BX("bx-disk-ext-use-death-time-table"))}});BX.bind(BX("bx-disk-ext-select-time"),"click",function(){BX.PopupMenu.show("bx-disk-ext-select-time",this,[{text:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_MIN"),title:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_MIN"),href:"#",onclick:function(e,t){BX.PreventDefault(e);BX.adjust(BX("bx-disk-ext-select-time-text"),{text:t.text});s=60}},{text:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_HOUR"),title:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_HOUR"),href:"#",onclick:function(e,t){BX.PreventDefault(e);BX.adjust(BX("bx-disk-ext-select-time-text"),{text:t.text});s=60*60}},{text:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_DAY"),title:BX.message("DISK_FOLDER_LIST_TITLE_EXT_PARAMS_TIME_DAY"),href:"#",onclick:function(e,t){BX.PreventDefault(e);BX.adjust(BX("bx-disk-ext-select-time-text"),{text:t.text});s=24*60*60}}],{
autoHide:true,offsetTop:0,zIndex:1e4,offsetLeft:55,angle:{offset:45},events:{onPopupClose:function(){}}})})},onPopupClose:function(){BX.PopupMenu.destroy("bx-disk-ext-select-time");this.destroy()}},content:[t],buttons:i})},this)});return false};e.prototype.getContainerWithExtAndIntLinks=function(e){var t=e.internalLink||"";var s=e.externalLink||"";var i=e.objectId||"";if(i&&!s){s=this.getExternalLinkByObjectId(i)}var a=BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_LINK_OFF");if(s){a=BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_LINK_ON")}if(!this.containerWithExtAndIntLinks){this.containerWithExtAndIntLinks=BX.create("div",{props:{className:"bx-disk-sidebar-section"},children:[BX.create("div",{props:{className:"bx-disk-sidebar-shared-container"},children:[BX.create("div",{props:{className:"bx-disk-sidebar-shared-title"},children:[BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_LINK"),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_SIDEBAR_EXT_PARAMS"),props:{id:"bx-disk-sidebar-shared-param",href:"#",className:"bx-disk-sidebar-shared-param"},events:{click:BX.proxy(this.openExternalLinkDetailSettings,this)}})]}),BX.create("div",{props:{className:"bx-disk-sidebar-shared-outlink-container"},children:[BX.create("div",{props:{className:"bx-disk-sidebar-shared-outlink-switcher-container"},children:[BX.create("div",{props:{className:"bx-disk-sidebar-shared-outlink-switcher-track "+(s?"on":"off")},children:[BX.create("span",{props:{id:"bx-disk-sidebar-shared-outlink-label"},text:a}),BX.create("div",{props:{className:"bx-disk-sidebar-shared-outlink-switcher-point"},events:{click:BX.proxy(this.onClickExternalSwitcher,this)}})]})]}),BX.create("div",{props:{className:"bx-disk-sidebar-shared-outlink-input-container"},children:[BX.create("input",{props:{id:"bx-disk-sidebar-shared-outlink-input",className:"bx-disk-sidebar-shared-outlink-input",type:"text",value:s},events:{click:function(e){BX.focus(this);this.setSelectionRange(0,this.value.length)}}})]})]})]})]});return this.containerWithExtAndIntLinks}if(s){this.switchOnExtLinkInPanel({link:s})}return this.containerWithExtAndIntLinks};var s;e.prototype.onScroll=function(){if(!BX.type.isFunction(s)){s=BX.throttle(function(){var e=BX("bx-disk-container",true);var t=BX("disk_info_panel",true);if(e){var s=e.getBoundingClientRect().top;if(s<=0){BX.style(t.parentNode,"paddingTop",t.offsetHeight+30+"px");BX.addClass(t,"attached-panel")}else{t.parentNode.style.cssText="";BX.removeClass(t,"attached-panel")}}},150,this)}s()};e.prototype.onSelectRow=function(e,t,s){this.addCheckbox(s);if(t==1){this.showInfoPanelSingleObject(s.value)}else{var i=this.grid.GetCheckedCheckboxes();var a=[];for(var n in i){if(!i.hasOwnProperty(n)||i[n].name!="ID[]"){continue}a.push(i[n].value)}this.showInfoPanelManyObject(a)}};e.prototype.onUnSelectRow=function(e,t,s){this.deleteCheckbox(s);if(t==0){var i=s.value;var a=BX("disk_info_panel");var n=BX.firstChild(a);new BX.easing({duration:300,start:{opacity:100,height:n.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){a.style.height=e.height+"px";a.style.opacity=e.opacity/100},complete:BX.delegate(function(){a.style.cssText="";a.style.display="none";var e=BX("bx_disk_empty_select_section");if(e)BX.show(e,"block")},this)}).animate()}else{this.onSelectRow(e,t,this.getFirstSelectedCheckbox())}};e.prototype.getExternalLink=function(e){BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","generateExternalLink"),{id:"bx-disk-external-link-loader",responseType:"json",postData:{objectId:e},afterSuccessLoad:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.cacheExternalLinks[e]=t.link;BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-external-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label","for":"disk-get-external-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-external-link",className:"bx-viewer-inp",type:"text",value:t.link}})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)});return false};e.prototype.getInternalLink=function(e){BX.Disk.modalWindow({modalId:"bx-disk-internal-link",title:BX.message("DISK_FOLDER_LIST_ACT_COPY_INTERNAL_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-internal-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label","for":"disk-get-internal-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-internal-link",className:"bx-viewer-inp",type:"text",value:e}})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})};e.prototype.loadSubFolders=function(e){if(!e){return}var t=e.getAttribute("data-object-id");if(!t){return}BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),data:{objectId:t,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.buildTree(e,t)},this)})};e.prototype.buildTree=function(e,t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}var s=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});e.appendChild(s);if(t.items&&t.items.length){for(var i in t.items){if(!t.items.hasOwnProperty(i)){continue}s.appendChild(this.buildTreeNode(t.items[i]))}}else{var a=BX.findChild(e,{className:"bx-disk-wf-arrow"},true);if(a){BX.cleanNode(a)}}BX.removeClass(e,"bx-disk-close");BX.addClass(e,"bx-disk-open");BX.addClass(e,"bx-disk-loaded")};e.prototype.buildTreeNode=function(e){return BX.create("li",{props:{className:"bx-disk-folder-container bx-disk-parent bx-disk-close"},attrs:{"data-object-id":e.id},children:[BX.create("div",{props:{className:"bx-disk-folder-container"},children:[BX.create("table",{children:[BX.create("tr",{children:[BX.create("td",{props:{className:"bx-disk-wf-arrow"},events:{click:BX.delegate(function(e){var t=e.target||e.srcElement;var s=BX.findParent(t,{className:"bx-disk-parent"});if(BX.hasClass(s,"bx-disk-open")){BX.removeClass(s,"bx-disk-open");BX.addClass(s,"bx-disk-close");return}if(BX.hasClass(s,"bx-disk-loaded")){BX.removeClass(s,"bx-disk-close");BX.addClass(s,"bx-disk-open");return}this.loadSubFolders(s)},this)},children:[e.hasSubFolders?BX.create("span"):null]}),BX.create("td",{props:{className:"bx-disk-wf-folder-icon"},children:[BX.create("span")]}),BX.create("td",{props:{className:"bx-disk-wf-folder-name"},events:{click:BX.delegate(function(e){var t=e.target||e.srcElement;var s=BX.findParent(t,{className:"bx-disk-parent"});if(BX.hasClass(s,"selected")){BX.removeClass(s,"selected");BX.onCustomEvent("onUnSelectFolder",[s]);return}BX.addClass(s,"selected");BX.onCustomEvent("onSelectFolder",[s])},this)},children:[BX.create("span",{text:e.name})]})]})]})]})]})};e.prototype.openCopyModalWindow=function(e,t){var s=null;var i=null;BX.addCustomEvent("onSelectFolder",function(e){if(i){BX.removeClass(i,"selected")}s=e.getAttribute("data-object-id");i=e});BX.addCustomEvent("onUnSelectFolder",function(e){s=null;i=null});BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),{id:"bx-disk-copy-modal-loader",responseType:"json",postData:{objectId:e.id},afterSuccessLoad:BX.delegate(function(i){if(!i||i.status!="success"){BX.Disk.showModalWithStatusAction(i);return}var a=this.buildTreeNode(e);var n=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});a.appendChild(n);BX.Disk.modalWindow({modalId:"bx-disk-copy-tree",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),events:{onPopupClose:function(){this.destroy()}},content:[BX.create("div",{props:{className:"bx-disk-popup-content-title"},text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO").replace("#NAME#",t.name)}),BX.create("ul",{props:{className:"bx-disk-wood-folder"},children:[a]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray"},events:{click:BX.delegate(function(e){if(!s){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","copyTo"),data:{objectId:t.id,targetObjectId:s,sessid:BX.bitrix_sessid()},onsuccess:function(e){if(!e){return}if(e.status=="success"){BX.Disk.showModalWithStatusAction(e);return}BX.Disk.showModalWithStatusAction(e)}});return false},this)}})]});this.buildTree(a,i)},this)})};e.prototype.openMoveModalWindow=function(e,t){var s=null;var i=null;BX.addCustomEvent("onSelectFolder",function(e){if(i){BX.removeClass(i,"selected")}s=e.getAttribute("data-object-id");i=e});BX.addCustomEvent("onUnSelectFolder",function(e){s=null;i=null});BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSubFoldersToAdd"),{id:"bx-disk-move-modal-loader",responseType:"json",postData:{objectId:e.id},afterSuccessLoad:BX.delegate(function(i){if(!i||i.status!="success"){BX.Disk.showModalWithStatusAction(i);return}var a=this.buildTreeNode(e);var n=BX.create("ul",{props:{className:"bx-disk-wood-folder"}});a.appendChild(n);BX.Disk.modalWindow({modalId:"bx-disk-copy-tree",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),events:{onPopupClose:function(){this.destroy()}},content:[BX.create("div",{props:{className:"bx-disk-popup-content-title"},text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO").replace("#NAME#",t.name)}),BX.create("ul",{props:{className:"bx-disk-wood-folder"},children:[a]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO_BUTTON"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray"},events:{click:BX.delegate(function(e){if(!s){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","moveTo"),data:{objectId:t.id,targetObjectId:s,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status=="success"){this.removeRow(e.id);BX.Disk.showModalWithStatusAction(e);return}BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}})]});this.buildTree(a,i)},this)})};var i=false;var a={};var n={};var o={};var r={};var d={};var c={};var l="";e.prototype.showSharingDetailWithChangeRights=function(e){d={};c={};e=e||{};var s=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:"folder_list_sharing_detail_object_"+s,responseType:"json",postData:{objectId:s},afterSuccessLoad:BX.delegate(function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}var i={name:e.owner.name,avatar:e.owner.avatar,link:e.owner.link};BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(var t in e.members){if(!e.members.hasOwnProperty(t)){continue}d[e.members[t].entityId]={item:{id:e.members[t].entityId,name:e.members[t].name,avatar:e.members[t].avatar},type:e.members[t].type,right:e.members[t].right}}BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:e.destination.items,itemsLast:e.destination.itemsLast,itemsSelected:e.destination.itemsSelected});var s=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(s);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+i.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('+i.avatar+');"></span>'+i.name+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:s,entityToNewShared:d,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);var i=BX.delegate(t,this)(s);if(i){if(!d||BX.Disk.isEmptyObject(d)){BX.removeClass(i,"icon-shared icon-shared_2 shared");BX.removeClass(i,"icon-shared_1")}else{BX.addClass(i,"icon-shared icon-shared_2 shared")}}},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)})};function p(e){e=e||{};return(e.provider?e.provider+": ":"")+e.name}e.prototype.showRights=function(e){e=e||{};var t=e.object.id;var s={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsDetail"),{id:"folder_list_sharing_detail_object_"+t,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate(function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}for(var t in e.rights){if(!e.rights.hasOwnProperty(t)){continue}var i=e.rights[t];for(var a in i){if(!i.hasOwnProperty(a)){continue}s[t]={readOnly:true,item:{id:t,name:p(e.accessCodeNames[t]),avatar:null},type:"group",right:{title:i[a].TASK.TITLE}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){for(var e in s){if(!s.hasOwnProperty(e)){continue}BX.Disk.appendRight(s[e])}},this),onPopupClose:BX.delegate(function(){BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CREATE_FOLDER"),props:{id:"bx-disk-destination-object-modal",className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent border"},events:{click:BX.delegate(function(){},this)},children:[BX.create("span",{props:{className:"bx-disk-btn-icon bx-disk-btn-icon-plus"}}),BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER")]}),BX.create("div",{html:'<span class="feed-add-destination-input-box" id="feed-add-post-destination-input-box">'+'<input autocomplete="off" type="text" value="" class="feed-add-destination-inp" id="feed-add-post-destination-input"/>'+"</span>"})]})],buttons:[]})},this)})};e.prototype.showRightsOnStorage=function(){a={};var e=this.storage.id;var t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnStorageDetail"),{id:"folder_list_rights_detail_storage_"+e,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(s,n){n&&n.close();if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}if(BX.Disk.isEmptyObject(r)){r=BX.clone(s.tasks,true);BX.Disk.setModuleTasks(r)}for(var o in s.rights){if(!s.rights.hasOwnProperty(o)){continue}var d=s.rights[o];for(var c in d){if(!d.hasOwnProperty(c)){continue}t[o]={readOnly:!!d[c].READ_ONLY,item:{id:o,name:p(s.accessCodeNames[o]),avatar:null},type:"group",right:{title:d[c].TASK.TITLE,id:d[c].TASK.ID}}}}var l=!!s.showExtendedRights;var h=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL"),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){a=BX.clone(t,true);i=false;BX.Access.Init({groups:{disabled:this.isBitrix24}});var e={};for(var s in a){if(!a.hasOwnProperty(s))continue;a[s].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(a[s])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate(function(e){var t={};for(var s in a){if(!a.hasOwnProperty(s))continue;t[s]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate(function(e){var t=[];for(var s in e){for(var i in e[s]){t.push(e[s][i]);this.onSelectSystemRight(e[s][i],s)}}},this)});return BX.PreventDefault(e)},this))},this),onPopupClose:BX.delegate(function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]}),BX.create("div",{style:{marginTop:"27px",marginBottom:"20px"},html:'<input type="checkbox" '+(l?'checked="checked"':"")+' id="showExtendedRights"/><label for="showExtendedRights">'+BX.message("DISK_FOLDER_LIST_LABEL_SHOW_EXTENDED_RIGHTS")+"</label>"})]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnStorage"),data:{isChangedRights:i?1:0,showExtendedRights:BX("showExtendedRights").checked?1:0,storageId:e,storageNewRights:a,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);document.location.reload()},this)});if(!!h){h.close()}},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){if(!!h){h.close()}}}})]})},this)})};e.prototype.showRightsOnObjectDetail=function(e){a={};var t=this.storage.id;var s={};e=e||{};var i=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnObjectDetail"),{id:"folder_list_rights_detail_object_"+i,responseType:"json",postData:{objectId:i,storageId:t},afterSuccessLoad:BX.delegate(function(e,t){t&&t.close();if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}if(BX.Disk.isEmptyObject(r)){r=BX.clone(e.tasks,true);BX.Disk.setModuleTasks(r)}for(var d in e.rights){if(!e.rights.hasOwnProperty(d)){continue}var c=e.rights[d];for(var l in c){if(!c.hasOwnProperty(l)){continue}s[d]={item:{id:d,name:p(e.accessCodeNames[d]),avatar:null},type:"group",right:{title:c[l].TASK.TITLE,id:c[l].TASK.ID}}}}var h=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL"),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){a=BX.clone(s,true);n=BX.clone(s,true);o={};BX.Access.Init({groups:{disabled:this.isBitrix24}});for(var e in a){if(!a.hasOwnProperty(e))continue;a[e].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(a[e])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate(function(e){var t={};for(var s in a){if(!a.hasOwnProperty(s))continue;t[s]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate(function(e){var t=[];for(var s in e){for(var i in e[s]){t.push(e[s][i]);this.onSelectSystemRight(e[s][i],s)}}},this)});return BX.PreventDefault(e)},this))},this),onPopupClose:BX.delegate(function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnObject"),data:{objectId:i,objectNewRights:a,detachedRights:o,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e)},this)});if(!!h){h.close()}},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){if(!!h){h.close()}}}})]})},this)})};e.prototype.showSettingsOnBizproc=function(){var e=this.storage.id;var t="";BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSettingsOnBizproc"),{responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(s){if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}if(s.statusBizProc){t="checked"}BX.Disk.modalWindow({modalId:"bx-disk-settings-bizproc",title:BX.message("DISK_FOLDER_LIST_BIZPROC_TITLE_MODAL"),contentClassName:"",events:{},content:[BX.create("table",{html:"<tr><td>"+BX.message("DISK_FOLDER_LIST_BIZPROC_LABEL")+"</td>"+'<td><input type="checkbox" id="activationBizProc" '+t+" /></td>"+"</tr>"})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveSettingsOnBizproc"),data:{storageId:e,activationBizproc:BX("activationBizProc").checked?1:0,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}else{BX.Disk.showModalWithStatusAction(e)}location.reload()},this)})},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)})};e.prototype.openWindowForSelectDocumentService=function(e){var t=new BX.CViewer({});t.openWindowForSelectDocumentService({viewInUf:false})};e.prototype.showHiddenContent=function(e){e.style.display=e.style.display=="none"?"block":"none"};e.prototype.hide=function(e){if(!e.getAttribute("displayOld")){e.setAttribute("displayOld",e.style.display)}e.style.display="none"};e.prototype.showNetworkDriveConnect=function(e){e=e||{};var t=e.link,s=this.showHiddenContent,i=this.hide;s(BX("bx-disk-network-drive-full"));BX.Disk.modalWindow({modalId:"bx-disk-show-network-drive-connect",title:BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow:function(){var e=BX("disk-get-network-drive-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose:function(){i(BX("bx-disk-network-drive"));i(BX("bx-disk-network-drive-full"));BX("workarea-content").appendChild(BX("bx-disk-network-drive-full"));this.destroy()}},content:[BX.create("label",{text:BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE_DESCR_MODAL")+" :",props:{className:"bx-disk-popup-label","for":"disk-get-network-drive-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-network-drive-link",className:"bx-disk-popup-input",type:"text",value:t}}),BX("bx-disk-network-drive-full")],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]});if(BX("bx-disk-network-drive-secure-label")){i(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-label"));i(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-input"))}};e.prototype.showSharingDetailWithSharing=function(e){d={};c={};e=e||{};var s=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:"folder_list_sharing_detail_object_"+s,responseType:"json",postData:{objectId:s},afterSuccessLoad:BX.delegate(function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}var i={name:e.owner.name,avatar:e.owner.avatar,link:e.owner.link};l=e.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_2"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(var t in e.members){if(!e.members.hasOwnProperty(t)){continue}d[e.members[t].entityId]={item:{id:e.members[t].entityId,name:e.members[t].name,avatar:e.members[t].avatar},type:e.members[t].type,right:e.members[t].right}}c=BX.clone(d,true);BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:e.destination.items,itemsLast:e.destination.itemsLast,itemsSelected:e.destination.itemsSelected});var s=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){
BX.SocNetLogDestination.openDialog(s);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+i.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('+i.avatar+');"></span>'+i.name+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","appendSharing"),data:{objectId:s,entityToNewShared:d,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);var i=BX.delegate(t,this)(s);if(i){if(!d||BX.Disk.isEmptyObject(d)){BX.removeClass(i,"icon-shared icon-shared_2 shared");BX.removeClass(i,"icon-shared_1")}else{BX.addClass(i,"icon-shared icon-shared_2 shared")}}},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)})};e.prototype.onCreateExtendedFolder=function(){this.showCreateFolderWithSharing({})};e.prototype.showCreateFolderWithSharing=function(){d={};a={};var e=this.storage.id;var t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showCreateFolderWithSharingInCommon"),{id:"folder_list_rights_detail_storage_"+e,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate(function(s){if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}if(BX.Disk.isEmptyObject(r)){r=BX.clone(s.tasks,true);BX.Disk.setModuleTasks(r)}for(var i in s.rights){if(!s.rights.hasOwnProperty(i)){continue}var n=s.rights[i];for(var o in n){if(!n.hasOwnProperty(o)){continue}t[i]={detachOnly:true,item:{id:i,name:s.accessCodeNames[i].name,avatar:null},type:"group",right:{title:n[o].TASK.TITLE,id:n[o].TASK.ID}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-create-folder",title:BX.message("DISK_FOLDER_LIST_CREATE_FOLDER_MODAL"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate(function(){BX.focus(BX("disk-new-create-filename"));a=BX.clone(t,true);for(var e in t){if(!t.hasOwnProperty(e)){continue}BX.Disk.appendRight(t[e])}BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.addCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.addCustomEvent("onDetachRight",BX.proxy(this.onDetachRight,this));BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:s.destination.items,itemsLast:s.destination.itemsLast,itemsSelected:s.destination.itemsSelected});var i=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)});BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))},this),onPopupClose:BX.delegate(function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.proxy_context.destroy()},this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content-small"},children:[BX.create("label",{props:{className:"bx-disk-popup-label","for":"disk-new-create-filename"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("DISK_FOLDER_LIST_LABEL_NAME_CREATE_FOLDER")]}),BX.create("input",{props:{id:"disk-new-create-filename",className:"bx-disk-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})]}),BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate(function(){},this)}})]})]})],buttons:[BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green"},events:{click:BX.delegate(function(){var t=BX("disk-new-create-filename").value;if(!t){BX.focus(BX("disk-new-create-filename"));return}BX.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","createFolderWithSharing"),data:{name:t,storageId:e,storageNewRights:a||{},entityToNewShared:d||{},sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);if(e.status&&e.status=="success"){document.location.hash="#hl-"+e.folder.id;location.reload()}},this)});BX.PopupWindowManager.getCurrentPopup().close()},this)}}),BX.create("a",{text:BX.message("DISK_FOLDER_LIST_BTN_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent"},events:{click:function(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})},this)})};e.prototype.onSelectSystemRight=function(e,t){a[e.id]=a[e.id]||{};i=true;var s=BX.Access.GetProviderPrefix(t,e.id);a[e.id]={item:{avatar:null,id:e.id,name:(s?s+": ":"")+e.name},type:"user",right:"read"};a[e.id].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(a[e.id])};e.prototype.onSelectRightDestination=function(e,t,s){a[e.id]=a[e.id]||{};a[e.id]={item:e,type:t,right:a[e.id].right||{}};BX.Disk.appendRight({destFormName:this.destFormName,item:e,type:t,right:a[e.id].right})};e.prototype.onUnSelectRightDestination=function(e,t,s){var i=e.id;delete a[i];var n=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+i+""}},true);if(n){BX.remove(n)}};e.prototype.onChangeSystemRight=function(e,t){if(a[e]){i=true;a[e].right={id:t.ID,title:t.TITLE}}};e.prototype.onDetachSystemRight=function(e){if(a[e]){i=true;BX.Access.DeleteSelected(e);o[e]=a[e];delete a[e]}};e.prototype.onChangeRight=function(e,t){if(a[e]){a[e].right={id:t.ID,title:t.TITLE}}};e.prototype.onDetachRight=function(e){if(a[e]){delete a[e]}};e.prototype.onSelectDestination=function(e,t,s){d[e.id]=d[e.id]||{};BX.Disk.appendNewShared({maxTaskName:l,readOnly:!!c[e.id],destFormName:this.destFormName,item:e,type:t,right:d[e.id].right});d[e.id]={item:e,type:t,right:d[e.id].right||"disk_access_read"}};e.prototype.onUnSelectDestination=function(e,t,s){var i=e.id;if(!!c[i]){return false}delete d[i];var a=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+i+""}},true);if(a){BX.remove(a)}};e.prototype.onChangeRightOfSharing=function(e,t){if(d[e]){d[e].right=t}};e.prototype.onOpenDialogDestination=function(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow)BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})};e.prototype.onCloseDialogDestination=function(){var e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}};e.prototype.onOpenSearchDestination=function(){if(BX.SocNetLogDestination.popupSearchWindow)BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})};e.prototype.onCloseSearchDestination=function(){var e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}};e.prototype.onKeyDownDestination=function(e){var t=this.destFormName;if(e.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(t)}return true};e.prototype.onKeyUpDestination=function(e){var t=this.destFormName;if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(t);return BX.PreventDefault(e)}if(e.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,t)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog())BX.SocNetLogDestination.closeDialog();if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(e)};return e}();
//# sourceMappingURL=script.map.js