BX.namespace("BX.Bitrix24.Helper");BX.Bitrix24.Helper={frameOpenUrl:"",frameCloseUrl:"",isOpen:false,frameNode:null,popupNodeWrap:null,curtainNode:null,popupNode:null,closeBtn:null,openBtn:null,popupLoader:null,topBar:null,topBarHtml:null,header:null,langId:null,reloadPath:null,init:function(e){this.frameOpenUrl=e.frameOpenUrl||"";this.frameCloseUrl=e.frameCloseUrl||"";this.helpUpBtnText=e.helpUpBtnText||"";this.langId=e.langId||"";this.openBtn=e.helpBtn;this.reloadPath=e.reloadPath||"";this.popupLoader=BX.create("div",{attrs:{className:"bx-help-popup-loader"},children:[BX.create("div",{attrs:{className:"bx-help-popup-loader-text"},text:BX.message("B24_HELP_LOADER")})]});this.topBarHtml='<div class="bx-help-menu-title" onclick="BX.Bitrix24.Helper.reloadFrame(\''+this.reloadPath+"')\">"+BX.message("B24_HELP_TITLE")+'<span class="bx-help-blue">24</span></div>';this.topBar=BX.create("div",{attrs:{className:"bx-help-nav-wrap"},html:this.topBarHtml});this.header=document.body.querySelector(".bx-layout-header");this.createFrame();this.createCloseBtn();this.createPopup();BX.bind(this.openBtn,"click",BX.proxy(this.show,this));BX.bind(window,"message",BX.proxy(function(e){e=e||window.event;if(e.data.height&&this.isOpen)this.frameNode.style.height=e.data.height+"px";this.insertTopBar(typeof e.data=="object"?e.data.title:e.data);this._showContent()},this))},createFrame:function(){this.frameNode=BX.create("iframe",{attrs:{className:"bx-help-frame",frameborder:0,name:"help",id:"help-frame"}});BX.bind(this.frameNode,"load",BX.proxy(function(){this.popupNode.scrollTop=0},this))},_showContent:function(){this.frameNode.style.opacity=1;if(this.topBar.classList){this.topBar.classList.add("bx-help-nav-fixed");this.topBar.classList.add("bx-help-nav-show")}else{BX.addClass(this.topBar,"bx-help-nav-fixed");BX.addClass(this.topBar,"bx-help-nav-show")}this.popupLoader.classList.remove("bx-help-popup-loader-show")},_setPosFixed:function(){document.body.style.width=document.body.offsetWidth+"px";document.body.style.overflow="hidden"},_clearPosFixed:function(){document.body.style.width="auto";document.body.style.overflow=""},createCloseBtn:function(){this.closeBtn=BX.create("div",{attrs:{className:"bx-help-close"},children:[BX.create("div",{attrs:{className:"bx-help-close-inner"}})]});BX.bind(this.closeBtn,"click",BX.proxy(this.closePopup,this))},insertTopBar:function(e){this.topBar.innerHTML=this.topBarHtml+e},createPopup:function(){this.curtainNode=BX.create("div",{attrs:{className:"bx-help-curtain"}});this.popupNode=BX.create("div",{children:[this.frameNode,this.topBar,this.popupLoader],attrs:{className:"bx-help-main"}});document.body.appendChild(this.curtainNode);document.body.appendChild(this.popupNode);document.body.appendChild(this.closeBtn)},closePopup:function(){clearTimeout(this.shadowTimer);clearTimeout(this.helpTimer);BX.unbind(this.popupNode,"transitionend",BX.proxy(this.loadFrame,this));BX.unbind(document,"keydown",BX.proxy(this._close,this));BX.unbind(document,"click",BX.proxy(this._close,this));if(this.popupNode.style.transition!==undefined)BX.bind(this.popupNode,"transitionend",BX.proxy(this._clearPosFixed,this));else this._clearPosFixed();this.popupNode.style.width=0;this.topBar.style.width=0;if(this.topBar.classList){this.topBar.classList.remove("bx-help-nav-fixed");this.closeBtn.classList.remove("bx-help-close-anim")}else{BX.removeClass(this.topBar,"bx-help-nav-fixed");BX.removeClass(this.closeBtn,"bx-help-close-anim")}this.topBar.style.top=this.getTopCord().top+"px";this.helpTimer=setTimeout(BX.proxy(function(){this.curtainNode.style.opacity=0;this.closeBtn.style.display="none";if(this.openBtn.classList)this.openBtn.classList.remove("help-block-active")},this),500);this.shadowTimer=setTimeout(BX.proxy(function(){this.frameNode.src=this.frameCloseUrl;this.popupNode.style.display="none";this.curtainNode.style.display="none";this.frameNode.style.opacity=0;this.frameNode.style.height=0;this.popupLoader.classList.remove("bx-help-popup-loader-show");BX.unbind(this.popupNode,"transitionend",BX.proxy(this._clearPosFixed,this));if(this.topBar.classList)this.topBar.classList.remove("bx-help-nav-show");else BX.removeClass(this.topBar,"bx-help-nav-show");this.isOpen=false},this),800)},show:function(e){if(typeof B24==="object")B24.goUp();if(typeof e==="string"){this.frameOpenUrl=this.frameOpenUrl+"&"+e}var t=this.getTopCord().top;var s=this.getTopCord().right;clearTimeout(this.shadowTimer);clearTimeout(this.helpTimer);this._setPosFixed();this.curtainNode.style.top=t+"px";this.curtainNode.style.width=this.getTopCord().right+"px";this.curtainNode.style.display="block";this.popupNode.style.display="block";this.popupNode.style.paddingTop=t+"px";this.topBar.style.top=t+"px";this.closeBtn.style.top=t-63+"px";this.closeBtn.style.left=s-63+"px";this.closeBtn.style.display="block";this.popupLoader.style.top=t+"px";if(this.openBtn.classList)this.openBtn.classList.add("help-block-active");if(this.popupNode.style.transition!==undefined){BX.bind(this.popupNode,"transitionend",BX.proxy(this.loadFrame,this))}else{this.loadFrame(null)}this.shadowTimer=setTimeout(BX.proxy(function(){this.curtainNode.style.opacity=1;if(this.closeBtn.classList)this.closeBtn.classList.add("bx-help-close-anim");else BX.addClass(this.closeBtn,"bx-help-close-anim")},this),25);this.helpTimer=setTimeout(BX.proxy(function(){this.popupNode.style.width=860+"px";this.topBar.style.width=860+"px";this.popupLoader.classList.add("bx-help-popup-loader-show");BX.bind(document,"keydown",BX.proxy(this._close,this));BX.bind(document,"click",BX.proxy(this._close,this));this.isOpen=true},this),300)},_close:function(e){e=e||window.event;var t=e.target||e.srcElement;if(e.type=="click"){BX.PreventDefault(e)}if(e.keyCode==27){this.closePopup()}while(t!=document.documentElement){if(t==this.popupNode||t==this.closeBtn||t==this.topBar){break}else if(t==document.body&&!e.keyCode){this.closePopup();break}t=t.parentNode}},loadFrame:function(e){if(e!==null){e=e||window.event;var t=e.target||e.srcElement;if(t==this.popupNode)this.frameNode.src=this.frameOpenUrl}else{this.frameNode.src=this.frameOpenUrl}},reloadFrame:function(e){this.frameNode.style.opacity=0;this.frameNode.src=e;if(this.topBar.classList)this.topBar.classList.remove("bx-help-nav-show");else BX.removeClass(this.topBar,"bx-help-nav-show");this.popupNode.scrollTop=0},getTopCord:function(){var e=BX.pos(this.header);return{top:e.bottom,right:e.right}}};
//# sourceMappingURL=script.map.js