<?xml version="1.0" encoding="Windows-1251"?>
<content type="LES"><lesson_id>5826</lesson_id>
<was_chapter_id></was_chapter_id>
<keywords></keywords>
<childs_cnt>0</childs_cnt>
<is_childs>0</is_childs>
<sort>550</sort>
<timestamp_x>1418738238</timestamp_x>
<date_create>1386918660</date_create>
<created_user_name>(andrey-ka) Андрей Качалов</created_user_name>
<created_by>64579</created_by>
<active>Y</active>
<name>Поиск и обработка дубликатов</name>
<preview_picture></preview_picture>
<preview_text></preview_text>
<preview_text_type>text</preview_text_type>
<detail_text><![CDATA[<p>Помимо <a href=" http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID={SELF}&LESSON_ID=5068 " >поиска дублей при создании</a> новой сущности, существует возможность поиска и обработки дублей среди уже существующих записей. </p>
 
<p>Такой поиск доступен для <a href="/learning/course/index.php?COURSE_ID={SELF}&CHAPTER_ID=05024" >контактов</a>, <a href="/learning/course/index.php?COURSE_ID={SELF}&CHAPTER_ID=05027" >лидов</a> и <a href="/learning/course/index.php?COURSE_ID={SELF}&CHAPTER_ID=05025" >компаний</a>. Поиск выполняется отдельно для каждого списка сущностей.</p>
 
<p>Для перехода к этой функции следует воспользоваться соответствующим пунктом меню <a href="/learning/course/index.php?COURSE_ID={SELF}&CHAPTER_ID=05024#contekst_panel" >кнопки настроек</a> на контекстной панели.</p>
 	 
<p><img src="cid:resources/res323/8k5vf.settings_menu.png" border="0"  /></p>
 
<p>После чего будет открыта страница, на которой и будет производиться поиск и работа с дубликатами:</p>
 	 
<p><img src="cid:resources/res323/VSLc1.Find_Dubl.png" border="0" width="676" height="234"  /></p>
 
<p>
<a name="doubles"></a>
Для того чтобы начать работу с дублями, необходимо проиндексировать данные, используя кнопку <b>Обновить список</b>. Индекс необходимо обновлять после добавления новых или изменения уже существующих сущностей, иначе поиск среди них производиться не будет. </p>
 
<p>После индексации можно запускать поиск с помощью кнопки <b>Найти дубликаты</b>.</p>
 	 
<h4>Поиск дублей</h4>
 
<p>Каждый сотрудник может запустить поиск только среди своих сущностей (среди тех, к которым имеет <a href="#access" >доступ</a> на просмотр или редактирование). Поиск выполняется отдельно для контактов, компаний и лидов.</p>
 
<p>Поиск возможен по совпадению любых из указанных параметров: <b>ФИО</b>, <b>Телефон</b>, <b>E-mail</b>, <b>Название компании</b> (в случае <i>компании</i> или <i>лида</i>). </p>
 
<p></p>
 
<div class="hint"><b>Примечание:</b> Для <i>лидов</i> существует выбор, по какому принципу нужно искать дубли: лид выступает как физическое лицо &ndash; <i>контакт</i> или как юридическое лицо &ndash; <i>компания</i>. Если работа с лидами производится только как с контактами, то указывается <b>ФИО</b>, если как с компаниями, то <b>Название компании</b>. Если возможны оба варианта, то можно отдельно поработать с дублями по контактному лицу, а затем отдельно выполнить поиск по названию компании. </div>
 
<p></p>
 
<p>Так как полное совпадение проверяется по трем полям: <b>Фамилия</b>, <b>Имя</b>, <b>Отчество</b>, то в результатах поиска, в первую очередь отображаются самые заполненные сущности, а затем в порядке убывания остальные.</p>
 
<p>Если заполнено только поле <b>Фамилия</b>, то будет проверяться совпадение только с этим полем. Если заполнено только <b>Имя</b>, то дубли с таким же именем искаться не будут.</p>
 
<p></p>
 
<div class="hint"><b>Примечание:</b> Если у сотрудника нет прав на просмотр сущности, то она не показывается совсем, так как сотрудник может искать дубли только в тех данных, к которым имеет <a href="#access" >доступ</a>. </div>
 
<p></p>
 	 	 <a name="algorithm"></a> 
<h4>Алгоритм поиска дублей</h4>
 
<p>При поиске дублей выделяется главная сущность и возможные дубликаты к ней. При <a href="#merge" >объединении</a> данные из дублирующихся сущностей будут перенесены/добавлены в главную.</p>
 <a name="criterion"></a> 
<p>Главная сущность в системе выбирается по следующим критериям: </p>
 
<ul> 	 
  <li>более высокий индекс цитируемости - как часто менеджер работает с ней, как часто сущность упоминается в других контекстах: сделках, предложениях, делах.</li>
 	 
  <li>дата изменения - та сущность, которая редактировалась позднее всех, считается более актуальной.	</li>
 	 
  <li>наполненность карточки - более полная карточка будет важнее, чем менее заполненная. 	 
    <br />
   
    <br />
   	При таком подходе на заполненность проверяются следующие поля: <b>Телефон</b>, <b>E-mail</b>, <b>ФИО</b>, <b>Название компании</b>, <b>Адрес компании</b>.	</li>
 	 
  <li>права доступа &ndash; этот параметр влияет на порядок данных. Те сущности, которые доступны пользователю только для просмотра, будут отображаться в конце списка, так как объединить их все равно нельзя. </li>
 </ul>
 
<p>При этом проверка выполняется именно в такой последовательности, т.е. в первую очередь, проверяется <b>индекс цитируемости</b>, если находится что-то по этому критерию, то такая сущность становится главной и к ней уже подбираются дубли.</p>
 
<p>Если по первому критерию не удалось выбрать одну сущность, например, есть 2 дубликата и они схожи по количеству сделок и предложений, то проверяется второй критерий &ndash; последняя дата изменения карточки контакта (компании/лида).</p>
 
<p>Только если по первым двум не удалось выявить лидера &ndash; проверяется третий критерий и берется за главную сущность та карточка, которая максимально заполнена (стандартные поля, по которым выполняется поиск: <b>ФИО</b>, <b>Телефон</b>, <b>E-mail</b>.)</p>
 	 	 
<a name="access"></a>
 
<h4>Права доступа</h4>
 
<p>В больших компаниях с клиентами могут работать несколько менеджеров, поэтому контроль дублей доступен для всех сотрудников, которые имеют доступ к данным CRM. Но каждый сотрудник видит в результате только свои данные и не может объединить схожие контакты другого сотрудника. Другими словами, каждый работает со своей базой клиентов. </p>
 
<p>Если в результатах поиска, присутствуют сущности, на которые пользователь не имеет прав редактирования и удаления (только просмотр), то для них невозможно <a href="#merge" >объединение</a> с главной сущностью. При этом, если необходимо, то можно обратиться к ответственному с помощью ссылок <b>Написать</b> и <b>Позвонить</b> в колонке <b>Ответственный</b>.</p>
 	 
<p><img src="cid:resources/res323/POhUa.dup_list_access.png" border="0"  /></p>
 
<a name="admin_access"></a> 
<p></p>

<div class="hint"><b>Примечание:</b> Администратор может запустить поиск для каждой сущности отдельно. Имеет доступ ко всем данным, может объединить любые сущности.</div>

<p></p>
 	

<h4>Отображение результатов поиска дубликатов</h4>
 
<p>Результаты поиска дубликатов отображаются в виде списка, в котором каждая главная сущность сгруппирована со своими возможными дубликатами: </p>
 
<ul> 	
  <li>на первом месте, среди прочих, отображается главная сущность, в которую и будут переноситься данные из нижележащих сущностей.</li>
 	
  <li>ниже отображается детальная информация, по какому полю были найдены дубликаты. 		
    <p></p>
  
    <div class="hint"><b>Примечание:</b> Если одна и та же сущность имеет дубликаты по разным полям, то она будет дважды отображена в списке с соответствующими этим критериям дубликатами.</div>
  
    <p></p>
   	</li>
 	 	
  <li>затем идет список возможных для этой сущности дублей, с пометками, если к какой-то сущности пользователь не имеет доступ на редактирование (только просмотр). 	
    <br />
 
<br />
 	Список строится по тем же <a href="#criterion" >критериям</a>: упоминания, дата последнего изменения, максимальная наполненность карточки. 	 	 	 
<li>в самом низу группы находятся кнопки действий с дубликатами: 	 
  <br />
 		 
  <ul> 			 
    <li><b>Объединить</b> - используется для <a href="#merge" >переноса</a> данных из дубля в главную сущность.	</li>
   			 
    <li><b>Пропустить</b> - используется для отметки выбранных сущностей как не дубли. В этом случае, именно эти выбранные сущности по этим конкретным полям не будут больше предложены как возможные дубли. Но обратите внимание, что ниже по списку этот же элемент может быть представлен как дубль к другой сущности. 			 
      <br />
     
      <br />
     			Другими словами <b>пропустить</b> означает, что выделенные элементы не дубли, но при этом они могут быть дублями к другим. 			</li>
   		</ul>
 	</li>
 		 
<p><img src="cid:resources/res323/ZcYqg.duplicates_list.png" border="0"  /></p>
 
<p>Каждый список сортируется по алфавиту, для лидов и контактов &ndash; по <b>ФИО</b>, для компаний &ndash; по <b>Названию компании</b>. </p>
 
<!-- функционал будет добавлен позднее
<p>При разворачивании найденных дублей, подсвечивается поля, по которым были найдены совпадения.</p>
-->
 	 <a name="merge"></a> 
<h4>Объединение найденных дублей</h4>
 
<p></p>
 
<div class="warning"><b>Внимание!</b> Процесс объединения пока необратим. В результате объединения могут быть изменены права доступа, часть информации, такая как история, события ленты, список товаров могут быть удалены, так как основной информацией являются данные в главной сущности. </div>
 
<p></p>
 
<p>Итак, в списке имеется главная сущность и возможные к ней дубли. При объединении, все данные будут сливаться в главную сущность, при этом множественные поля будут просто дополняться, пустые поля будут заполнены данными с дубля, а вот те поля, которые заполнены и в главной сущности и в дубле, не будут объединены. </p>
 
<p>Если есть обычное, не множественное поле и оно заполнено в главной сущности, то в конечном результате, после объединения, именно это значение и будет сохранено. В этом случае лучше сравнить сущности межу собой перед объединением, чтобы случайно не удалить важную информацию. </p>
 
<p>Все привязки к сделкам, счетам, делам, задачам, будут автоматически изменены. Если раньше сделка была связана с дублем, то после объединения в ней будет ссылка на главную сущность, в которую был слит этот дубль. </p>
 
<p>События живой ленты о создании нового дела, счета и прочее перенесены в главную сущность не будут. </p>
 
<p><a href="#access" >Права доступа</a> после объединения остаются только у главной сущности, так как все дубли будут просто удалены. Но если в результате объединения кто-то из менеджеров может потерять доступ к своему контакту, то перед объединением вам будет показано предупреждение. </p>
 
<br />
 
<p>Рассмотрим пример объединения двух контактов.</p>
 
<p>В карточке первого контакта заполнены поля:</p>
 
<ul> 	 
  <li>Фамилия: Андреев</li>
 	 
  <li>Имя: Иван</li>
 	 
  <li>Отчество: Васильевич</li>
 	 
  <li>Телефон: 22-33-55 Рабочий</li>
 	 
  <li>Должность: Начальник отдела</li>
 </ul>
 
<p>В карточке второго контакта заполнены поля:</p>
 
<ul> 	 
  <li>Фамилия: Андреев</li>
 	 
  <li>E-mail: i.andreev@mok.com</li>
 	 
  <li>Телефон: 45-36-89 Другой</li>
 	 
  <li>Должность: Зам. Начальника</li>
 </ul>
 	 
<p><img src="cid:resources/res323/1ElP1.example_user_1.png" border="0"  />	<img src="cid:resources/res323/kmJDl.example_user_2.png" border="0"  /></p>
 
<p>После поиска дубликатов главной сущностью будет являться первый контакт т.к. у него, согласно <a href="#criterion" >критериям</a>, в карточке заполнено больше основных полей.</p>
 	 
<p><img src="cid:resources/res323/wqjNP.example_merge.png" border="0"  /></p>
 
<p>После процедуры объединения дубликат (второй контакт) перестанет существовать, а у главной записи (первый контакт) будут следующие поля:</p>
 
<ul> 	 
  <li>Фамилия: Андреев</li>
 	 
  <li>Имя: Иван</li>
 	 
  <li>Отчество: Васильевич</li>
 	 
  <li>E-mail: i.andreev@mok.com</li>
 	 
  <li>Телефон: 22-33-55 Рабочий</li>
 	 
  <li>Телефон: 45-36-89 Другой</li>
 	 
  <li>Должность: Начальник отдела</li>
 </ul>
 	 
<p><img src="cid:resources/res323/NG46y.example_user_3.png" border="0"  /></p>
 	 
<p>Информация из дубля, которая отличается от той, что уже существует в главной сущности, например, значение поля <b>Должность</b> (<code>Зам. Начальника</code>), не будет скопирована и просто перестанет существовать.</p>
 	 	 
<br />
 
<br />
 
<p> 
  <table width="100%" height="1" cellspacing="0" cellpadding="0" bgcolor="#cecece"> 
    <tbody> 
      <tr><td></td></tr>
     </tbody>
   </table>
 </p>
 
<p><b>Ссылки по теме:</b></p>
 
<ul> 	 
  <li><a href="http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=52&LESSON_ID=5068#kontrol_dubl" target="_blank" >Контроль ввода сущностей с идентичными параметрами</a>	</li>
 </ul>
 ]]></detail_text>
<detail_picture></detail_picture>
<detail_text_type>html</detail_text_type>
<launch></launch>
<code></code>
<active_from></active_from>
<active_to></active_to>
<rating></rating>
<rating_type></rating_type>
<scorm></scorm>
<linked_lesson_id></linked_lesson_id>
<course_id></course_id>
<course_sort></course_sort>
<edge_sort>550</edge_sort>
<id>5826</id>
<meta_publish_prohibited>N</meta_publish_prohibited>
</content>