function JCCalendarViewDay(t){this.ID="day";this._parent=null;this.SETTINGS={};this.ENTRIES=[];if(!window._DAY_STYLE_LOADED){BX.loadCSS("/bitrix/components/bitrix/intranet.absence.calendar.view/templates/day/view.css");window._DAY_STYLE_LOADED=true}BX.bind(window,"resize",BX.proxy(this.__onresize,this))}JCCalendarViewDay.prototype.__onresize=function(){this.UnloadData(true);this.__drawData()};JCCalendarViewDay.prototype.Load=function(){this._parent.FILTER.SHORT_EVENTS="Y";if(null!=this.ENTRIES&&this.ENTRIES.length>0)this.UnloadData();this.__drawLayout();this.TYPE_BGCOLORS=this._parent.TYPE_BGCOLORS;this._parent.LoadData(this.SETTINGS.DATE_START,this.SETTINGS.DATE_FINISH)};JCCalendarViewDay.prototype.LoadData=function(t){this.ENTRIES=t;if(BX.browser.IsIE()){setTimeout(BX.proxy(this.__drawData,this),10)}else{this.__drawData()}};JCCalendarViewDay.prototype.UnloadData=function(t){if(null==this.ENTRIES)return;if(null==t)t=false;for(var e=0;e<this.ENTRIES.length;e++){if(null!=this.ENTRIES[e].DATA){for(var T=0;T<this.ENTRIES[e].DATA.length;T++){if(null==this.ENTRIES[e].DATA[T].VISUAL)continue;this._parent.UnRegisterEntry(this.ENTRIES[e].DATA[T]);BX.cleanNode(this.ENTRIES[e].DATA[T].VISUAL,true);this.ENTRIES[e].DATA[T].VISUAL=null}}var a=document.getElementById("bx_calendar_user_"+this.ENTRIES[e]["ID"]);if(null!=a)a.parentNode.removeChild(a)}if(!t)this.ENTRIES=null};JCCalendarViewDay.prototype.SetSettings=function(t){this.SETTINGS=t;var e=new Date;if(null==this.SETTINGS.DATE_START||e>=this.SETTINGS.DATE_START&&e<=this.SETTINGS.DATE_FINISH)this.SETTINGS.DATE_START=e;this.SETTINGS.DATE_START.setHours(this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START);this.SETTINGS.DATE_START.setMinutes(0);this.SETTINGS.DATE_START.setSeconds(0);this.SETTINGS.DATE_START.setMilliseconds(0);this.SETTINGS.DATE_FINISH=new Date(this.SETTINGS.DATE_START.valueOf());this.SETTINGS.DATE_FINISH.setHours(this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH)};JCCalendarViewDay.prototype.Unload=function(){BX.unbind(window,"resize",BX.proxy(this.__onresize,this));this.UnloadData()};JCCalendarViewDay.prototype.changeDay=function(t){if(t!=-1)t=1;this.SETTINGS.DATE_START.setDate(this.SETTINGS.DATE_START.getDate()+t);this.SETTINGS.DATE_FINISH.setDate(this.SETTINGS.DATE_FINISH.getDate()+t);this.Load()};JCCalendarViewDay.prototype.__drawLayout=function(){var t=this;var e=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var T=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;this._parent.CONTROLS.CALENDAR.innerHTML="";this.obTable=document.createElement("TABLE");this.obTable.className="bx-calendar-day-main-table";this.obTable.setAttribute("cellSpacing","0");this._parent.CONTROLS.CALENDAR.appendChild(this.obTable);this.obTable.appendChild(document.createElement("TBODY"));var a=new Date(this.SETTINGS.DATE_FINISH.valueOf());a.setSeconds(a.getSeconds()-1);var i=this._parent.DAYS_FULL[this.SETTINGS.DATE_START.getDay()]+", "+this.SETTINGS.DATE_START.getDate()+" "+this._parent.MONTHS_R[this.SETTINGS.DATE_START.getMonth()]+" "+this.SETTINGS.DATE_START.getFullYear();this._parent.CONTROLS.DATEROW.innerHTML=this._parent.CONTROLS.DATEROW.innerHTML='<table class="bx-calendar-day-control-table" align="center"><tr>'+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-back"></a></td>'+"<td>"+i+"</td>"+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-fwd"></a></td>'+"</tr></table>";var s=this._parent.CONTROLS.DATEROW.getElementsByTagName("A");s[0].onclick=function(){t.changeDay(-1)};s[1].onclick=function(){t.changeDay(1)};this.obDelimRow=this.obTable.tBodies[0].insertRow(-1);this.obDelimRow.insertCell(-1);this.obDelimRow.cells[0].className="bx-calendar-day-empty";if(BX.browser.IsIE())this.obDelimRow.cells[0].innerHTML="&nbsp;";var E=new Date(this.SETTINGS.DATE_START.valueOf());var S=new Date;S.setMinutes(0);S.setSeconds(0);S.setMilliseconds(0);for(var n=e;n<T;n++){var r=this.obDelimRow.insertCell(-1);r.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(E.valueOf()==S.valueOf())r.className+=" bx-calendar-day-now";if(n<this.SETTINGS.DAY_START||n>=this.SETTINGS.DAY_FINISH)r.className+=" bx-calendar-day-hour-nonwork";var A=BX.isAmPmMode()?E.getHours()%12>0?E.getHours()%12:12:E.getHours();A+=BX.isAmPmMode()?E.getHours()<12?"am":"pm":"<sup>00</sup>";r.innerHTML=A;E.setHours(E.getHours()+1)}};JCCalendarViewDay.prototype.__drawData=function(){var t=new Date;t.setMinutes(0);t.setSeconds(0);t.setMilliseconds(0);var e=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var T=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;var a=this.SETTINGS.DATE_START;var i=new Date(this.SETTINGS.DATE_FINISH);i.setSeconds(i.getSeconds()-1);for(var s=0;s<(null==this.ENTRIES?0:this.ENTRIES.length);s++){for(var E=0;E<this.ENTRIES[s]["DATA"].length;E++){var S=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_FROM"];var n=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_TO"];if(a.valueOf()>n.valueOf()||i.valueOf()<S.valueOf()){this.ENTRIES[s]["DATA"].splice(E,1)}}if(this.ENTRIES[s]["DATA"].length==0&&!this._parent.FILTER.USERS_ALL){continue}var r=-1;if(null!=this.ENTRIES[s]["DATA"]&&this.ENTRIES[s]["DATA"].length>0){for(var E=0;E<this.ENTRIES[s]["DATA"].length;E++){var S=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_FROM"];var n=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_TO"];if(this.SETTINGS.DATE_START.valueOf()>=S.valueOf()&&this.SETTINGS.DATE_FINISH.valueOf()<=n.valueOf()+1e3){r=this.obDelimRow.rowIndex;break}}}var A=this.obTable.tBodies[0].insertRow(r);A.insertCell(-1);A.cells[0].className="bx-calendar-day-first-col";A.id="bx_calendar_user_"+this.ENTRIES[s]["ID"];var l=A.cells[0].appendChild(document.createElement("DIV"));var h=this._parent.FormatName(this.SETTINGS.NAME_TEMPLATE,this.ENTRIES[s]);l.title=h;if(this.ENTRIES[s]["DETAIL_URL"]){var I=document.createElement("A");I.appendChild(document.createTextNode(h));I.href=this.ENTRIES[s]["DETAIL_URL"]}else{var I=document.createTextNode(h)}l.appendChild(I);var o=new Date(this.SETTINGS.DATE_START.valueOf());for(var E=e;E<T;E++){var N=A.insertCell(-1);N.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(o.valueOf()==t.valueOf())N.className+=" bx-calendar-day-now";if(E<this.SETTINGS.DAY_START||E>=this.SETTINGS.DAY_FINISH)N.className+=" bx-calendar-day-hour-nonwork";if(BX.browser.IsIE())N.innerHTML="&nbsp;";o.setHours(o.getHours()+1)}}var D=2;for(var s=0;s<(null==this.ENTRIES?0:this.ENTRIES.length);s++){var _=BX("bx_calendar_user_"+this.ENTRIES[s]["ID"]);if(_&&this.ENTRIES[s]["DATA"]){var R=BX.pos(_,true);for(var E=0;E<this.ENTRIES[s]["DATA"].length;E++){var S=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_FROM"];var n=this.ENTRIES[s]["DATA"][E]["DATE_ACTIVE_TO"];this.ENTRIES[s]["DATA"][E].VISUAL=document.createElement("DIV");this.ENTRIES[s]["DATA"][E].VISUAL.bx_color_variant=this.ENTRIES[s]["DATA"][E]["TYPE"].length?this.ENTRIES[s]["DATA"][E]["TYPE"]:"OTHER";this.ENTRIES[s]["DATA"][E].VISUAL.className="bx-calendar-entry bx-calendar-color-"+this.ENTRIES[s]["DATA"][E].VISUAL.bx_color_variant;this.ENTRIES[s]["DATA"][E].VISUAL.style.background=this.TYPE_BGCOLORS[this.ENTRIES[s]["DATA"][E]["TYPE"].length?this.ENTRIES[s]["DATA"][E]["TYPE"]:"OTHER"];this.ENTRIES[s]["DATA"][E].VISUAL.style.top=R.top+D+"px";if(a.valueOf()>S.valueOf())S=a;if(i.valueOf()<n.valueOf())n=i;var d=S.getHours()+1-e,c=n.getHours()+1-e;if(c<d)c=d;var u=_.cells[d],f=_.cells[c];var O=BX.pos(u,true),v=O.left+D;if(S.getMinutes()>40)v+=O.right-O.left;else if(S.getMinutes()>20)v+=Math.round((O.right-O.left)/2);if(u!=f)O=BX.pos(f,true);var p=O.left;if(n.getMinutes()>40)p=O.right;else if(n.getMinutes()>20)p+=Math.round((O.right-O.left)/2);var b=Math.abs(parseInt(p-v-D*2));if(isNaN(b)||b<5)b=5;this.ENTRIES[s]["DATA"][E].VISUAL.style.left=parseInt(v)+"px";this.ENTRIES[s]["DATA"][E].VISUAL.style.width=b+"px";this.ENTRIES[s]["DATA"][E].VISUAL.style.height=parseInt(O.height-2*D)+"px";this.ENTRIES[s]["DATA"][E].VISUAL.innerHTML="<nobr>"+BX.util.htmlspecialchars(this.ENTRIES[s]["DATA"][E]["NAME"])+" ("+this.ENTRIES[s]["DATA"][E]["DATE_FROM"]+" - "+this.ENTRIES[s]["DATA"][E]["DATE_TO"]+")"+"</nobr>";this.ENTRIES[s]["DATA"][E].VISUAL.__bx_user_id=this.ENTRIES[s]["ID"];this._parent.MAIN_LAYOUT.appendChild(this.ENTRIES[s]["DATA"][E].VISUAL);this._parent.RegisterEntry(this.ENTRIES[s].DATA[E])}}}};
//# sourceMappingURL=view.map.js