if(typeof BX.CrmWidget==="undefined"){BX.CrmWidget=function(){this._id="";this._settings=null;this._typeName="";this._prefix="";this._heightInPixel=0;this._widthInPercent=0;this._layout="";this._data={};this._container=null;this._wrapper=null;this._headerWrapper=null;this._contentWrapper=null;this._settingButton=null;this._editButton=null;this._hasLayout=false;this._isChartsReady=false};BX.CrmWidget.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._typeName=this.getSetting("typeName","");if(!this._typeName){throw"CrmWidget: The type name is not found."}this._data=this.getSetting("data",{});this._prefix=this.getSetting("prefix","");var i=this.getSetting("containerId","");this._container=BX(i!==""?i:this._prefix+"_"+"container");if(!this._container){throw"CrmWidget: Could not find container."}this._heightInPixel=parseInt(this.getSetting("heightInPixel",0));if(this._heightInPixel<=0){this._heightInPixel=360}this._widthInPercent=parseInt(this.getSetting("widthInPercent",0));if(this._widthInPercent<=0){this._widthInPercent=100}this._layout=this.getSetting("layout","")},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getTitle:function(){if(this._typeName==="number"&&this._data.length>0&&BX.type.isNotEmptyString(this._data[0]["title"])){return this._data[0]["title"]}return this.getSetting("title",this._id)},getMessage:function(t){var e=BX.CrmWidget.messages;return e.hasOwnProperty(t)?e[t]:t},prepareGraphSettings:function(t){var e={title:t["title"],valueField:t["selectField"],balloonText:"[[title]]: [[value]]"};var i=typeof t["display"]!=="undefined"?t["display"]:{};var r=typeof i["graph"]!=="undefined"?i["graph"]:{};var a=this._typeName;if(BX.type.isNotEmptyString(r["type"])){a=t["display"]["type"]}if(BX.type.isNotEmptyString(r["clustered"])){e["clustered"]=r["clustered"]==="Y"}if(BX.type.isNotEmptyString(r["lineColor"])){e["lineColor"]=r["lineColor"]}if(a==="bar"){e["type"]="column";e["fillAlphas"]=1}else{e["type"]="smoothedLine";e["lineThickness"]=2;e["bullet"]="round";e["bulletSize"]=7;e["bulletBorderAlpha"]=1}return e},renderHeader:function(){this._headerWrapper=BX.create("DIV",{attrs:{className:"crm-widget-head"}});this._wrapper.appendChild(this._headerWrapper);this._settingButton=BX.create("SPAN",{attrs:{className:"crm-widget-settings"}});this._editButton=BX.create("SPAN",{attrs:{className:"crm-widget-title-edit"}});this._headerWrapper.appendChild(this._settingButton);this._headerWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title"},text:this.getTitle()}),this._editButton]})]}))},renderContent:function(){this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._typeName==="funnel"){this.renderFunnel()}else if(this._typeName==="graph"||this._typeName==="bar"){this.renderGraph()}else if(this._typeName==="number"){if(this._layout==="tiled"){this.renderTiledNumber()}else{this.renderNumber()}}else if(this._typeName==="rating"){this.renderRating()}},renderFunnel:function(){if(!this._isChartsReady){AmCharts.ready(BX.delegate(this.renderFunnel,this));this._isChartsReady=true;return}this._contentWrapper.style.height=this._heightInPixel+"px";AmCharts.makeChart(this._contentWrapper.id,{type:"funnel",theme:"none",titleField:this.getSetting("titleField","title"),valueField:this.getSetting("valueField","value"),dataProvider:this._data,labelPosition:"right",depth3D:160,angle:16,outlineAlpha:2,outlineColor:"#FFFFFF",outlineThickness:2,startY:-400,marginRight:240,marginLeft:10,balloon:{fixedPosition:true}})},renderGraph:function(){if(!this._isChartsReady){AmCharts.ready(BX.delegate(this.renderGraph,this));this._isChartsReady=true;return}this._contentWrapper.style.height=this._heightInPixel+"px";var t=this._data[0];var e=[];var i=BX.type.isArray(t["graphs"])?t["graphs"]:null;if(i){for(var r=0;r<i.length;r++){e.push(this.prepareGraphSettings(i[r]))}}else{e.push(this.prepareGraphSettings(t))}var a=BX.type.isArray(t["values"])?t["values"]:[];var s=BX.type.isNotEmptyString(t["groupField"])?t["groupField"]:"";var n={type:"serial",theme:"none",marginLeft:20,dataProvider:a,graphs:e,dataDateFormat:this.getSetting("dateFormat","YYYY-MM-DD"),categoryField:s,legend:{useGraphSettings:true,position:"bottom"}};if(this._typeName==="bar"&&e.length>0){n["valueAxes"]=[{stackType:"regular",axisAlpha:.3,gridAlpha:0}]}n["chartCursor"]={oneBalloonOnly:true};if(s==="DATE"){n["chartCursor"]["categoryBalloonDateFormat"]="DD MMM";var h=[];var l=[];for(var d=1;d<=12;d++){h.push(BX.message["MONTH_"+d.toString()]);l.push(BX.message["MON_"+d.toString()])}AmCharts.monthNames=h;AmCharts.shortMonthNames=l;var p=BX.message("FORMAT_DATE");var c=p.indexOf("D")<p.indexOf("M")?"DD MMM":"MMM DD";n["categoryAxis"]={parseDates:true,minPeriod:"DD",dateFormats:[{period:"DD",format:c},{period:"WW",format:c},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]}}AmCharts.makeChart(this._contentWrapper.id,n)},renderNumber:function(){BX.addClass(this._wrapper,"crm-widget-number");for(var t=0;t<this._data.length;t++){var e=this._data[t];var i=e["value"];if(BX.type.isNotEmptyString(e["text"])){i=e["text"]}var r=typeof e["display"]!=="undefined"?e["display"]:{};var a=typeof r["style"]!=="undefined"?r["style"]:{};if(BX.type.isNotEmptyString(a["backgroundColor"])){this._contentWrapper.style.backgroundColor=a["backgroundColor"]}var s=BX.create("A",{props:{href:"#"},text:i,events:{click:BX.eventReturnFalse}});if(BX.type.isNotEmptyString(a["color"])){s.style.color=a["color"]}var n=BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[s]});if(t===0){this._contentWrapper.appendChild(n)}else{var h=BX.create("DIV",{attrs:{className:"crm-widget-head"}});this._wrapper.appendChild(h);h.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title"},text:e["title"]})]})]}));var l=BX.create("DIV",{attrs:{className:"crm-widget-content"}});this._wrapper.appendChild(l);l.appendChild(n)}}},renderTiledNumber:function(){BX.addClass(this._wrapper,"crm-widget-total");for(var t=0;t<this._data.length;t++){var e=this._data[t];var i=e["value"];if(BX.type.isNotEmptyString(e["text"])){i=e["text"]}var r=BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[BX.create("A",{props:{href:"#"},text:i,events:{click:BX.eventReturnFalse}})]});if(t===0){this._contentWrapper.appendChild(r)}else{var a=BX.create("DIV",{attrs:{className:"crm-widget crm-widget-5"}});this._wrapper.appendChild(a);a.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-head"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title"},text:e["title"]})]})]})]}));var s=BX.create("DIV",{attrs:{className:"crm-widget-content"}});a.appendChild(s);s.appendChild(r)}}},renderRating:function(){BX.addClass(this._wrapper,"crm-widget-rating");var t=BX.create("DIV",{attrs:{className:"crm-widget-content-rating"}});this._contentWrapper.appendChild(t);var e=this._data[0];var i=parseInt(e["nomineeId"]);var r=BX.type.isArray(e["positions"])?e["positions"]:[];var a;var s=-1;for(a=0;a<r.length;a++){if(parseInt(r[a]["id"])===i){s=a;break}}if(s>=0){var n=r[s];t.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[BX.create("DIV",{attrs:{className:"crm-widget-rating-position-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-rating-pl"},text:this.getMessage("nomineeRatingPosition").replace("#POSITION#",n["value"])}),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{text:this.getMessage("legend").replace("#LEGEND#",n["legend"])})]})]})]}))}var h=BX.create("DIV",{attrs:{className:"crm-widget-rating-positions"}});t.appendChild(h);for(a=0;a<r.length;a++){var l=r[a];var d=parseInt(l["id"]);if(d===i){continue}h.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[this.getMessage("ratingPosition").replace("#POSITION#",l["value"]),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{text:this.getMessage("legend").replace("#LEGEND#",l["legend"])})]})]}))}},layout:function(){if(this._hasLayout){return}var t="crm-widget-10";if(this._widthInPercent===50){t="crm-widget-5"}else if(this._widthInPercent===70){t="crm-widget-7"}else if(this._widthInPercent===30){t="crm-widget-3"}this._wrapper=BX.create("DIV",{attrs:{className:"crm-widget "+t}});this._container.appendChild(this._wrapper);this.renderHeader();this.renderContent();this._hasLayout=true}};if(typeof BX.CrmWidget.messages==="undefined"){BX.CrmWidget.messages={}}BX.CrmWidget.create=function(t,e){var i=new BX.CrmWidget;i.initialize(t,e);return i}}
//# sourceMappingURL=script.map.js